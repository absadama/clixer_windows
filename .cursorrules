# CLÄ°XER - Enterprise Analytics Platform
# "OlaÄŸanÃ¼stÃ¼ Veri HÄ±zÄ±" ğŸš€
# Power BI / Tableau / Qlik Rakibi

---

## ğŸ”´ğŸ”´ğŸ”´ CURSOR AI - EN KRÄ°TÄ°K KURAL ğŸ”´ğŸ”´ğŸ”´

> **KULLANICIDAN "BAÅARILI" VEYA "Ã‡ALIÅTI" MESAJI GELMEDEN ASLA .cursorrules DOSYASINA GÃœNCELLEME YAPMA!**

### Neden?
1. DeÄŸiÅŸiklik yapÄ±lÄ±r â†’ KullanÄ±cÄ± TEST EDER
2. Test baÅŸarÄ±lÄ± â†’ KullanÄ±cÄ± "Ã§alÄ±ÅŸtÄ±/tamam/baÅŸarÄ±lÄ±" der
3. **ANCAK O ZAMAN** .cursorrules gÃ¼ncellenir
4. Aksi halde HATALI BÄ°LGÄ° kalÄ±cÄ± olur!

### AkÄ±ÅŸ:
```
Kod deÄŸiÅŸikliÄŸi yap â†’ KullanÄ±cÄ±ya sÃ¶yle â†’ BEKLE
                                            â†“
                          KullanÄ±cÄ±: "Ã‡alÄ±ÅŸtÄ±!" âœ… â†’ .cursorrules gÃ¼ncelle
                          KullanÄ±cÄ±: "Hata var" âŒ â†’ DÃ¼zelt, tekrar test et
```

### ASLA YAPMA:
- âŒ Test edilmeden rules'a yazma
- âŒ "DÃ¼zeltme tamamlandÄ±" diyerek rules'a ekleme
- âŒ KullanÄ±cÄ± onayÄ± olmadan versiyon gÃ¼ncelleme

---

## ğŸ“‹ PROJE KÄ°MLÄ°ÄÄ°

**Clixer**, bÃ¼yÃ¼k Ã¶lÃ§ekli kurumsal analitik platformudur. Perakende, F&B, Ã¼niversite, holding gibi farklÄ± sektÃ¶rlerde kullanÄ±labilir. Temel farkÄ±mÄ±z: **real-time veri akÄ±ÅŸÄ±** ve **olaÄŸanÃ¼stÃ¼ performans**.

### Motto
> "Veri hÄ±zÄ± olaÄŸanÃ¼stÃ¼ olacak ÅŸekilde tasarlandÄ±"

### Rakiplerden FarkÄ±mÄ±z
| Ã–zellik | Power BI | Tableau | Clixer |
|---------|----------|---------|--------|
| Real-time | âŒ (15dk refresh) | âŒ | âœ… WebSocket |
| Offline | âŒ | âŒ | âœ… Service Worker |
| Delta Sync | âŒ | âŒ | âœ… |
| Native Mobile | AyrÄ± app | AyrÄ± app | âœ… Capacitor |
| White-label | âŒ | âŒ | âœ… |
| No-code ETL | Power Query | âŒ | âœ… UI tabanlÄ± |

---

## ğŸ—ï¸ TEKNOLOJÄ° YIÄINI

### Frontend
- React 19 + TypeScript (strict mode)
- Vite (build tool)
- Zustand (state management) - Context API DEÄÄ°L
- TailwindCSS (styling)
- TanStack Virtual (bÃ¼yÃ¼k listeler iÃ§in)
- Recharts (grafikler, lazy loaded)
- Capacitor (native mobile)
- Service Worker + IndexedDB (offline support)

### Backend (5 Microservice)
- Node.js + Express.js
- TypeScript
- JWT + bcrypt (auth)

### Databases
- **PostgreSQL 15**: Uygulama ayarlarÄ± (OLTP)
- **ClickHouse**: Analitik veriler (OLAP)
- **Redis**: Cache + Pub/Sub + Queue

### Infrastructure
- Docker + Docker Compose
- Bull Queue (job processing)
- WebSocket (Socket.io)

---

## ğŸ”§ MÄ°CROSERVÄ°CES MÄ°MARÄ°SÄ° (5 Servis)

| Servis | Port | Sorumluluk |
|--------|------|------------|
| auth-service | 4001 | Login, JWT, 2FA, Åifre |
| core-service | 4002 | Users, Tenants, Designs, Components, Settings |
| data-service | 4003 | Connections, Datasets, ETL, ClickHouse yazma |
| notification-service | 4004 | Alerts, Cron, Email, WebSocket |
| analytics-service | 4005 | KPI okuma, Cache, Aggregation |

### Dizin YapÄ±sÄ±
```
clixer/
â”œâ”€â”€ frontend/                 # React uygulamasÄ±
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # UI bileÅŸenleri
â”‚   â”‚   â”œâ”€â”€ pages/            # Sayfa componentleri
â”‚   â”‚   â”œâ”€â”€ stores/           # Zustand stores
â”‚   â”‚   â”œâ”€â”€ services/         # API istemcileri
â”‚   â”‚   â”œâ”€â”€ hooks/            # Custom hooks
â”‚   â”‚   â””â”€â”€ utils/            # YardÄ±mcÄ± fonksiyonlar
â”‚   â””â”€â”€ public/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth-service/
â”‚   â”œâ”€â”€ core-service/
â”‚   â”œâ”€â”€ data-service/
â”‚   â”œâ”€â”€ notification-service/
â”‚   â””â”€â”€ analytics-service/
â”œâ”€â”€ shared/                   # Ortak modÃ¼ller
â”‚   â”œâ”€â”€ db.ts                 # Database helpers
â”‚   â”œâ”€â”€ auth.ts               # JWT middleware
â”‚   â”œâ”€â”€ cache.ts              # Redis helpers
â”‚   â”œâ”€â”€ errors.ts             # Error classes
â”‚   â””â”€â”€ logger.ts             # Structured logging
â”œâ”€â”€ gateway/                  # API Gateway
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ Dockerfile.*
â””â”€â”€ scripts/
    â”œâ”€â”€ setup.sh
    â””â”€â”€ seed.sh
```

---

## ğŸ—„ï¸ VERÄ°TABANI MÄ°MARÄ°SÄ°

### PostgreSQL (clixer) - Uygulama AyarlarÄ±
```sql
-- KullanÄ±cÄ± ve yetki
users, tenants, roles, permissions

-- TasarÄ±m
designs, components (widget+metric birleÅŸik)

-- Veri baÄŸlantÄ±larÄ±
data_connections, datasets, etl_jobs, etl_schedules

-- Sistem
system_settings, audit_logs, notifications
```

### ClickHouse (clixer_analytics) - Analitik Veriler
```sql
-- ETL ile doldurulan tablolar
-- Materialized Views (pre-aggregation)
-- Partition by month (toYYYYMM)
```

### âš ï¸ KRÄ°TÄ°K KURAL
- PostgreSQL = Config, ayarlar, CRUD (sÄ±k gÃ¼ncellenen)
- ClickHouse = Analitik, bÃ¼yÃ¼k veri, aggregation (append-only)
- **Dashboard ASLA mÃ¼ÅŸteri DB'ye direkt baÄŸlanmaz!**
- AkÄ±ÅŸ: MÃ¼ÅŸteri DB â†’ ETL â†’ ClickHouse â†’ Dashboard

---

## ğŸš€ PERFORMANS OPTÄ°MÄ°ZASYONLARI

### 1. Pre-Aggregation (ClickHouse Materialized Views)
```sql
-- Dashboard aÃ§Ä±lÄ±nca hesaplama YAPILMAZ
-- Veri ETL sÄ±rasÄ±nda aggregated olur
CREATE MATERIALIZED VIEW mv_daily_sales
ENGINE = SummingMergeTree()
ORDER BY (store_id, date)
AS SELECT
    store_id,
    toDate(created_at) as date,
    sum(amount) as total_sales
FROM sales
GROUP BY store_id, date;
```

### 2. Multi-Level Cache (4 Katman)
```
L1: Browser (Service Worker, IndexedDB) â†’ 1ms
L2: CDN/Edge (opsiyonel, production) â†’ 10ms
L3: Redis (query results) â†’ 5ms
L4: ClickHouse Materialized Views â†’ 50ms
```

### 3. Event-Driven Cache Invalidation
```javascript
// ETL veri yazdÄ±ÄŸÄ±nda
await clickhouse.insert('sales', data);
await redis.del('kpi:*'); // Cache temizle
await redis.publish('data_changed', { table: 'sales' }); // Event gÃ¶nder
// Frontend WebSocket ile anÄ±nda gÃ¼ncellenir
```

### 4. CQRS (Command Query Responsibility Segregation)
- Write Path: MÃ¼ÅŸteri DB â†’ ETL â†’ ClickHouse (yavaÅŸ olabilir)
- Read Path: Redis Cache â†’ ClickHouse MV â†’ Dashboard (ultra hÄ±zlÄ±)

### 5. Single Endpoint for Dashboard
```javascript
// âŒ YANLIÅ: Waterfall calls
GET /api/design/1
GET /api/metrics
GET /api/kpi/metric1
...

// âœ… DOÄRU: Tek istek
GET /api/dashboard/1/full
// TÃ¼m design + components + kpi data TEK response
```

### 6. Virtual Rendering
```jsx
// 100.000 satÄ±rlÄ±k tablo 60 FPS
import { useVirtualizer } from '@tanstack/react-virtual';
```

### 7. Delta Sync
```javascript
// Ä°lk yÃ¼kleme: TÃ¼m veri
GET /api/dashboard/full

// Sonraki: Sadece deÄŸiÅŸenler
GET /api/dashboard/delta?since=2025-01-01T10:00:00Z
```

---

## ğŸ”„ ETL MÄ°MARÄ°SÄ°

### Veri KaynaklarÄ±
- Database (MSSQL, PostgreSQL, MySQL, Oracle)
- API (REST, GraphQL)
- Excel/CSV dosyalarÄ±

### Sync Stratejileri
| Strateji | KullanÄ±m | AÃ§Ä±klama |
|----------|----------|----------|
| Timestamp-Based | Ã‡oÄŸu tablo | WHERE modified_at > last_sync |
| ID-Based | Log tablolarÄ± | WHERE id > last_id |
| Date Partition | SatÄ±ÅŸ verileri | GÃ¼nÃ¼ sil, yeniden yaz |
| Full Refresh | KÃ¼Ã§Ã¼k tablolar | Truncate + Insert |

### ETL UI AyarlarÄ±
- Sync sÄ±klÄ±ÄŸÄ±: 15dk, 1 saat, gÃ¼nlÃ¼k, manuel
- Referans kolon seÃ§imi (tarih, ID)
- SatÄ±r limiti (max 100K)
- Retry politikasÄ±
- Hata bildirimi

---

## ğŸ” GÃœVENLÄ°K

### Authentication
- JWT (15dk access token + 7 gÃ¼n refresh token)
- 2FA (TOTP)
- Password hashing: bcrypt (salt rounds: 12)

### Authorization
- RBAC (Role-Based Access Control)
- Tenant isolation (her sorguya tenant_id filtresi)

### API Security
- Rate limiting (100 req/min normal, 500 premium)
- CORS whitelist
- Helmet.js (security headers)
- SQL injection prevention (parameterized queries)

---

## ğŸ›¡ï¸ DAYANIKLILIK (Resilience)

### Circuit Breaker
```javascript
// ClickHouse Ã§Ã¶kerse Redis cache'ten dÃ¶n
breaker.fallback(() => redis.get('last_known_data'));
```

### Graceful Degradation
```javascript
// Bir widget hata verse diÄŸerleri Ã§alÄ±ÅŸÄ±r
const results = await Promise.allSettled([...widgets]);
```

### Query Timeout
```javascript
// Uzun sorgu sunucuyu kilitlemez (10s max)
await clickhouse.query(sql, { timeout: 10000 });
```

### Health Checks
```javascript
GET /health/live   // Uygulama Ã§alÄ±ÅŸÄ±yor mu?
GET /health/ready  // TÃ¼m baÄŸÄ±mlÄ±lÄ±klar hazÄ±r mÄ±?
```

---

## ğŸ“± MOBÄ°L MÄ°MARÄ°

### Capacitor (Native)
- iOS ve Android native app
- AynÄ± React kodu
- Push notification, biometrics

### Mobile-First API
- GraphQL ile sadece gerekli alanlar
- Offline-first (IndexedDB sync)

---

## ğŸ“ KODLAMA KURALLARI

### TypeScript - Strict Mode ZORUNLU
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

### API Response Format - Her Zaman camelCase
```javascript
{
  "success": true,
  "data": { "userId": "1", "userName": "Ali" }
}
```

### Error Response Format
```javascript
{
  "success": false,
  "errorCode": "AUTH_001",
  "message": "GeÃ§ersiz token"
}
```

### Naming Conventions
- Components: PascalCase (Dashboard.tsx)
- Functions: camelCase (fetchData)
- Constants: UPPER_SNAKE_CASE (API_BASE_URL)
- Database: snake_case (user_preferences)

---

## âŒ DÄ°NAMO'DAN Ã–ÄRENÄ°LEN DERSLER (YAPMA!)

1. Monolitik baÅŸlayÄ±p sonra microservices'e geÃ§me â†’ BaÅŸtan 5 servis
2. Widget'Ä± 2 tabloya kaydetme â†’ Tek components tablosu
3. API'de snake_case/camelCase karÄ±ÅŸÄ±klÄ±ÄŸÄ± â†’ Sadece camelCase
4. Waterfall API calls â†’ Tek endpoint /dashboard/full
5. Mock data fallback (production'da) â†’ Sadece development'ta
6. Context API ile state â†’ Zustand
7. any tipi kullanma â†’ Strict TypeScript
8. Cache sonradan ekleme â†’ Redis baÅŸtan
9. Her serviste farklÄ± error handling â†’ Merkezi AppError class
10. stores tablosu hem config hem mÃ¼ÅŸteri DB'de â†’ Net ayrÄ±m

---

## ğŸ¯ PERFORMANS HEDEFLERÄ°

| Metrik | Hedef |
|--------|-------|
| Ä°lk dashboard yÃ¼klemesi | < 500ms |
| Sonraki navigasyon (cache) | < 100ms |
| Real-time gÃ¼ncelleme | < 50ms |
| 100K satÄ±r tablo render | 60 FPS |

---

## ğŸ“¦ BAÅLANGIÃ‡ ADIMLARI

### Phase 1: Temel AltyapÄ±
1. [ ] Docker setup (PostgreSQL, ClickHouse, Redis)
2. [ ] 5 microservice boilerplate
3. [ ] Shared modules (db, auth, cache, errors, logger)
4. [ ] API Gateway
5. [ ] Frontend boilerplate (Vite + React + Zustand)

### Phase 2: Core Features
1. [ ] Auth (login, JWT, 2FA)
2. [ ] User/Tenant management
3. [ ] Data connections (DB, API, Excel)
4. [ ] ETL engine
5. [ ] Dashboard designer

### Phase 3: Analytics
1. [ ] ClickHouse integration
2. [ ] Materialized views
3. [ ] KPI calculation
4. [ ] Real-time (WebSocket)
5. [ ] Cache layer

### Phase 4: Polish
1. [ ] Mobile (Capacitor)
2. [ ] Offline support
3. [ ] Monitoring
4. [ ] Performance optimization

---

## ğŸ”’ KULLANICI KURALLARI

- Mikroservis mimarisi kullanÄ±lacak
- Ã–ncelik sayfa performansÄ± ve hÄ±zlÄ± Ã§alÄ±ÅŸma
- 500 kullanÄ±cÄ± aynÄ± anda desteklenmeli
- TÃ¼m sayfalar responsive
- TÃ¼m menÃ¼ ve baÅŸlÄ±klar parametrik
- Siber tehditler dÃ¼ÅŸÃ¼nÃ¼lerek geliÅŸtir
- Ayarlar veritabanÄ±nda saklanacak
- Hata durumunda uygulama Ã§Ã¶kmeyecek (Error Boundary)
- Her widget izole (WidgetErrorBoundary)
- GitHub'a push iÃ§in kullanÄ±cÄ± onayÄ± gerekli
- Yedek klasÃ¶rÃ¼: backupapp/

---

## ğŸ“… VERSÄ°YON GEÃ‡MÄ°ÅÄ°

| Tarih | Versiyon | AÃ§Ä±klama |
|-------|----------|----------|
| 2025-12-20 | v0.0.1 | Proje oluÅŸturuldu, mimari kararlar belirlendi |

---

## ğŸ·ï¸ PROJE BÄ°LGÄ°LERÄ°

- **Proje AdÄ±**: Clixer
- **BaÅŸlangÄ±Ã§**: 20 AralÄ±k 2025
- **Ã–nceki Proje**: Dinamo Cockpit (park edildi)
- **AmaÃ§**: Power BI rakibi enterprise analytics platform
- **Motto**: "OlaÄŸanÃ¼stÃ¼ Veri HÄ±zÄ±"

---

## ğŸ”· ClickHouse EMBED & NO-CODE ETL MÄ°MARÄ°SÄ°

### Temel Prensip
> "ClickHouse embed olarak Ã§alÄ±ÅŸÄ±r. Dashboard ASLA mÃ¼ÅŸteri DB'ye direkt baÄŸlanmaz.
> Kaynak ne olursa olsun: Kaynak â†’ ETL â†’ ClickHouse â†’ Dashboard"

### ClickHouse Tablo OluÅŸturma (UI Ãœzerinden - No-Code)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UI AKIÅI (No-Code)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADIM 1: Veri BaÄŸlantÄ±sÄ± OluÅŸtur
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BaÄŸlantÄ± Tipi:  â—‹ Database           â”‚
â”‚                  â—‹ API                 â”‚
â”‚                  â—‹ Excel/CSV           â”‚
â”‚                                        â”‚
â”‚  [MSSQL seÃ§ildi]                       â”‚
â”‚  Host: 192.168.1.100                   â”‚
â”‚  Port: 1433                            â”‚
â”‚  Database: ERP_PROD                    â”‚
â”‚  User: ******                          â”‚
â”‚  Password: ******                      â”‚
â”‚                                        â”‚
â”‚  [BaÄŸlantÄ±yÄ± Test Et] [Kaydet]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADIM 2: Kaynak Tablo/View SeÃ§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KullanÄ±labilir Tablolar:              â”‚
â”‚  â˜ dbo.Customers                       â”‚
â”‚  â˜‘ dbo.DailySales                      â”‚
â”‚  â˜ dbo.Products                        â”‚
â”‚  â˜ dbo.Inventory                       â”‚
â”‚                                        â”‚
â”‚  [Ã–nizle] [Ä°leri]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADIM 3: Kolon SeÃ§imi ve Mapping
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kaynak Kolon     â†’ Clixer Kolon       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜‘ sale_date      â†’ sale_date (Date)   â”‚
â”‚  â˜‘ store_id       â†’ store_id (String)  â”‚
â”‚  â˜‘ amount         â†’ amount (Decimal)   â”‚
â”‚  â˜‘ quantity       â†’ quantity (Int)     â”‚
â”‚  â˜ created_by     â†’ (dahil etme)       â”‚
â”‚  â˜ modified_at    â†’ (dahil etme)       â”‚
â”‚                                        â”‚
â”‚  [Geri] [Ä°leri]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADIM 4: ETL KurallarÄ±
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dataset AdÄ±: GÃ¼nlÃ¼k SatÄ±ÅŸlar          â”‚
â”‚                                        â”‚
â”‚  Sync Stratejisi:                      â”‚
â”‚  â—‹ Timestamp-Based (DeÄŸiÅŸenleri Ã§ek)   â”‚
â”‚    â””â”€ Referans Kolon: [modified_at â–¼]  â”‚
â”‚  â—‹ ID-Based (Yeni kayÄ±tlarÄ± Ã§ek)       â”‚
â”‚    â””â”€ Referans Kolon: [id â–¼]           â”‚
â”‚  â—‹ Date Partition (GÃ¼nÃ¼ yenile)        â”‚
â”‚    â””â”€ Tarih Kolonu: [sale_date â–¼]      â”‚
â”‚  â—‹ Full Refresh (Her seferinde tÃ¼mÃ¼)   â”‚
â”‚                                        â”‚
â”‚  Sync SÄ±klÄ±ÄŸÄ±:                         â”‚
â”‚  â—‹ 15 dakika  â—‹ 1 saat  â—‹ GÃ¼nlÃ¼k       â”‚
â”‚  â—‹ HaftalÄ±k   â—‹ Manuel                 â”‚
â”‚                                        â”‚
â”‚  SatÄ±r Limiti: [100000]                â”‚
â”‚  Hata Durumunda: [3 kez dene, bildir]  â”‚
â”‚                                        â”‚
â”‚  [Geri] [Dataset OluÅŸtur]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Arka Planda Ne Olur?

```javascript
// data-service: Dataset oluÅŸturulduÄŸunda
async function createDataset(config) {
  // 1. PostgreSQL'e dataset config kaydet
  await postgres.insert('datasets', {
    id: uuid(),
    name: config.name,
    connection_id: config.connectionId,
    source_table: config.sourceTable,
    column_mapping: config.columnMapping,
    sync_strategy: config.syncStrategy,
    sync_schedule: config.syncSchedule,
    reference_column: config.referenceColumn,
    row_limit: config.rowLimit
  });

  // 2. ClickHouse'da tablo OTOMATIK oluÅŸtur
  const createTableSQL = generateClickHouseTable(config);
  await clickhouse.query(createTableSQL);
  
  // 3. Ä°lk sync'i baÅŸlat
  await etlQueue.add('initial_sync', { datasetId: config.id });
}

// ClickHouse tablo dinamik oluÅŸturma
function generateClickHouseTable(config) {
  const columns = config.columnMapping.map(col => 
    `${col.targetName} ${mapToClickHouseType(col.type)}`
  ).join(',\n  ');

  return `
    CREATE TABLE IF NOT EXISTS ${config.name} (
      ${columns},
      _synced_at DateTime DEFAULT now()
    )
    ENGINE = MergeTree()
    PARTITION BY toYYYYMM(${config.dateColumn || '_synced_at'})
    ORDER BY (${config.orderByColumns.join(', ')})
  `;
}
```

### ETL Process Isolation (Uygulama Etkilenmez!)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROCESS Ä°ZOLASYONU                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UYGULAMA KATMANI  â”‚     â”‚     ETL KATMANI     â”‚
â”‚   (Ana Process)     â”‚     â”‚  (AyrÄ± Process)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ auth-service      â”‚     â”‚ â€¢ etl-worker        â”‚
â”‚ â€¢ core-service      â”‚     â”‚ â€¢ Bull Queue        â”‚
â”‚ â€¢ analytics-service â”‚     â”‚ â€¢ Job Scheduler     â”‚
â”‚ â€¢ notification-svc  â”‚     â”‚                     â”‚
â”‚ â€¢ Frontend          â”‚     â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kaynak: Redis Cache â”‚     â”‚ Hedef: ClickHouse   â”‚
â”‚         ClickHouse  â”‚     â”‚        (yazma)      â”‚
â”‚         (okuma)     â”‚     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â”‚    ETL Ã§alÄ±ÅŸÄ±rken         â”‚
         â”‚    dashboard YAVAÅLAMAZ!  â”‚
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Docker Compose - Process Isolation

```yaml
services:
  # UYGULAMA KATMANI (Group 1)
  analytics-service:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
    # Sadece ClickHouse'tan OKUR

  # ETL KATMANI (Group 2 - AyrÄ±)
  etl-worker:
    build: ./services/etl-worker
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G  # ETL iÃ§in daha fazla RAM
    depends_on:
      - clickhouse
      - redis
    # ClickHouse'a YAZAR
    # AÄŸÄ±r iÅŸ yÃ¼kÃ¼ ana uygulamayÄ± etkilemez
```

### ETL Worker Mimarisi

```javascript
// services/etl-worker/index.js
const Queue = require('bull');

const etlQueue = new Queue('etl-jobs', { redis });

// Job processor
etlQueue.process('sync', async (job) => {
  const { datasetId, strategy } = job.data;
  
  // 1. Dataset config'i PostgreSQL'den al
  const dataset = await getDatasetConfig(datasetId);
  
  // 2. Kaynak baÄŸlantÄ±sÄ±nÄ± aÃ§
  const sourceConn = await connectToSource(dataset.connection);
  
  // 3. Stratejiye gÃ¶re veri Ã§ek
  let data;
  switch (strategy) {
    case 'timestamp':
      data = await sourceConn.query(
        `SELECT * FROM ${dataset.sourceTable} 
         WHERE ${dataset.referenceColumn} > $1`,
        [dataset.lastSyncValue]
      );
      break;
    case 'date_partition':
      // BugÃ¼nÃ¼ sil, yeniden yaz
      await clickhouse.query(
        `ALTER TABLE ${dataset.name} DELETE WHERE toDate(${dataset.dateColumn}) = today()`
      );
      data = await sourceConn.query(
        `SELECT * FROM ${dataset.sourceTable} WHERE ${dataset.dateColumn} = CURRENT_DATE`
      );
      break;
    // ... diÄŸer stratejiler
  }
  
  // 4. ClickHouse'a yaz
  await clickhouse.insert(dataset.name, data);
  
  // 5. Cache'i invalidate et
  await redis.publish('etl_completed', { datasetId });
  
  // 6. Son sync bilgisini gÃ¼ncelle
  await updateLastSync(datasetId, new Date());
  
  return { rowsProcessed: data.length };
});

// Scheduler
etlQueue.process('schedule', async (job) => {
  const datasets = await getScheduledDatasets(job.data.interval);
  for (const ds of datasets) {
    await etlQueue.add('sync', { datasetId: ds.id, strategy: ds.syncStrategy });
  }
});
```

### Veri AkÄ±ÅŸÄ± Ã–zeti

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLÄ°XER VERÄ° AKIÅI                          â”‚
â”‚              "Kaynak ne olursa olsun â†’ ClickHouse"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  MSSQL  â”‚     â”‚   API   â”‚     â”‚  Excel  â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚               â”‚               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   ETL Worker   â”‚  â† AyrÄ± process
                 â”‚  (Bull Queue)  â”‚  â† Kaynak kaybetmez
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         ClickHouse            â”‚
          â”‚     (Embed - Clixer iÃ§inde)   â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚  â”‚  Materialized Views     â”‚  â”‚  â† Pre-aggregation
          â”‚  â”‚  (Otomatik hesaplanmÄ±ÅŸ) â”‚  â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Redis Cache   â”‚  â† L3 Cache
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   Dashboard    â”‚  â† Ultra hÄ±zlÄ±!
                 â”‚   (Frontend)   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš ï¸ KRÄ°TÄ°K KURALLAR

1. **ClickHouse tablolarÄ± UI'dan oluÅŸturulur** - Kod yazÄ±lmaz
2. **TÃ¼m ETL ayarlarÄ± UI'dan yapÄ±lÄ±r** - No-code
3. **ETL ayrÄ± process'te Ã§alÄ±ÅŸÄ±r** - Ana uygulama etkilenmez
4. **Dashboard sadece ClickHouse'tan okur** - MÃ¼ÅŸteri DB'ye direkt baÄŸlanmaz
5. **Kaynak ne olursa olsun akÄ±ÅŸ aynÄ±** - MSSQL/API/Excel â†’ ETL â†’ ClickHouse â†’ Dashboard
6. **Materialized Views ile pre-aggregation** - Dashboard'da hesaplama yok

---

## ğŸ”´ CURSOR Ä°LETÄ°ÅÄ°M KURALLARI (KRÄ°TÄ°K!)

### ASLA YAPMA:
1. **KullanÄ±cÄ± "okunmuyor/gÃ¶rÃ¼nmÃ¼yor" dediÄŸinde** â†’ Sadece metin rengini deÄŸiÅŸtirme! Ã–nce arka plan, kontrast, tema uyumu kontrol et.
2. **AynÄ± hatayÄ± 2+ kez tekrarlama** â†’ 2. denemede Ã§alÄ±ÅŸmadÄ±ysa DUR, sorunu yeniden analiz et.
3. **Ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ analiz etmeden kod yazma** â†’ GÃ¶rsel geri bildirim varsa Ã¶nce onu incele.
4. **KullanÄ±cÄ±nÄ±n sÃ¶ylediÄŸini tam anlamadan aksiyon alma** â†’ Emin deÄŸilsen SOR.
5. **YÃ¼zeysel Ã§Ã¶zÃ¼m deneme** â†’ KÃ¶k nedeni bul, semptomlarÄ± deÄŸil.

### HER ZAMAN YAP:
1. **GÃ¶rsel sorunlarda** â†’ Arka plan rengi, metin rengi, border, shadow, opacity HEPSÄ°NÄ° kontrol et.
2. **Tema sorunlarÄ±nda** â†’ Light, Dark, Corporate, Midnight, Ember - TÃœM temalarda test et.
3. **"Ã‡alÄ±ÅŸmÄ±yor" denildiÄŸinde** â†’ Console log, network tab, backend log - HEPSÄ°NÄ° kontrol et.
4. **2. denemede baÅŸarÄ±sÄ±zsa** â†’ KullanÄ±cÄ±ya sor: "Tam olarak ne gÃ¶rÃ¼yorsun? Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ paylaÅŸabilir misin?"
5. **KarmaÅŸÄ±k sorunlarda** â†’ Ã–nce analiz yap, sonra plan sun, onay al, sonra uygula.

### RENK KURALLARI (UI):
- **AÃ§Ä±k tema metin:** `text-gray-600` veya `text-gray-700` (ASLA aÃ§Ä±k renkler)
- **Koyu tema metin:** `text-gray-300` veya `text-gray-400`
- **Bilgi kutularÄ±:** Arka plan ÅEFFAF veya Ã§ok hafif, border belirgin
- **Kontrast:** WCAG AA standardÄ± (4.5:1 oran)

### HATA DÃ–NGÃœSÃœNDEN Ã‡IKIÅ:
```
Hata â†’ DÃ¼zelt â†’ Hata devam ediyor â†’ DURMA NOKTASI!
â†“
1. Ã–nceki denemeleri listele
2. Ortak hatayÄ± bul
3. FarklÄ± yaklaÅŸÄ±m dÃ¼ÅŸÃ¼n
4. KullanÄ±cÄ±ya sor
5. Onay al â†’ Uygula
```

---

bu Ã¼rÃ¼n enterprise mÃ¼ÅŸteriler iÃ§in tasarlanmÄ±ÅŸtÄ±r.
bÃ¼yÃ¼k veri setleri ile Ã§alÄ±ÅŸÄ±lacak ÅŸekilde her kurgu ve alt yapÄ± dÃ¼ÅŸÃ¼nÃ¼lmeli
kod kalitesi ve performansÄ± her zaman Ã¶nceliklidir.
bu mimariyi tasarlarken her zaman dÃ¼nyanÄ±n en iyi kod mimarÄ± ve perfromans lideri gibi dÃ¼ÅŸÃ¼nerek kod yaz. ileriyi gÃ¶r bÃ¼yÃ¼k dÃ¼ÅŸÃ¼n.
aynÄ± anda 1000 kiÅŸi bu uygulamadan veri Ã§ekecek konforda ve alt yapÄ± mimarisind olacak.
ÅŸirket kim olursa olsun genel mÃ¼dÃ¼r, yÃ¶netici, bÃ¶lge mÃ¼dÃ¼rÃ¼, maÄŸaza mÃ¼dÃ¼rÃ¼ kavramÄ± gibi jenerik kavramlar deÄŸiÅŸsede mantÄ±k aynÄ± olacaktÄ±r.
herkes kendi yetki seviyesinde kendine atanmÄ±ÅŸ store'larÄ± gÃ¶rÃ¼r.
en Ã¶nemli kÄ±sÄ±mlardan biri de kod ve uygulama gÃ¼venliÄŸi. kod yazarken bir siber istihbarat uzmanÄ± gibi dÃ¼ÅŸÃ¼n. dÄ±ÅŸardan gelecek tÃ¼m olasÄ± ataklarÄ± dÃ¼ÅŸÃ¼nerek mimariyi tasarla. kod ve uygulama gÃ¼venliÄŸi sÄ±zma senaryolarÄ±nÄ± dÃ¼ÅŸÃ¼n.
yapÄ±lan geliÅŸtirmelerin ne olduÄŸu her baÅŸarÄ±lÄ± iÅŸlemden sonra historye yazÄ±lÄ±r ve cursor olasÄ± bir soruna son geliÅŸtirmelerin ne olduÄŸunu bilir. bunu asla unutma.
uygulama piyasadki powerbi gibi qliksense gibi bÃ¼yÃ¼klerle yarÄ±ÅŸacak. Ã¶ne Ã§Ä±kan Ã¶zelliklerimiz olmalÄ±.esnek ÅŸÄ±k. ayrÄ±ca clickhouse entegreli bir mekanizma ile 500.000.000 milyon satÄ±r veri de olsa hÄ±zlÄ± Ã§alÄ±ÅŸan aynÄ± anda 1000 kiÅŸi girerek yavaÅŸlamayan bir mimari olacak.
bu uygulama tamamlandÄ±ktan sonra ilk iki mÃ¼ÅŸterisinde biri restoran zinciri diÄŸeri de 50.000 Ã¶ÄŸrencili bir Ã¼niversite olacak.
UI'Da responsive yapÄ±ya her geliÅŸtirmede dikkat edilecek.

---

## ğŸ”’ BIG DATA VE VERÄ° TUTARLILIK KURALLARI

### âš ï¸ KRÄ°TÄ°K: DUPLICATE VERÄ° ASLA OLMAMALI!

Her ETL iÅŸleminde veri tutarlÄ±lÄ±ÄŸÄ± garanti altÄ±na alÄ±nmalÄ±dÄ±r:

### 1. ClickHouse Tablo OluÅŸturma KurallarÄ±

```sql
-- âœ… DOÄRU: ReplacingMergeTree + Partition + DoÄŸru Tipler
CREATE TABLE dataset_xxx (
  id String,                    -- Primary key
  tarih Date,                   -- Partition kolonu = Date tipi
  magaza_id String,
  tutar Float64,                -- SayÄ±sal deÄŸer = Float64
  adet Int32,                   -- Tam sayÄ± = Int32
  _synced_at DateTime DEFAULT now()
)
ENGINE = ReplacingMergeTree(_synced_at)  -- âœ… Duplicate Ã¶nler!
PARTITION BY toYYYYMM(tarih)              -- âœ… AylÄ±k partition
ORDER BY (tarih, id)                       -- âœ… Unique key ile sÄ±ralama

-- âŒ YANLIÅ: MergeTree + String tipler
CREATE TABLE dataset_xxx (
  tarih String,        -- âŒ Partition Ã§alÄ±ÅŸmaz!
  tutar String,        -- âŒ Performans kaybÄ±!
)
ENGINE = MergeTree()   -- âŒ Duplicate birikir!
```

### 2. Tip DÃ¶nÃ¼ÅŸÃ¼m KurallarÄ±

| Kaynak Tip | ClickHouse Tip | Notlar |
|------------|----------------|--------|
| date, timestamp, datetime | Date veya DateTime | Partition iÃ§in Date tercih |
| int, integer, bigint | Int32 veya Int64 | |
| float, decimal, numeric | Float64 | |
| varchar, text, char | String | |
| boolean, bool | UInt8 | |

### 3. Partition KurallarÄ±

- **Partition kolonu ZORUNLU Date veya DateTime tipinde olmalÄ±**
- String tipinde kolon partition key olamaz!
- Partition silme iÅŸlemi: `ALTER TABLE xxx DELETE WHERE partition = 'YYYYMM'`
- Sliding window: Son N gÃ¼n/ay partition'larÄ± refresh edilir

### 4. ETL Job KurallarÄ±

```
Her ETL job sonrasÄ±:
1. OPTIMIZE TABLE xxx FINAL Ã§alÄ±ÅŸtÄ±r (duplicate temizliÄŸi)
2. Kaynak satÄ±r sayÄ±sÄ± vs Hedef satÄ±r sayÄ±sÄ± karÅŸÄ±laÅŸtÄ±r
3. %1'den fazla fark varsa UYARI logla
4. TutarlÄ±lÄ±k raporunu etl_jobs tablosuna kaydet
```

### 5. Duplicate Ã–nleme MekanizmalarÄ±

1. **ReplacingMergeTree Engine**: AynÄ± ORDER BY key'e sahip satÄ±rlardan en yeni (_synced_at) kalÄ±r
2. **OPTIMIZE FINAL**: Her sync sonrasÄ± Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r, duplicate'larÄ± fiziksel olarak siler
3. **Partition Delete Before Insert**: Date partition'larda Ã¶nce sil, sonra ekle
4. **ID Based Deduplication**: ORDER BY'da mutlaka unique key (id) olmalÄ±

### 6. Veri TutarlÄ±lÄ±k KontrolÃ¼

```javascript
// Her sync sonrasÄ± zorunlu kontrol
async function validateDataConsistency(dataset, sourceCount) {
  const targetCount = await clickhouse.query(`SELECT count() FROM ${dataset.table}`);
  const tolerance = Math.ceil(sourceCount * 0.01); // %1 tolerans
  
  if (Math.abs(targetCount - sourceCount) > tolerance) {
    logger.warn('DATA CONSISTENCY WARNING', { sourceCount, targetCount });
  }
  
  // OPTIMIZE Ã§alÄ±ÅŸtÄ±r
  await clickhouse.execute(`OPTIMIZE TABLE ${dataset.table} FINAL`);
}
```

### 7. UI Kontrolleri

- Dataset oluÅŸtururken partition kolonu seÃ§ilmiÅŸse tip otomatik Date olmalÄ±
- Engine varsayÄ±lan olarak ReplacingMergeTree seÃ§ili gelmeli
- Sync sonrasÄ± UI'da "Toplam SatÄ±r" = ClickHouse'daki gerÃ§ek satÄ±r sayÄ±sÄ± (OPTIMIZE sonrasÄ±)

### 8. NO-CODE PRENSÄ°BÄ°

- KullanÄ±cÄ± hiÃ§bir SQL yazmadan dataset oluÅŸturabilmeli
- TÃ¼m tip dÃ¶nÃ¼ÅŸÃ¼mleri otomatik yapÄ±lmalÄ±
- Partition stratejisi UI'dan seÃ§ilebilmeli
- Hata durumunda anlaÅŸÄ±lÄ±r TÃ¼rkÃ§e mesajlar gÃ¶sterilmeli
- Her ÅŸey UI'dan yÃ¶netilebilmeli (ETL Worker baÅŸlat/durdur dahil)

---

## ğŸ“‹ DEÄÄ°ÅÄ°KLÄ°K GEÃ‡MÄ°ÅÄ° (History)

### v1.0.1 - 22 AralÄ±k 2025

**Big Data & Veri TutarlÄ±lÄ±k GÃ¼ncellemesi**

1. âœ… AkÄ±llÄ± tip dÃ¶nÃ¼ÅŸÃ¼m sistemi eklendi (SQL â†’ ClickHouse)
2. âœ… ReplacingMergeTree varsayÄ±lan engine olarak ayarlandÄ±
3. âœ… Her sync sonrasÄ± OPTIMIZE FINAL Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor
4. âœ… Veri tutarlÄ±lÄ±k kontrolÃ¼ (kaynak vs hedef karÅŸÄ±laÅŸtÄ±rma)
5. âœ… Duplicate temizleme ve raporlama
6. âœ… AkÄ±llÄ± tarih formatÄ± dÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ (tÃ¼m formatlar destekleniyor)
7. âœ… Partition kolonu otomatik Date tipine dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼yor
8. âœ… ORDER BY'da unique key (id) zorunlu hale getirildi

**DÃ¼zeltilen Sorunlar:**
- gunluk_satis2: 27M duplicate satÄ±r temizlendi, doÄŸru tiplerle yeniden oluÅŸturuldu
- String tipli tarih kolonlarÄ± artÄ±k Date'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼yor
- Partition key boÅŸ kalma sorunu dÃ¼zeltildi

### v1.0.2 - 22 AralÄ±k 2025

**Partition Format UyumsuzluÄŸu DÃ¼zeltmesi**

1. âœ… Partition silme formatÄ± artÄ±k tablo partition_key'inden okunuyor
2. âœ… Dataset ayarÄ± (UI) ile tablo yapÄ±sÄ± (ClickHouse) arasÄ±nda tutarlÄ±lÄ±k kontrolÃ¼ eklendi
3. âœ… Format uyumsuzluÄŸu loglanÄ±yor (beklenen vs gerÃ§ekleÅŸen)
4. âœ… Sync butonuna loading ve feedback mesajÄ± eklendi
5. âœ… Duplicate job Ã¶nleme dÃ¼zeltildi (tek job Ã§alÄ±ÅŸÄ±yor)

**Ã–ÄŸrenilen Ders:**
> Partition silme formatÄ± ASLA dataset ayarÄ±ndan alÄ±nmamalÄ±!
> Her zaman `system.tables.partition_key` okunarak GERÃ‡EK format belirlenmeli.
> UI ayarÄ± ile ClickHouse tablo yapÄ±sÄ± UYUMSUZ olabilir!

**TutarlÄ±lÄ±k KontrolÃ¼ KuralÄ±:**
```javascript
// Sync baÅŸlamadan Ã¶nce:
1. Tablonun partition_key'ini oku (system.tables)
2. Dataset ayarÄ±ndaki partition_type ile karÅŸÄ±laÅŸtÄ±r
3. Uyumsuzluk varsa UYARI logla
4. GerÃ§ek format ile partition sil (dataset ayarÄ±nÄ± yoksay)
```

### v1.0.3 - 22 AralÄ±k 2025

**Finans Parametrik GÃ¶rÃ¼nÃ¼rlÃ¼k & Dil Paketi**

1. âœ… "Amorti Edilemiyor" uyarÄ± kartÄ± iÃ§in gizle/gÃ¶ster ayarÄ± eklendi (`finance_show_amortization_warning`)
2. âœ… Amorti uyarÄ±sÄ± iÃ§in pozisyon bazlÄ± gÃ¶rÃ¼nÃ¼rlÃ¼k eklendi (`finance_amortization_positions`)
3. âœ… VarsayÄ±lan tema (default_theme) artÄ±k veritabanÄ±ndan doÄŸru okunuyor ve uygulanÄ±yor
4. âœ… Dil paketi sistemi (i18n) oluÅŸturuldu:
   - `frontend/src/i18n/translations.ts` - TÃ¼rkÃ§e ve Ä°ngilizce Ã§eviriler
   - `frontend/src/i18n/useTranslation.ts` - Ã‡eviri hook'u
   - TÃ¼m sayfa ve menÃ¼ metinleri iÃ§in Ã§eviri desteÄŸi
5. âœ… Rapor yetkilendirme sistemi: `allowed_positions` kolonu ile pozisyon bazlÄ± rapor eriÅŸimi
6. âœ… Test kullanÄ±cÄ±larÄ± oluÅŸturuldu (her pozisyon iÃ§in 1 kullanÄ±cÄ± - LDAP simÃ¼lasyonu)
7. âœ… Finans sayfasÄ±ndaki ROI, Kar MarjÄ±, Gider DaÄŸÄ±lÄ±mÄ±, Ayarlar sekmesi iÃ§in pozisyon kontrolÃ¼
8. âœ… DesignerPage'de rapor oluÅŸtururken pozisyon seÃ§imi UI'Ä± eklendi
9. âœ… DashboardPage ve AnalysisPage'de allowedPositions filtresi uygulandÄ±

**Yeni Ayarlar (system_settings):**
- `finance_show_amortization_warning`: boolean - Amorti uyarÄ±sÄ± gÃ¶ster/gizle
- `finance_amortization_positions`: string[] - Bu pozisyonlar amorti uyarÄ±sÄ±nÄ± gÃ¶rebilir

**Yeni Dosyalar:**
- `/frontend/src/i18n/translations.ts` - Ã‡eviri metinleri (TR/EN)
- `/frontend/src/i18n/useTranslation.ts` - useTranslation hook
- `/frontend/src/i18n/index.ts` - i18n export

**VeritabanÄ± DeÄŸiÅŸiklikleri:**
- `designs` tablosuna `allowed_positions TEXT[]` kolonu eklendi

**Yedekleme:**
- Backup: `backups/v1.0.3_20251222_234356/`
- PostgreSQL dump, ClickHouse metadata, kod yedeÄŸi dahil

### v1.0.4 - 23 AralÄ±k 2025

**Azure SQL Entegrasyonu & Veri FormatÄ± Standardizasyonu**

1. âœ… Azure SQL baÄŸlantÄ± desteÄŸi eklendi
   - `encrypt: true` otomatik olarak Azure SQL iÃ§in aktif
   - `.database.windows.net` host'larÄ± otomatik algÄ±lanÄ±yor
   
2. âœ… MSSQL sorgu desteÄŸi dÃ¼zeltildi
   - `LIMIT` yerine `TOP` kullanÄ±lÄ±yor (MSSQL syntax)
   - `SELECT * FROM table` â†’ `SELECT TOP 1000 * FROM table`
   
3. âœ… Columns endpoint eklendi
   - `/connections/:id/tables/:tableName/columns` - Tablo kolonlarÄ±nÄ± listele
   - PostgreSQL, MSSQL, MySQL desteÄŸi
   
4. âœ… Tarih formatÄ± standardizasyonu (TÃœM baÄŸlantÄ±lar iÃ§in)
   - **Problem**: JavaScript Date objeleri ISO formatÄ±na (`2025-12-23T16:26:58.786Z`) dÃ¶nÃ¼ÅŸÃ¼yordu
   - **Ã‡Ã¶zÃ¼m**: Orijinal veritabanÄ± formatlarÄ± korunuyor
   
   | BaÄŸlantÄ± | Format | Ã–rnek |
   |----------|--------|-------|
   | PostgreSQL | `YYYY-MM-DD HH:mm:ss.SSS` | `2025-12-23 16:26:58.786` |
   | MSSQL | `YYYY-MM-DD HH:mm:ss.SSSSSSS` | `2025-12-23 16:26:58.7860000` |
   | MySQL | `YYYY-MM-DD HH:mm:ss` | `2025-12-23 16:26:58` (dateStrings: true) |

5. âœ… BaÄŸlantÄ± dÃ¼zenleme (Edit) Ã¶zelliÄŸi eklendi
   - DataPage'de her baÄŸlantÄ± iÃ§in Edit butonu
   - Mevcut baÄŸlantÄ± bilgilerini gÃ¼ncelleme

6. âœ… MySQL karakter kodlama dÃ¼zeltildi
   - `charset: 'utf8mb4'` tÃ¼m MySQL baÄŸlantÄ±larÄ±nda aktif
   - TÃ¼rkÃ§e karakterler doÄŸru gÃ¶rÃ¼nÃ¼yor

7. âœ… Restoran zinciri test veritabanÄ± scripti oluÅŸturuldu
   - `scripts/azure-restaurant-db.sql` - Azure SQL iÃ§in
   - Pozisyonlar, bÃ¶lgeler, maÄŸazalar, kullanÄ±cÄ±lar, kategoriler, Ã¼rÃ¼nler, satÄ±ÅŸlar
   - 2000+ transaction Ã¶rnek veri

**DeÄŸiÅŸtirilen Dosyalar:**
- `services/data-service/src/index.ts` - Azure SQL, TOP syntax, columns endpoint, tarih formatÄ±
- `frontend/src/pages/DataPage.tsx` - Edit butonu, baÄŸlantÄ± dÃ¼zenleme
- `scripts/azure-restaurant-db.sql` - Restoran DB scripti (yeni)

**Test OrtamlarÄ±:**
- `docker/docker-compose.test.yml` - MSSQL, MySQL, LDAP test container'larÄ±
- MySQL ERP: 1M+ satÄ±ÅŸ kaydÄ±
- MySQL Ãœniversite: 50K Ã¶ÄŸrenci, 220K fatura

**Yedekleme:**
- Backup: `backups/v1.0.4_20251223_200702/`
- Kod yedeÄŸi: services, frontend, shared, scripts

### v1.0.5 - 23 AralÄ±k 2025

**SQL Modu & GeliÅŸmiÅŸ Tablo GÃ¶rÃ¼nÃ¼mÃ¼**

1. âœ… SQL Modu ile metrik oluÅŸturma
   - MetricsPage'de "SQL Modu" toggle eklendi
   - Serbest SQL sorgusu ile metrik tanÄ±mlama
   - `use_sql_mode` ve `custom_sql` kolonlarÄ± metrics tablosuna eklendi
   - `executeMetric` fonksiyonunda SQL modu desteÄŸi
   
2. âœ… GerÃ§ek tablo gÃ¶rÃ¼nÃ¼mÃ¼ (LIST tipi widgetlar)
   - Kart gÃ¶rÃ¼nÃ¼mÃ¼ yerine dÃ¼zgÃ¼n HTML tablo (`<table>`, `<thead>`, `<tbody>`)
   - Kolon baÅŸlÄ±klarÄ±, satÄ±rlar, sayfalama
   - Responsive tasarÄ±m
   - DashboardPage (Kokpit) ve AnalysisPage (DetaylÄ± Analiz) gÃ¼ncellendi

3. âœ… Backend gÃ¼ncellemeleri
   - `analytics-service`: Metrik kaydetme/gÃ¼ncelleme SQL modu desteÄŸi
   - `executeMetric`: SQL modu aktifse `custom_sql` Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor
   - Tablo adÄ± otomatik deÄŸiÅŸtirme (FROM/JOIN sonrasÄ±)

**VeritabanÄ± DeÄŸiÅŸiklikleri:**
```sql
ALTER TABLE metrics ADD COLUMN use_sql_mode BOOLEAN DEFAULT false;
ALTER TABLE metrics ADD COLUMN custom_sql TEXT;
```

**DeÄŸiÅŸtirilen Dosyalar:**
- `services/analytics-service/src/index.ts` - SQL modu desteÄŸi, executeMetric gÃ¼ncellendi
- `frontend/src/pages/MetricsPage.tsx` - SQL Modu UI, Metric interface gÃ¼ncellendi
- `frontend/src/pages/DashboardPage.tsx` - GerÃ§ek tablo gÃ¶rÃ¼nÃ¼mÃ¼
- `frontend/src/pages/AnalysisPage.tsx` - GerÃ§ek tablo gÃ¶rÃ¼nÃ¼mÃ¼

**Yedekleme:**
- Backup: `backups/v1.0.5_20251223_214154/`
- PostgreSQL dump, ClickHouse metadata, kod yedeÄŸi dahil (1.1GB)

### v1.0.6 - 24 AralÄ±k 2025

**ID-Based Incremental Sync & Progress Bar & ETL Ä°yileÅŸtirmeleri**

1. âœ… **ID-Based Incremental Sync** (GerÃ§ek Incremental!)
   - `syncById` fonksiyonu artÄ±k gerÃ§ek incremental sync yapÄ±yor
   - ClickHouse'tan `max(id)` alÄ±nÄ±yor
   - Kaynaktan `WHERE id > max_id` ile sadece yeni kayÄ±tlar Ã§ekiliyor
   - Mevcut tabloya **EKLENÄ°YOR** (silme yok!)
   - `source_query`'den tablo adÄ± Ã§Ä±karÄ±cÄ± (`extractTableFromQuery`) eklendi
   - `password_encrypted` kullanÄ±larak baÄŸlantÄ± ÅŸifresi dÃ¼zeltildi

2. âœ… **Progress Bar** (GerÃ§ek ZamanlÄ± Ä°lerleme)
   - Her batch'te (5000 satÄ±r) `rows_processed` gÃ¼ncelleniyor
   - Frontend her 2 saniyede refresh yapÄ±yor
   - "Kaynaktan veri Ã§ekiliyor..." mesajÄ± + pulse animasyon
   - YÃ¼zde gÃ¶sterimi ve tahmini kalan sÃ¼re
   - `ETLJob` interface'ine `jobId` eklendi
   - `processETLJob`'ta `etlJobId` sync fonksiyonlarÄ±na geÃ§iriliyor

3. âœ… **Dataset Ä°simleri ClickHouse'ta GÃ¶rÃ¼nÃ¼yor**
   - `db.queryAll()` kullanÄ±larak array dÃ¼zgÃ¼n dÃ¶nÃ¼yor
   - ClickHouse tablolarÄ± artÄ±k dataset ismi, sync stratejisi gÃ¶steriyor

4. âœ… **Sistem SaÄŸlÄ±ÄŸÄ± & ETL Monitoring**
   - Stuck job tespiti ve otomatik fail
   - Redis lock yÃ¶netimi (gÃ¶rÃ¼ntÃ¼leme, temizleme)
   - Worker crash detection UI uyarÄ±sÄ±
   - ClickHouse tablo yÃ¶netimi (liste, boyut, sil, optimize)

5. âœ… **Dataset Row Limit**
   - UI'dan satÄ±r limiti deÄŸiÅŸtirilebilir (1M, 10M, 50M, âˆ)
   - Her sync'te limit kadar satÄ±r Ã§ekiliyor

**Ã–nemli Kod DeÄŸiÅŸiklikleri:**
- `services/etl-worker/src/index.ts`:
  - `extractTableFromQuery()` fonksiyonu eklendi
  - `syncById()` gerÃ§ek incremental sync implementasyonu
  - `password` â†’ `password_encrypted` dÃ¼zeltmesi
  - `source_table` â†’ `sourceTableName` (query'den Ã§Ä±karÄ±lan)
  - `ETLJob` interface'ine `jobId` eklendi
  - `processETLJob`'ta `etlJobId` sync fonksiyonlarÄ±na geÃ§iriliyor

- `services/data-service/src/index.ts`:
  - `db.queryAll()` kullanÄ±mÄ± (running-jobs, stuck-jobs, clickhouse tables)
  - `row_limit` dataset API'ye eklendi

- `frontend/src/pages/DataPage.tsx`:
  - Progress bar UI (yÃ¼zde, kalan sÃ¼re, animasyon)
  - Auto-refresh 2 saniye (running job varken)
  - "Kaynaktan veri Ã§ekiliyor..." mesajÄ±

**Test SonuÃ§larÄ±:**
- Azure_Trans_iTem2: 1M â†’ 2M â†’ 3M â†’ 3.6M (incremental artÄ±ÅŸ âœ…)
- Progress bar Ã§alÄ±ÅŸÄ±yor: 0% â†’ 100% gÃ¶rsel ilerleme âœ…
- Dataset isimleri ClickHouse'ta gÃ¶rÃ¼nÃ¼yor âœ…

**Yedekleme:**
- Backup: `backups/v1.0.6_20251224_141028/`

### v1.0.7 - 24 AralÄ±k 2025

**Tip Uyumluluk KontrolÃ¼ & KalÄ±cÄ± DÃ¼zeltmeler**

1. âœ… **ID Kolonu Tip DÃ¼zeltmesi**
   - ID kolonu artÄ±k kaynak DB tipini koruyor (Int32, Int64)
   - Eskiden zorla String yapÄ±lÄ±yordu â†’ YANLIÅ!
   - UUID/GUID ise String, Integer ise Int32/Int64

2. âœ… **sourceType Backend'de Okunuyor**
   - UI'dan gelen `sourceType` artÄ±k backend'de iÅŸleniyor
   - `col.sourceType || col.type` eklendi

3. âœ… **ClickHouse max(id) CAST DÃ¼zeltmesi**
   - String tipli ID kolonlarÄ±nda `toInt64OrZero()` ile doÄŸru karÅŸÄ±laÅŸtÄ±rma
   - ID-based sync artÄ±k String ID'lerde de Ã§alÄ±ÅŸÄ±yor

4. âœ… **Count Verification**
   - Her sync sonrasÄ± kaynak ve hedef satÄ±r sayÄ±sÄ± karÅŸÄ±laÅŸtÄ±rÄ±lÄ±yor
   - %1'den fazla fark varsa uyarÄ± loglanÄ±yor

5. âœ… **KÄ±smi Yenileme (Partial Refresh)**
   - UI'dan "Son 7/30/90/180 GÃ¼n Yenile" seÃ§eneÄŸi
   - `/datasets/:id/partial-refresh` endpoint'i
   - Sadece seÃ§ilen tarih aralÄ±ÄŸÄ± sil-yaz

---

## ğŸ”´ KRÄ°TÄ°K KURAL: TÄ°P UYUMLULUK KONTROLÃœ

### MUTLAK KURAL: Sync Ã¶ncesi tip uyumluluk kontrolÃ¼ ZORUNLU!

**Prensip:** ClickHouse tablo tipleri ile kaynak DB tipleri UYUMLU OLMAK ZORUNDA.
Bu kural SQL Server, PostgreSQL, MySQL, API - TÃœM kaynaklar iÃ§in geÃ§erlidir!

### Tip DÃ¶nÃ¼ÅŸÃ¼m KurallarÄ± (SQL â†’ ClickHouse)

| Kaynak Tip (SQL) | ClickHouse Tip | Notlar |
|------------------|----------------|--------|
| int, integer | Int32 | |
| bigint, int8 | Int64 | |
| smallint, int2 | Int16 | |
| tinyint | Int8 | |
| float, real | Float32 | |
| double, decimal, numeric | Float64 | |
| varchar, text, nvarchar | String | |
| date | Date | Partition iÃ§in tercih |
| datetime, timestamp | DateTime | |
| boolean, bit | UInt8 | |
| uuid, uniqueidentifier | String | |

### ID Kolonu Ã–zel KuralÄ±

```javascript
// âŒ ESKÄ° YANLIÅ KOD
if (targetName === 'id') {
  chType = 'String'; // HER ID'YÄ° STRING YAPIYORDU!
}

// âœ… YENÄ° DOÄRU KOD
if (targetName === 'id') {
  if (chType.startsWith('Int')) {
    // Integer ID korunsun (Int32, Int64)
  } else if (sqlType.includes('uuid') || sqlType.includes('uniqueidentifier')) {
    chType = 'String'; // Sadece UUID ise String
  }
}
```

### Sync Ã–ncesi Kontrol (MUST!)

Dataset oluÅŸturulurken veya sync baÅŸlamadan Ã¶nce:

```javascript
// 1. Kaynak tablo tiplerini al
const sourceColumns = await getSourceColumns(connection, tableName);

// 2. ClickHouse tablo tiplerini al (varsa)
const chColumns = await clickhouse.describe(tableName);

// 3. KarÅŸÄ±laÅŸtÄ±r
for (const col of sourceColumns) {
  const expectedType = sqlToClickHouseType(col.type);
  const actualType = chColumns[col.name];
  
  if (actualType && !isCompatible(expectedType, actualType)) {
    throw new Error(`Tip uyumsuzluÄŸu: ${col.name} - Beklenen: ${expectedType}, Mevcut: ${actualType}`);
  }
}
```

### Uyumsuzluk Durumunda

1. **Tablo yok** â†’ DoÄŸru tiplerle oluÅŸtur
2. **Tip uyumsuz** â†’ HATA ver, sync baÅŸlatma!
3. **DÃ¼zeltme iÃ§in** â†’ Tabloyu sil, yeniden oluÅŸtur

### Neden Kritik?

| Durum | SonuÃ§ |
|-------|-------|
| ID String, veri Integer | max(id) yanlÄ±ÅŸ Ã§alÄ±ÅŸÄ±r, sync bozulur |
| Tarih String, veri Date | Partition Ã§alÄ±ÅŸmaz |
| SayÄ± String | Aggregation yanlÄ±ÅŸ sonuÃ§ verir |

**ASLA tip uyumsuzluÄŸu olan bir tablo ile sync yapma!**

### UI'da Tip Uyumluluk GÃ¶sterimi (MUST!)

Dataset oluÅŸtururken kolon mapping ekranÄ±nda:

1. **Her kolon iÃ§in gÃ¶ster:**
   - Kaynak Tip (SQL/API'den gelen)
   - ClickHouse Tip (dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ)
   - Uyumluluk durumu (âœ…/âŒ)

2. **Uyumsuzluk varsa:**
   - Ä°lgili satÄ±rÄ± kÄ±rmÄ±zÄ± gÃ¶ster
   - Kolon adÄ±nÄ± iÅŸaretle
   - DÃ¼zeltme Ã¶nerisi sun (tooltip)
   - "Dataset OluÅŸtur" butonunu disable yap

3. **Ã–zet kutusu:**
   - âœ… TÃ¼m kolonlar uyumlu â†’ YeÅŸil onay
   - âŒ X kolonda sorun var â†’ KÄ±rmÄ±zÄ± uyarÄ± + liste

4. **AkÄ±ÅŸ:**
```
Sorgu Ã§alÄ±ÅŸtÄ±r â†’ Kolonlar listelenir â†’ Tip kontrolÃ¼ yapÄ±lÄ±r
                                            â†“
                      Uyumlu: âœ… Dataset oluÅŸturulabilir
                      Uyumsuz: âŒ Hata mesajÄ± + Ã¶neri
```

**Prensip:** KullanÄ±cÄ± hiÃ§bir zaman tip uyumsuzluÄŸu olan bir dataset oluÅŸturamamalÄ±!

---

## ğŸ—“ï¸ TARÄ°H FORMAT DÃ–NÃœÅÃœM KURALLARI

### MUTLAK KURAL: TÃœM SQL tarih formatlarÄ± ClickHouse'a uyumlu olmalÄ±!

ClickHouse DateTime formatÄ±: `YYYY-MM-DD HH:mm:ss`

### Desteklenen GiriÅŸ FormatlarÄ±:

| Format | Ã–rnek | Kaynak |
|--------|-------|--------|
| ISO 8601 | `2025-12-23T16:00:00.000Z` | JavaScript, API |
| ISO with offset | `2025-12-23T16:00:00+03:00` | PostgreSQL |
| SQL Server | `2025-12-23 16:00:00.0000000` | MSSQL |
| MySQL | `2025-12-23 16:00:00` | MySQL |
| PostgreSQL | `2025-12-23 16:00:00.123456` | PostgreSQL |
| Date only | `2025-12-23` | TÃ¼m DB'ler |
| European | `23/12/2025`, `23.12.2025` | Yerel formatlar |
| US | `12/23/2025` | ABD formatÄ± |
| Compact | `20251223` | Legacy sistemler |
| SQL Server short | `Dec 23 2025 4:00PM` | MSSQL |
| JavaScript Date | `Date object` | Runtime |
| Unix timestamp | `1703343600000` | API, JavaScript |

### DÃ¶nÃ¼ÅŸÃ¼m Fonksiyonu:

```javascript
function convertToClickHouseDateTime(value: any): string | null {
  // 1. JavaScript Date objesi
  if (value instanceof Date) { ... }
  
  // 2. Unix timestamp (number)
  if (typeof value === 'number') { ... }
  
  // 3. String formatlarÄ±
  // A. ISO 8601: 2025-12-23T16:00:00.000Z
  // B. SQL Server: 2025-12-23 16:00:00.0000000
  // C. MySQL/PostgreSQL: 2025-12-23 16:00:00
  // D. Date only: 2025-12-23
  // E. European: 23/12/2025
  // F. US: 12/23/2025
  // G. Compact: 20251223
  // H. SQL Server short: Dec 23 2025 4:00PM
  
  return 'YYYY-MM-DD HH:mm:ss'; // Ã‡Ä±ktÄ± formatÄ±
}
```

### DÃ¶nÃ¼ÅŸÃ¼m AkÄ±ÅŸÄ±:

```
Kaynak DB â†’ ETL Worker â†’ transformBatchForClickHouse() â†’ ClickHouse
                              â†“
           Her satÄ±r iÃ§in: convertToClickHouseDateTime()
                              â†“
           Tarih deÄŸeri: "2025-12-23 16:00:00" âœ…
```

### Uygulama KurallarÄ±:

1. **Her insert Ã¶ncesi** `transformBatchForClickHouse()` Ã§aÄŸrÄ±lmalÄ±
2. **TanÄ±namayan format** â†’ null dÃ¶n + log yaz
3. **Tip kontrolÃ¼** â†’ `isDateLikeValue()` ile otomatik algÄ±la
4. **Hata durumu** â†’ Sync devam etmeli, sadece o deÄŸer null olmalÄ±

### Kod KonumlarÄ±:

- `services/etl-worker/src/index.ts`:
  - `convertToClickHouseDateTime()` - Ana dÃ¶nÃ¼ÅŸÃ¼m fonksiyonu
  - `isDateLikeValue()` - Tarih algÄ±lama
  - `transformRowForClickHouse()` - SatÄ±r dÃ¶nÃ¼ÅŸÃ¼mÃ¼
  - `transformBatchForClickHouse()` - Batch dÃ¶nÃ¼ÅŸÃ¼mÃ¼

---

## ğŸ”´ ETL JOB DURUM KURALLARI

### MUTLAK KURAL: 0 satÄ±r = BAÅARISIZ!

ETL job durumu ÅŸu kurallara gÃ¶re belirlenmeli:

| Durum | KoÅŸul | UI GÃ¶rÃ¼nÃ¼mÃ¼ |
|-------|-------|-------------|
| `completed` | rows_processed > 0 VE hata yok | âœ… YeÅŸil "TamamlandÄ±" |
| `failed` | rows_processed = 0 VEYA hata var | âŒ KÄ±rmÄ±zÄ± "BaÅŸarÄ±sÄ±z" |
| `running` | Ä°ÅŸlem devam ediyor | ğŸ”„ Mavi "Ã‡alÄ±ÅŸÄ±yor" |
| `pending` | SÄ±rada bekliyor | â³ Gri "Bekliyor" |
| `cancelled` | KullanÄ±cÄ± iptal etti | âšª Gri "Ä°ptal Edildi" |

### ETL Hata YÃ¶netimi KurallarÄ±:

1. **Hata Takibi**
   - Her batch insert hatasÄ± kaydedilmeli (`lastError`)
   - Final batch hatasÄ± kaydedilmeli
   - Sync sonunda hata varsa â†’ `reject(error)` ile fÄ±rlat

2. **0 SatÄ±r KontrolÃ¼**
   - `totalInserted === 0` â†’ Hata olarak iÅŸaretle
   - Hata mesajÄ±: "Kaynak tablodan veri Ã§ekilemedi veya ClickHouse'a yazÄ±lamadÄ± (0 satÄ±r)"

3. **UI'da Hata GÃ¶sterimi**
   - `error_message` alanÄ± her zaman gÃ¶rÃ¼nmeli
   - Verification uyarÄ±sÄ± (sarÄ±) vs Hata (kÄ±rmÄ±zÄ±) ayrÄ±mÄ±
   - "TamamlandÄ±" yazan job'da 0 satÄ±r OLMAMALI

4. **Status GÃ¼ncelleme**
   ```javascript
   // BaÅŸarÄ±lÄ±
   UPDATE etl_jobs SET status = 'completed', rows_processed = X WHERE id = $1
   
   // BaÅŸarÄ±sÄ±z
   UPDATE etl_jobs SET status = 'failed', error_message = $1 WHERE id = $2
   ```

5. **Count Verification**
   - Sync sonrasÄ± kaynak vs hedef satÄ±r sayÄ±sÄ± karÅŸÄ±laÅŸtÄ±r
   - Fark varsa `error_message` alanÄ±na yaz (uyarÄ± olarak)
   - UI'da sarÄ± kutu ile gÃ¶ster

### v1.0.8 - 24 AralÄ±k 2025

**ETL Hata YÃ¶netimi & Date Tipi DÃ¼zeltmesi**

1. âœ… 0 satÄ±r = failed olarak iÅŸaretleniyor
2. âœ… Hata mesajÄ± her zaman kaydediliyor
3. âœ… Date tipi kolonlar iÃ§in dÃ¶nÃ¼ÅŸÃ¼m eklendi (MSSQL streaming)
4. âœ… Verification uyarÄ±sÄ± UI'da sarÄ± kutu ile gÃ¶rÃ¼nÃ¼yor
5. âœ… Batch insert hatalarÄ± takip ediliyor

### v1.0.9 - 24 AralÄ±k 2025

**ID-Based Sync Bug Fix & extractTableFromQuery DÃ¼zeltmesi**

1. âœ… `extractTableFromQuery` fonksiyonu MSSQL kÃ¶ÅŸeli parantez formatÄ±nÄ± destekliyor
   - Eski: `FROM table` â†’ Ã‡alÄ±ÅŸÄ±yordu
   - **YENÄ°**: `FROM [dbo].[transaction_items]` â†’ ArtÄ±k Ã§alÄ±ÅŸÄ±yor!
   
2. âœ… ID-based sync artÄ±k doÄŸru Ã§alÄ±ÅŸÄ±yor
   - `syncById` fonksiyonu kaynak tablo adÄ±nÄ± doÄŸru buluyor
   - `SELECT TOP limit * FROM table WHERE id > maxId` sorgusu Ã§alÄ±ÅŸÄ±yor
   - Her sync sadece YENÄ° kayÄ±tlarÄ± ekliyor (silme yok!)

3. âœ… OPTIMIZE FINAL her sync sonrasÄ± Ã§alÄ±ÅŸÄ±yor
   - Duplicate'lar otomatik temizleniyor

**DÃ¼zeltilen Regex:**
```javascript
// ESKÄ° (YANLIÅ):
/\bFROM\s+([a-zA-Z_][a-zA-Z0-9_]*)/i

// YENÄ° (DOÄRU):
/\bFROM\s+\[?([a-zA-Z_][a-zA-Z0-9_]*)\]?\.\[?([a-zA-Z_][a-zA-Z0-9_]*)\]?/i
```

**Etkilenen Dosyalar:**
- `services/etl-worker/src/index.ts` - extractTableFromQuery fonksiyonu

### v1.0.10 - 24 AralÄ±k 2025

**Stuck Job UI UyarÄ±sÄ± & Temizle Butonu**

1. âœ… `isJobStuck()` fonksiyonu eklendi - 2dk'dan fazla Ã§alÄ±ÅŸan ve 0 satÄ±r iÅŸlenen job tespiti
2. âœ… Progress bar'da "YanÄ±t alÄ±namÄ±yor!" uyarÄ±sÄ±
3. âœ… "Temizle" butonu ile tek tÄ±kla stuck job iptali
4. âœ… No-code prensibine uygun - mÃ¼ÅŸteri terminal kullanmadan stuck job temizleyebilir

**Etkilenen Dosyalar:**
- `frontend/src/pages/DataPage.tsx` - isJobStuck fonksiyonu ve UI uyarÄ±sÄ±

---

### v1.0.11 - 25 AralÄ±k 2025

**Master Veriler & RLS Sistemi**

1. âœ… **Master Veriler TablolarÄ± OluÅŸturuldu**
   - `stores` - MaÄŸaza listesi (code, name, store_type, ownership_group, region_id, city, district, address, phone, email, manager_name, manager_email, opening_date, square_meters, employee_count, rent_amount, target_revenue)
   - `regions` - BÃ¶lge listesi (code, name, description, manager_name, manager_email)
   - `ownership_groups` - Sahiplik gruplarÄ± (code, name, description, color, icon)

2. âœ… **Admin Panel - Master Veriler Sekmesi**
   - MaÄŸazalar, BÃ¶lgeler, Gruplar alt sekmeleri
   - Manuel CRUD iÅŸlemleri (Ekle, DÃ¼zenle, Sil)
   - CSV Import/Export (UTF-8 BOM, semicolon delimiter)
   - Ã–rnek verili ÅŸablon indirme

3. âœ… **RLS (Row-Level Security) Sistemi**
   - Dataset'te `store_column`, `region_column`, `group_column` tanÄ±mlama
   - Pozisyonlarda `filter_level` (none, group, region, store)
   - KullanÄ±cÄ±larda `filter_value` (ilgili kod deÄŸeri)
   - JWT'de filterLevel ve filterValue taÅŸÄ±nÄ±yor
   - Metrik Ã§alÄ±ÅŸtÄ±rÄ±lÄ±rken otomatik WHERE koÅŸulu ekleniyor

4. âœ… **RLS Endpoint GÃ¼ncellemeleri**
   - `/metrics/:metricId/execute` - RLS aktif
   - `/metrics/batch` - RLS aktif
   - `/dashboard/:designId/full` - RLS aktif (DÃœZELTÄ°LDÄ°)
   - `/datasets/:datasetId/query` - RLS aktif (YENÄ°)
   - `/datasets/:datasetId/aggregate` - RLS aktif (YENÄ°)

5. âœ… **Cache Key GÃ¼ncelleme**
   - Dashboard cache key'ine `filterLevel:filterValue` eklendi
   - KullanÄ±cÄ±ya Ã¶zel cache (admin farklÄ±, maÄŸaza mÃ¼dÃ¼rÃ¼ farklÄ±)

**Etkilenen Dosyalar:**
- `services/analytics-service/src/index.ts` - RLS tÃ¼m endpoint'lere eklendi
- `services/core-service/src/index.ts` - Master Data CRUD endpoint'leri
- `frontend/src/pages/AdminPage.tsx` - Master Veriler UI
- `frontend/src/pages/DataPage.tsx` - RLS kolon seÃ§imi (Dataset ayarlarÄ±)
- `docker/init-scripts/postgres/03-master-data.sql` - Master tablolar

---

## ğŸ” RLS (Row-Level Security) MÄ°MARÄ°SÄ°

### Temel Prensip

```
KullanÄ±cÄ± Pozisyonu â†’ filter_level (none/group/region/store)
KullanÄ±cÄ± AtamasÄ± â†’ filter_value (kod deÄŸeri: '1', 'MARMARA', 'MERKEZ')
Dataset TanÄ±mÄ± â†’ store_column, region_column, group_column
Metrik Ã‡alÄ±ÅŸtÄ±rma â†’ WHERE [rls_column] = '[filter_value]'
```

### HiyerarÅŸi

| Pozisyon | filter_level | GÃ¶rdÃ¼ÄŸÃ¼ Veri |
|----------|--------------|--------------|
| Genel MÃ¼dÃ¼r | none | TÃœM VERÄ° |
| DirektÃ¶r | group | MERKEZ veya FRANCHISE maÄŸazalarÄ± |
| BÃ¶lge MÃ¼dÃ¼rÃ¼ | region | Kendi bÃ¶lgesindeki maÄŸazalar |
| MaÄŸaza MÃ¼dÃ¼rÃ¼ | store | Sadece kendi maÄŸazasÄ± |

### Kritik Kurallar

1. **stores.code = MÃ¼ÅŸteri DB'deki store_id olmalÄ±!**
   - Master Veriler'deki stores.code deÄŸeri
   - ClickHouse'daki store_id kolonu ile eÅŸleÅŸmeli

2. **Cache Key'de RLS bilgisi olmalÄ±**
   ```javascript
   const cacheKey = `dashboard:${designId}:${tenantId}:${filterLevel}:${filterValue}:${params}`;
   ```

3. **executeMetric Ã§aÄŸrÄ±larÄ±nda userRLS parametresi zorunlu**
   ```javascript
   const userRLS = { userId, filterLevel, filterValue };
   await executeMetric(metricId, tenantId, parameters, userRLS);
   ```

4. **Dataset query/aggregate endpoint'lerinde RLS WHERE eklenmeli**
   ```javascript
   if (userFilterLevel !== 'none' && userFilterValue) {
     rlsCondition = `${rlsColumn} = '${userFilterValue}'`;
   }
   ```

5. **âš ï¸ analytics-service'de varsayÄ±lan filterLevel = 'none' olmalÄ±!**
   ```javascript
   // âœ… DOÄRU (v5.2.4+ sonrasÄ±)
   filterLevel: (req.user as any).filterLevel || 'none'
   
   // âŒ YANLIÅ (Ã¶nceki hali)
   filterLevel: (req.user as any).filterLevel || 'store'
   ```
   **Neden?** JWT'den filterLevel okunamadÄ±ÄŸÄ±nda varsayÄ±lan `'store'` kullanÄ±lÄ±yorsa,
   admin bile olsa RLS filtresi aktif olur ve veri gÃ¶rÃ¼nmez!

6. **RLS Kolon Tipi UyumluluÄŸu ZORUNLU!**
   | Dataset RLS Kolonu | ClickHouse Tipi | Clixer filter_value | Uyumlu mu? |
   |--------------------|-----------------|---------------------|------------|
   | store_id | Int32 (1, 2, 3...) | UUID (string) | âŒ HATA! |
   | store_id | Int32 (1, 2, 3...) | '1', '2', '3' | âœ… OK |
   | store_code | String | 'STR001' | âœ… OK |
   
   **Kural:** Dataset'teki RLS kolonu tipi ile Clixer'daki `users.filter_value` tipi AYNI olmalÄ±!

7. **RLS AktifleÅŸtirme SÄ±rasÄ±**
   ```
   ADIM 1: Pozisyonlara filter_level ata
           Admin Panel â†’ Pozisyonlar â†’ DÃ¼zenle â†’ filter_level (none/group/region/store)
   
   ADIM 2: KullanÄ±cÄ±lara filter_value ata
           Admin Panel â†’ KullanÄ±cÄ±lar â†’ DÃ¼zenle â†’ RLS Filtre DeÄŸeri (maÄŸaza/bÃ¶lge/grup kodu)
   
   ADIM 3: Dataset'e RLS kolon seÃ§ (Ä°STEÄE BAÄLI)
           Veri BaÄŸlantÄ±larÄ± â†’ Dataset â†’ Ayarlar â†’ MaÄŸaza/BÃ¶lge/Grup Kolonu
   
   ADIM 4: Test et
           FarklÄ± kullanÄ±cÄ±larla giriÅŸ yap, sadece yetkili veriyi gÃ¶rdÃ¼klerini doÄŸrula
   ```

### ğŸ”´ YAÅANAN SORUN VE Ã‡Ã–ZÃœM (v5.2.4 - 29 AralÄ±k 2025)

**Belirti:** Widget'ta veri gÃ¶rÃ¼nmÃ¼yordu, ekranda "-" gÃ¶steriliyordu.

**Console HatasÄ±:**
```
ClickHouse: Cannot convert string '4d5dce1a-f549-4c30-8808-451ee79b8a80' to type Int32
```

**KÃ¶k Neden (2 sorun):**

1. **analytics-service'de varsayÄ±lan filterLevel yanlÄ±ÅŸtÄ±:**
   ```javascript
   // YANLIÅ: JWT'den okunamazsa 'store' kullanÄ±lÄ±yordu
   filterLevel: (req.user as any).filterLevel || 'store'
   ```
   Bu durumda admin bile olsa RLS filtresi aktif oluyordu.

2. **RLS kolon tipi uyumsuzluÄŸu:**
   - Dataset'te `store_column = 'store_id'` (Int32: 1, 2, 3...)
   - Clixer'daki maÄŸazalar UUID (string: '4d5dce1a-...')
   - WHERE store_id = 'uuid' â†’ TÄ°P HATASI!

**Ã‡Ã¶zÃ¼m:**
1. analytics-service'de 4 yerde `'store'` â†’ `'none'` deÄŸiÅŸtirildi
2. Tip uyumsuz dataset'lerden RLS kolon kaldÄ±rÄ±ldÄ±:
   ```sql
   UPDATE datasets SET store_column = NULL WHERE name = 'TEKSTIL_SATIS';
   ```

**Ã–ÄŸrenilen Ders:**
- RLS kolonu seÃ§erken ClickHouse kolon tipi ile Clixer filter_value tipi UYUMLU olmalÄ±
- Yeni mÃ¼ÅŸteri DB entegrasyonunda RLS Ã¶ncesi tip kontrolÃ¼ ZORUNLU

### Test SonuÃ§larÄ±

| KullanÄ±cÄ± | filter_level | filter_value | SonuÃ§ |
|-----------|--------------|--------------|-------|
| admin@demo.com | none | - | 4,376,663.5 (tÃ¼m veri) |
| cihan.adar@sirket.com | store | 1 | 266,117.5 (store_id=1) |

---

## ğŸ“Š MASTER VERÄ°LER YÃ–NETÄ°MÄ°

### Tablolar

| Tablo | AmaÃ§ | RLS Kolonu |
|-------|------|------------|
| stores | MaÄŸaza listesi | code â†’ filter_value |
| regions | BÃ¶lge listesi | code â†’ filter_value |
| ownership_groups | Sahiplik gruplarÄ± | code â†’ filter_value |

### Doldurma YÃ¶ntemleri

1. **Manuel GiriÅŸ** - Admin Panel â†’ Master Veriler â†’ Ekle butonu
2. **CSV Import** - Åablon indir, doldur, import et
3. **ETL Sync** (Gelecek) - MÃ¼ÅŸteri DB'den otomatik Ã§ekme

### CSV Format

```csv
code;name;store_type;ownership_group;region_code;city;district
1;Ä°stanbul KadÄ±kÃ¶y;MAGAZA;MERKEZ;MARMARA;Ä°stanbul;KadÄ±kÃ¶y
2;Ankara KÄ±zÄ±lay;MAGAZA;FRANCHISE;IC_ANADOLU;Ankara;Ã‡ankaya
```

---

## ğŸ”§ UI DÃœZELTMELERÄ° (v1.0.11)

1. âœ… Input kutularÄ±na `border` class'Ä± eklendi (gÃ¶rÃ¼nÃ¼rlÃ¼k)
2. âœ… TÄ°P badge renkleri gÃ¼ncellendi (MERKEZ=mavi, MAGAZA=yeÅŸil, DEPO=amber, FRANCHISE=mor)
3. âœ… `opening_date` tarih formatÄ± dÃ¼zeltildi (ISO â†’ YYYY-MM-DD)
4. âœ… `regions` tablosuna `updated_at` kolonu eklendi
5. âœ… Dataset ayarlarÄ±nda RLS bÃ¶lÃ¼mÃ¼ eklendi (gÃ¶rÃ¼nÃ¼r + dÃ¼zenlenebilir)

---

## ğŸ“… VERSÄ°YON GEÃ‡MÄ°ÅÄ°

| Tarih | Versiyon | AÃ§Ä±klama |
|-------|----------|----------|
| 2025-12-20 | v0.0.1 | Proje oluÅŸturuldu |
| 2025-12-21 | v1.0.0 | Ä°lk release, ETL, Dashboard |
| 2025-12-22 | v1.0.1-v1.0.3 | Big Data, Dil Paketi, Finans |
| 2025-12-23 | v1.0.4-v1.0.5 | Azure SQL, SQL Modu |
| 2025-12-24 | v1.0.6-v1.0.10 | ID-Based Sync, Progress Bar, Stuck Job |
| 2025-12-25 | v1.0.11-v1.0.12 | Master Veriler, RLS Sistemi, Designer Fix |
| 2025-12-25 | **v2.0.0** | **Enterprise Ready - Performans & GÃ¼venlik** |

---

---

## ğŸ”´ KRÄ°TÄ°K KURAL: UNIQUE KOLON ZORUNLU (ORDER BY)

### MUTLAK KURAL: Dataset'te unique kolon OLMADAN dataset oluÅŸturulamaz!

**Sorun:** ReplacingMergeTree engine'i ORDER BY key'e gÃ¶re duplicate'larÄ± merge eder.
EÄŸer ORDER BY `_synced_at` gibi aynÄ± deÄŸere sahip kolon olursa, TÃœM SATIRLAR TEK SATIRA MERGE EDÄ°LÄ°R!

### Unique Kolon Belirleme SÄ±rasÄ±

```
1. KullanÄ±cÄ± seÃ§imi (UI'dan) â†’ En Ã¶ncelikli
2. Otomatik algÄ±lama:
   - "id" â†’ Ä°lk tercih
   - "code" â†’ Ä°kinci tercih  
   - "uuid" â†’ ÃœÃ§Ã¼ncÃ¼ tercih
   - "pk" veya "primary_key" â†’ DÃ¶rdÃ¼ncÃ¼ tercih
   - "_id" (MongoDB style) â†’ BeÅŸinci tercih
3. HiÃ§biri yoksa â†’ HATA VER, dataset oluÅŸturma!
```

### UI KurallarÄ±

1. **Dataset oluÅŸtururken "Unique Kolon" dropdown ZORUNLU**
2. Otomatik algÄ±lanan kolon varsayÄ±lan seÃ§ili gelir
3. AlgÄ±lanamazsa kÄ±rmÄ±zÄ± uyarÄ±: "âš ï¸ Unique kolon seÃ§ilmedi! Dataset oluÅŸturulamaz."
4. "Dataset OluÅŸtur" butonu disable olur
5. KullanÄ±cÄ± manuel olarak herhangi bir kolonu seÃ§ebilir

### Backend Validation

```javascript
// data-service: Dataset oluÅŸturma
if (!uniqueColumn) {
  throw new ValidationError('Unique kolon zorunludur. LÃ¼tfen bir kolon seÃ§in.');
}
```

### ClickHouse Tablo OluÅŸturma

```sql
-- âœ… DOÄRU
CREATE TABLE dataset_xxx (...)
ENGINE = ReplacingMergeTree(_synced_at)
ORDER BY (code)  -- Unique kolon!

-- âŒ YANLIÅ (TÃœM VERÄ° MERGE EDÄ°LÄ°R!)
CREATE TABLE dataset_xxx (...)
ENGINE = ReplacingMergeTree(_synced_at)
ORDER BY (_synced_at)  -- AynÄ± deÄŸer = tek satÄ±r!
```

### Ã–rnek Senaryolar

| Sorgu | AlgÄ±lanan Unique | ORDER BY | SonuÃ§ |
|-------|------------------|----------|-------|
| `SELECT id, name FROM users` | id âœ… | (id) | Ã‡alÄ±ÅŸÄ±r |
| `SELECT code, name FROM stores` | code âœ… | (code) | Ã‡alÄ±ÅŸÄ±r |
| `SELECT name, city FROM stores` | âŒ YOK | HATA! | Dataset oluÅŸmaz |
| `SELECT store_id as id, name FROM x` | id âœ… (alias) | (id) | Ã‡alÄ±ÅŸÄ±r |

### Uygulama KurallarÄ±

1. **Frontend**: Unique kolon dropdown zorunlu, algÄ±lama + manuel seÃ§im
2. **Backend**: Validation, unique kolon yoksa 400 hata
3. **ETL Worker**: ORDER BY her zaman unique kolondan
4. **Hata mesajÄ±**: TÃ¼rkÃ§e, anlaÅŸÄ±lÄ±r

---

## ğŸ”´ KRÄ°TÄ°K KURAL: DÄ°NAMÄ°K KOLON SEÃ‡Ä°MÄ° (HARDCODED YASAK!)

### MUTLAK KURAL: HiÃ§bir kolon adÄ± hardcoded olamaz! KullanÄ±cÄ± seÃ§ecek!

**Prensip:** `id`, `code`, `date` gibi kolon adlarÄ± kodda sabit yazÄ±lamaz.
KullanÄ±cÄ± UI'dan hangi kolonu kullanacaÄŸÄ±nÄ± seÃ§er.

### Etkilenen Ã–zellikler

| Ã–zellik | KullanÄ±cÄ± SeÃ§er | API Parametresi |
|---------|----------------|-----------------|
| Veri DoÄŸrulama (Compare) | PK/ID Kolonu | `?pkColumn=id` |
| Eksik ID AralÄ±klarÄ± | PK/ID Kolonu | `?pkColumn=id` |
| Eksik Veri Sync | PK/ID Kolonu | `body: { pkColumn: 'id' }` |
| Duplicate KontrolÃ¼ | PK/ID Kolonu | `?pkColumn=id` |
| Tarih BazlÄ± Silme | Tarih Kolonu | `body: { dateColumn }` |

### UI KurallarÄ±

1. **Her dinamik iÅŸlem Ã¶ncesi kolon seÃ§ici gÃ¶ster**
2. Dropdown: Tablonun tÃ¼m kolonlarÄ±nÄ± listele
3. VarsayÄ±lan: `id` veya `code` (varsa)
4. Kolon seÃ§ilmeden buton aktif olmasÄ±n

### Backend KurallarÄ±

```javascript
// âœ… DOÄRU - KullanÄ±cÄ±dan al
const pkColumn = req.query.pkColumn || 'id';
await clickhouse.query(`SELECT MIN(${pkColumn}), MAX(${pkColumn}) FROM table`);

// âŒ YANLIÅ - Hardcoded
await clickhouse.query(`SELECT MIN(id), MAX(id) FROM table`);
```

### GÃ¼venlik

- Kolon adÄ± SQL injection'a karÅŸÄ± sanitize edilmeli
- Sadece alfanumerik ve underscore kabul et
- Kolon tabloda yoksa hata dÃ¶n

### Ã–rnek AkÄ±ÅŸ

```
UI: Veri DoÄŸrula sekmesi aÃ§Ä±ldÄ±
  â†“
UI: "PK Kolonu" dropdown gÃ¶sterildi [id, code, transaction_id, ...]
  â†“
KullanÄ±cÄ±: "transaction_id" seÃ§ti
  â†“
API: /compare?pkColumn=transaction_id
  â†“
Backend: SELECT MIN(transaction_id), MAX(transaction_id) FROM table
```

---

## ğŸš€ v2.0.0 - ENTERPRISE READY (25 AralÄ±k 2025)

### Bu SÃ¼rÃ¼mde Neler Var?

**STABÄ°LÄ°TE & PERFORMANS**
- âœ… PM2 Cluster Mode desteÄŸi (4x kapasite artÄ±ÅŸÄ±)
- âœ… PostgreSQL max_connections: 100 â†’ 200
- âœ… Redis maxclients: 10,000 + 1GB memory
- âœ… Production-ready Docker Compose
- âœ… Audit Logging altyapÄ±sÄ±

**GÃœVENLÄ°K**
- âœ… Audit logs tablosu (kim, ne zaman, ne yaptÄ±)
- âœ… shared/audit.ts helper modÃ¼lÃ¼
- âœ… Enterprise logging altyapÄ±sÄ±

**DESIGNER & UI**
- âœ… DesignerPage saÄŸ panel dÃ¼zeltildi
- âœ… Widget seÃ§iliyken TasarÄ±m AyarlarÄ± gÃ¶rÃ¼nÃ¼r
- âœ… Kaydet butonu her zaman eriÅŸilebilir

### Yeni Dosyalar

| Dosya | AÃ§Ä±klama |
|-------|----------|
| `ecosystem.config.js` | PM2 Cluster Mode konfigÃ¼rasyonu |
| `scripts/start-production.sh` | Production baÅŸlatma scripti |
| `docker/docker-compose.production.yml` | Optimize edilmiÅŸ Docker config |
| `docker/Dockerfile.service.production` | PM2 container ÅŸablonu |
| `docker/init-scripts/postgres/04-audit-logs.sql` | Audit tablosu |
| `shared/src/audit.ts` | Audit logging helper |
| `logs/` | Log klasÃ¶rÃ¼ |

### Kapasite KarÅŸÄ±laÅŸtÄ±rmasÄ±

| BileÅŸen | v1.x | v2.0.0 | ArtÄ±ÅŸ |
|---------|------|--------|-------|
| PostgreSQL baÄŸlantÄ± | 100 | 200 | 2x |
| Redis memory | 512MB | 1GB | 2x |
| Gateway instance | 1 | 4 | 4x |
| Analytics instance | 1 | 4 | 4x |
| EÅŸzamanlÄ± kullanÄ±cÄ± | ~100 | ~400+ | 4x |

### PM2 Cluster KonfigÃ¼rasyonu

```javascript
// ecosystem.config.js
{
  name: 'gateway',      instances: 4, exec_mode: 'cluster'
  name: 'analytics',    instances: 4, exec_mode: 'cluster'
  name: 'auth',         instances: 2, exec_mode: 'cluster'
  name: 'core',         instances: 2, exec_mode: 'cluster'
  name: 'data',         instances: 2, exec_mode: 'cluster'
  name: 'notification', instances: 1, exec_mode: 'fork'
  name: 'etl-worker',   instances: 1, exec_mode: 'fork'
}
```

### Audit Logging KullanÄ±mÄ±

```typescript
import { audit } from '@clixer/shared';

// Login kaydÄ±
await audit.logLogin(userId, email, tenantId, req.ip, req.headers['user-agent']);

// CRUD kaydÄ±
await audit.logCrud('CREATE', 'design', designId, userId, tenantId, { name: 'Yeni Dashboard' });

// Hata kaydÄ±
await audit.logError(userId, tenantId, 'dataset', 'Sync baÅŸarÄ±sÄ±z', { reason: 'Timeout' });
```

### Production Deploy

```bash
# SeÃ§enek 1: Docker Compose
docker-compose -f docker/docker-compose.production.yml up -d

# SeÃ§enek 2: Script ile
./scripts/start-production.sh

# PM2 komutlarÄ±
pm2 status          # Durumu gÃ¶r
pm2 logs            # LoglarÄ± izle
pm2 monit           # CanlÄ± monitoring
pm2 restart all     # Yeniden baÅŸlat
```

### MÃ¼ÅŸteri Gereksinimleri

```
âœ… Docker
âœ… Docker Compose
(Ekstra kurulum YOK - PM2 container iÃ§inde)
```

---

## ğŸ¨ UI/UX Ä°YÄ°LEÅTÄ°RME PLANI (Sonraki AdÄ±m)

### Hedef: Profesyonel Dashboard GÃ¶rÃ¼nÃ¼mÃ¼

**Widget Boyut StandartlarÄ±:**
| Tip | Grid Boyut | KullanÄ±m |
|-----|------------|----------|
| Mini KPI | w:3, h:2 | Tek deÄŸer |
| Kompakt KPI | w:4, h:2 | DeÄŸer + trend |
| Trend Kart | w:6, h:3 | Sparkline |
| Liste Kart | w:6, h:4 | Top 5 |
| Grafik Kart | w:8, h:5 | Chart |

**KPI Kart YapÄ±sÄ±:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° BaÅŸlÄ±k              [Ã–nbellek]  â”‚
â”‚                                     â”‚
â”‚  â‚º14.326.602                        â”‚  â† Ana DeÄŸer
â”‚                                     â”‚
â”‚  Son 30 gÃ¼n           â†— 12.5%       â”‚  â† Trend
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Renk Paleti:**
- Teal (#14B8A6): Ana marka rengi
- Emerald (#10B981): Pozitif/ArtÄ±ÅŸ
- Rose (#EF4444): Negatif/DÃ¼ÅŸÃ¼ÅŸ
- Amber (#F59E0B): UyarÄ±
- Blue (#3B82F6): Bilgi/NÃ¶tr

---

## ğŸ“¦ BACKUP BÄ°LGÄ°LERÄ°

### v2.0.0 Backup
- **Tarih**: 25 AralÄ±k 2025
- **Konum**: `backups/v2.0.0_YYYYMMDD_HHMMSS/`
- **Ä°Ã§erik**: Kod, PostgreSQL dump, ClickHouse metadata, Redis keys

### Ã–nceki Backuplar
- v1.0.12: `backups/v1.0.12_20251225_231817/`
- v1.0.11: `backups/v1.0.11_*`
- v1.0.0: `backups/VERSION_1.0.0_RELEASE_*`

---

## ğŸ”´ KRÄ°TÄ°K: TASARIM STÃœDYOSU STABÄ°LÄ°TE KURALI

### ASLA DEÄÄ°ÅTÄ°RME! (DesignerPage.tsx)

**Sorun:** `react-grid-layout` paketi v2.x'te API deÄŸiÅŸtirdi. `WidthProvider` kaldÄ±rÄ±ldÄ±.

**Ã‡Ã¶zÃ¼m:** Paket versiyonu SABÄ°T tutulmalÄ±:
```json
"react-grid-layout": "^1.4.4"
```

**ASLA YAPMA:**
1. âŒ `react-grid-layout` paketini gÃ¼ncelleme
2. âŒ DesignerPage.tsx import'larÄ±nÄ± deÄŸiÅŸtirme
3. âŒ `compactType`, `preventCollision` ayarlarÄ±nÄ± deÄŸiÅŸtirme
4. âŒ `loadDesign`, `handleLayoutChange` fonksiyonlarÄ±nÄ± deÄŸiÅŸtirme

**Stabil Import (v1.4.4):**
```typescript
import RGL, { WidthProvider, Layout as GridLayout, Layouts } from 'react-grid-layout'
const ResponsiveGridLayout = WidthProvider(RGL.Responsive)
```

**Grid AyarlarÄ± (DEÄÄ°ÅTÄ°RME!):**
```typescript
compactType={null}           // Widget'larÄ± sÄ±kÄ±ÅŸtÄ±rma
preventCollision={true}      // Ã‡arpÄ±ÅŸmayÄ± Ã¶nle
```

**Layout YÃ¶netimi:**
- Widget koordinatlarÄ± (x, y, w, h) API'den gelir
- `loadDesign` fonksiyonu koordinatlarÄ± `layouts` state'ine aktarÄ±r
- `handleLayoutChange` fonksiyonu sÃ¼rÃ¼kleme/boyutlandÄ±rma sonrasÄ± gÃ¼nceller
- `widgetsRef` kayÄ±t iÃ§in gÃ¼ncel pozisyonlarÄ± tutar

**Test Kriterleri:**
1. âœ… Var olan tasarÄ±m yÃ¼klendiÄŸinde tÃ¼m widget'lar kayÄ±tlÄ± konumlarÄ±nda
2. âœ… Yeni widget ekleme - Ã¶nceki widget'Ä±n altÄ±na (Ã¼st Ã¼ste deÄŸil)
3. âœ… Widget sÃ¼rÃ¼kleme - yeni konum kaydedilmeli
4. âœ… TasarÄ±m yeniden aÃ§Ä±ldÄ±ÄŸÄ±nda konumlar korunmalÄ±

---

## ğŸ“… v2.1.1 - 26 AralÄ±k 2025

**TasarÄ±m StÃ¼dyosu Stabilite DÃ¼zeltmesi**

1. âœ… `react-grid-layout` v1.4.4'e downgrade edildi (WidthProvider desteÄŸi)
2. âœ… v2.0.0 yedekten orijinal DesignerPage.tsx geri yÃ¼klendi
3. âœ… Stabilite kuralÄ± .cursorrules'a eklendi
4. âœ… Paket versiyonu sabitlendi

**Ã–ÄŸrenilen Ders:**
> "react-grid-layout v2.x API'si tamamen farklÄ±! WidthProvider kaldÄ±rÄ±ldÄ±.
> ASLA paketi gÃ¼ncelleme, ASLA import'larÄ± deÄŸiÅŸtirme.
> Ã‡alÄ±ÅŸan koda dokunma!"

---

## ğŸ“… v2.1.2 - 26 AralÄ±k 2025

**Grafik KartlarÄ± & UI Ä°yileÅŸtirmeleri**

### 1. âœ… TÃ¼m Grafik Tipleri Aktif
| Grafik Tipi | Durum | AÃ§Ä±klama |
|-------------|-------|----------|
| bar_chart | âœ… | Ã‡ubuk grafik (dikey) |
| line_chart | âœ… | Ã‡izgi grafik |
| area_chart | âœ… | Alan grafik (gradient dolgulu) |
| pie_chart | âœ… | Pasta grafik (tam daire) |
| donut_chart | âœ… | Halka grafik (ortasÄ± boÅŸ) |
| kpi_card | âœ… | KPI deÄŸer kartÄ± |
| data_grid | âœ… | Veri tablosu |

### 2. âœ… Metrik GÃ¶rselleÅŸtirme Tipi DÃ¼zeltmesi
- `metric_visualization_type` backend'den frontend'e doÄŸru aktarÄ±lÄ±yor
- Widget mapping'de `metric_visualization_type` alanÄ± eklendi
- `AnalysisPage.tsx` ve `DashboardPage.tsx` gÃ¼ncellendi

### 3. âœ… Dinamik Ä°kon DesteÄŸi
- Widget'lara Ã¶zel ikon atanabiliyor
- Ä°konlar `lucide-react` kÃ¼tÃ¼phanesinden geliyor
- Desteklenen ikonlar: BarChart3, LineChart, PieChart, TrendingUp, DollarSign, Users, ShoppingCart, Store, Package, Activity, Target, Zap, Award, Clock, Calendar, CreditCard, Wallet, Receipt, ArrowUpRight, ArrowDownRight

### 4. âœ… KarÅŸÄ±laÅŸtÄ±rma Sistemi (Comparison)
- YoY (Year-over-Year): GeÃ§en yÄ±l aynÄ± gÃ¼n
- MoM (Month-over-Month): GeÃ§en ay aynÄ± gÃ¼n
- WoW (Week-over-Week): GeÃ§en hafta
- YTD (Year-to-Date): YÄ±lbaÅŸÄ±ndan bugÃ¼ne
- LFL (Like-for-Like): KarÅŸÄ±laÅŸtÄ±rÄ±labilir gÃ¼nler (her iki dÃ¶nemde satÄ±ÅŸ olan gÃ¼nler)

### 5. âœ… Recharts Entegrasyonu
- BarChart, LineChart, AreaChart, PieChart tam entegre
- Responsive container desteÄŸi
- Tooltip ve Legend aktif
- Area chart iÃ§in gradient dolgu

### 6. âœ… Modern Kart TasarÄ±mÄ±
- `rounded-[20px]` kÃ¶ÅŸeler
- Multi-layer shadow efektleri
- Ãœst kenar accent bar
- Trend badge (yeÅŸil/kÄ±rmÄ±zÄ±)
- Detay butonu (â†—)

**DeÄŸiÅŸtirilen Dosyalar:**
- `frontend/src/pages/AnalysisPage.tsx` - Grafik render, ikon, metric_visualization_type
- `frontend/src/pages/DashboardPage.tsx` - Grafik render, modern kart stili
- `frontend/src/pages/MetricsPage.tsx` - KarÅŸÄ±laÅŸtÄ±rma tipi seÃ§imi
- `services/analytics-service/src/index.ts` - LFL hesaplama, comparison logic

**Yeni Ã–zellikler:**
- Metrik oluÅŸtururken karÅŸÄ±laÅŸtÄ±rma tipi seÃ§ilebilir
- Widget'a ikon atanabilir
- TÃ¼m grafik tipleri Ã§alÄ±ÅŸÄ±yor

---

## ğŸ“… VERSÄ°YON GEÃ‡MÄ°ÅÄ° (Ã–zet)

| Tarih | Versiyon | AÃ§Ä±klama |
|-------|----------|----------|
| 2025-12-20 | v0.0.1 | Proje oluÅŸturuldu |
| 2025-12-21 | v1.0.0 | Ä°lk release, ETL, Dashboard |
| 2025-12-22 | v1.0.1-v1.0.3 | Big Data, Dil Paketi, Finans |
| 2025-12-23 | v1.0.4-v1.0.5 | Azure SQL, SQL Modu |
| 2025-12-24 | v1.0.6-v1.0.10 | ID-Based Sync, Progress Bar, Stuck Job |
| 2025-12-25 | v1.0.11-v1.0.12 | Master Veriler, RLS Sistemi |
| 2025-12-25 | v2.0.0 | Enterprise Ready - PM2, Audit Log |
| 2025-12-26 | v2.1.1 | TasarÄ±m StÃ¼dyosu Stabilite |
| 2025-12-26 | v2.1.2 | Grafik KartlarÄ± & UI Ä°yileÅŸtirmeleri |
| 2025-12-27 | v2.1.3 | Widget GÃ¶rselleÅŸtirme Ä°yileÅŸtirmeleri |
| 2025-12-27 | v3.0.0 | TÃ¼m Metrik Tipleri Test Edildi |
| 2025-12-27 | v3.0.1 | Performans OptimizasyonlarÄ± |
| 2025-12-27 | v3.0.2 | GÃ¼venlik Ä°yileÅŸtirmeleri |
| 2025-12-27 | v4.0.0 | Tarih Filtresi & UI Ä°yileÅŸtirmeleri |
| 2025-12-27 | **v4.1.0** | **2FA, IP Whitelist, Password Policy, Session Mgmt, Harita, Self-Healing** |

---

## ğŸ“… v2.1.3 - 27 AralÄ±k 2025

**Widget GÃ¶rselleÅŸtirme Ä°yileÅŸtirmeleri**

### 1. âœ… Ä°lerleme KartÄ± Duplicate DeÄŸer DÃ¼zeltmesi
- **Sorun**: Ä°lerleme kartÄ±nda ana deÄŸer 2 kez gÃ¶rÃ¼nÃ¼yordu
- **Ã‡Ã¶zÃ¼m**: Ã–zel gÃ¶rselleÅŸtirme tipleri iÃ§in fallback KPI render'Ä± kapatÄ±ldÄ±
- Progress, Gauge, Sparkline, Trend tiplerinde artÄ±k sadece ilgili gÃ¶rsel gÃ¶steriliyor

### 2. âœ… Progress Bar Renk AyrÄ±mÄ±
- Dolu kÄ±sÄ±m: Widget rengi (mavi vb.)
- Kalan kÄ±sÄ±m: Belirgin gri (`#cbd5e1` light / `#475569` dark)
- ArtÄ±k %80 tamamlandÄ±ÄŸÄ±nda kalan %20 net gÃ¶rÃ¼nÃ¼yor

### 3. âœ… Gauge (GÃ¶sterge) SVG Yeniden TasarÄ±m
- CSS conic-gradient yerine SVG path kullanÄ±lÄ±yor
- YarÄ±m daire ÅŸeklinde net gÃ¶rÃ¼nÃ¼m
- Dolu kÄ±sÄ±m: Widget rengi
- Kalan kÄ±sÄ±m: Belirgin gri arka plan
- Animasyonlu geÃ§iÅŸ efekti

### 4. âœ… Sparkline/Trend iÃ§in Zorunlu Tarih Kolonu UI
- Mini Kart, Sparkline, Trend KartÄ± seÃ§ildiÄŸinde otomatik "Zaman Serisi AyarlarÄ±" bÃ¶lÃ¼mÃ¼ aÃ§Ä±lÄ±yor
- Tarih kolonu seÃ§imi zorunlu hale getirildi
- Backend'den gerÃ§ek veri Ã§ekiliyor (son 12 gÃ¼n)

### 5. âœ… Hedef Kolon DesteÄŸi (Backend)
- `target_column` artÄ±k backend'de iÅŸleniyor
- Sabit deÄŸer veya kolondan dinamik hedef seÃ§ilebilir
- ClickHouse'dan toplam deÄŸer Ã§ekilerek hedef belirleniyor

**DeÄŸiÅŸtirilen Dosyalar:**
- `frontend/src/pages/AnalysisPage.tsx` - Progress bar, Gauge SVG, Sparkline debug
- `frontend/src/pages/MetricsPage.tsx` - Zaman Serisi AyarlarÄ± UI
- `services/analytics-service/src/index.ts` - target_column, sparkline chart_config

**Debug LoglarÄ±:**
- `ğŸ“Š Sparkline Debug` - Sparkline veri kaynaÄŸÄ± kontrolÃ¼
- `ğŸ“ˆ Trend Debug` - Trend veri kaynaÄŸÄ± kontrolÃ¼
- `isDemo: true` â†’ Demo veri kullanÄ±lÄ±yor
- `isDemo: false` â†’ GerÃ§ek veri geliyor

---

## ğŸ”´ METRÄ°K VERÄ° FORMAT KURALLARI

### MUTLAK KURAL: Dataset verileri doÄŸru formatta olmalÄ±!

Metrikler ve karÅŸÄ±laÅŸtÄ±rmalar Ã§alÄ±ÅŸmasÄ± iÃ§in kaynak veri formatlarÄ± kritik Ã¶neme sahiptir.

### 1. TARÄ°H KOLONU FORMATLARI

| Kaynak Format | ClickHouse'da | KarÅŸÄ±laÅŸtÄ±rma | Notlar |
|---------------|---------------|---------------|--------|
| `YYYY-MM-DD HH:mm:ss` | String | âœ… `toDate()` ile | En yaygÄ±n format |
| `YYYY-MM-DD` | Date | âœ… Direkt | Ä°deal format |
| `DD/MM/YYYY` | String | âš ï¸ DÃ¶nÃ¼ÅŸÃ¼m gerekir | TÃ¼rkiye formatÄ± |
| `MM/DD/YYYY` | String | âš ï¸ DÃ¶nÃ¼ÅŸÃ¼m gerekir | ABD formatÄ± |
| `20251227` | String | âš ï¸ `toDate()` ile | Kompakt format |
| Unix timestamp | UInt64 | âš ï¸ `toDateTime()` ile | Epoch saniye |

**KarÅŸÄ±laÅŸtÄ±rma (YoY, MoM, WoW, YTD) iÃ§in:**
- Tarih kolonu **ZORUNLU**
- Backend'de `toDate(kolon)` kullanÄ±larak dÃ¶nÃ¼ÅŸÃ¼m yapÄ±lÄ±r
- String formatÄ±nda tarihler desteklenir: `YYYY-MM-DD*` (Ã¶rn: `2025-12-27 12:00:00`)

### 2. ID KOLONU FORMATLARI

| Kaynak Tip | ClickHouse Tip | KullanÄ±m |
|------------|----------------|----------|
| int, bigint | Int32, Int64 | âœ… SayÄ±sal ID (Ã¶nerilen) |
| uuid, uniqueidentifier | String | âœ… UUID formatÄ± |
| varchar | String | âš ï¸ ID-based sync'te dikkat |

**ID-Based Sync iÃ§in:**
- ID kolonu **ZORUNLU** (ORDER BY iÃ§in)
- SayÄ±sal ID Ã¶nerilir (performans iÃ§in)
- String ID'lerde `toInt64OrZero()` kullanÄ±lÄ±r

### 3. SAYISAL KOLONLAR

| Kaynak Tip | ClickHouse Tip | Aggregation |
|------------|----------------|-------------|
| decimal, numeric | Float64 | âœ… SUM, AVG |
| float, real | Float32 | âœ… SUM, AVG |
| int, bigint | Int32, Int64 | âœ… SUM, COUNT |
| varchar (sayÄ±) | String | âŒ Aggregation Ã‡ALIÅMAZ! |

**KRÄ°TÄ°K:** SayÄ±sal deÄŸerler (ciro, tutar, adet) **ASLA String tipinde olmamalÄ±!**

### 4. GRUP KOLONLARI (Group By)

| KullanÄ±m | Ã–nerilen Tip | Ã–rnek |
|----------|--------------|-------|
| MaÄŸaza kodu | String | `store_id`, `magaza_kodu` |
| BÃ¶lge | String | `region_id`, `bolge` |
| Kategori | String | `category`, `urun_grubu` |
| Tarih grubu | Date | `sale_date`, `tarih` |

### 5. METRÄ°K TÄ°PÄ°NE GÃ–RE GEREKSÄ°NÄ°MLER

| Metrik Tipi | Gerekli Kolon | Format |
|-------------|---------------|--------|
| KPI KartÄ± | SayÄ±sal kolon | Float64/Int |
| Grafik | SayÄ±sal + Group By | Float64 + String |
| KarÅŸÄ±laÅŸtÄ±rma | SayÄ±sal + Tarih | Float64 + Date/String |
| SÄ±ralama | SayÄ±sal + Label | Float64 + String |
| Sparkline/Trend | SayÄ±sal + Tarih | Float64 + Date |
| Ä°lerleme/GÃ¶sterge | SayÄ±sal + Hedef | Float64 + Float64 |

### 6. Ã–RNEK DOÄRU TABLO YAPISI

```sql
CREATE TABLE sales (
  id Int64,                    -- âœ… SayÄ±sal ID
  created_at DateTime,         -- âœ… Tarih (veya String 'YYYY-MM-DD HH:mm:ss')
  store_id String,             -- âœ… Grup kolonu
  product_name String,         -- âœ… Label kolonu
  quantity Int32,              -- âœ… SayÄ±sal
  unit_price Float64,          -- âœ… SayÄ±sal
  line_total Float64,          -- âœ… SayÄ±sal (aggregation iÃ§in)
  _synced_at DateTime          -- âœ… ETL timestamp
)
ENGINE = ReplacingMergeTree(_synced_at)
ORDER BY (id)
```

### 7. HATALI FORMAT Ã–RNEKLERÄ°

```sql
-- âŒ YANLIÅ
amount VARCHAR(50)        -- SayÄ± String olarak
created_date VARCHAR(10)  -- Tarih formatÄ± belirsiz
id VARCHAR(100)           -- ID String (UUID deÄŸilse)

-- âœ… DOÄRU
amount DECIMAL(18,2)      -- SayÄ± decimal
created_date DATE         -- Tarih Date
id BIGINT                 -- ID sayÄ±sal
```

### 8. UI'DA GÃ–STERÄ°LECEK UYARILAR

Metrik oluÅŸtururken kullanÄ±cÄ±ya gÃ¶sterilmeli:

1. **KarÅŸÄ±laÅŸtÄ±rma seÃ§ildiÄŸinde:**
   > âš ï¸ Tarih kolonu `YYYY-MM-DD` veya `YYYY-MM-DD HH:mm:ss` formatÄ±nda olmalÄ±dÄ±r.

2. **Sparkline/Trend seÃ§ildiÄŸinde:**
   > âš ï¸ Zaman serisi iÃ§in tarih kolonu zorunludur. Format: `YYYY-MM-DD` veya DateTime.

3. **Ä°lerleme/GÃ¶sterge seÃ§ildiÄŸinde:**
   > âš ï¸ Hedef deÄŸer sayÄ±sal olmalÄ±dÄ±r. Kolondan seÃ§ilecekse kolon tipi Float/Int olmalÄ±.

4. **SÄ±ralama Listesi seÃ§ildiÄŸinde:**
   > âš ï¸ SÄ±ralama iÃ§in sayÄ±sal bir deÄŸer kolonu gereklidir.

---

## ğŸ”´ KARÅILAÅTIRMA METRÄ°K MÄ°MARÄ°SÄ°

### Otomatik Tarih Filtresi

KarÅŸÄ±laÅŸtÄ±rma modu aktif olduÄŸunda:
1. **Ana deÄŸer** otomatik olarak "bugÃ¼n" iÃ§in filtrelenir
2. **Ã–nceki deÄŸer** seÃ§ilen karÅŸÄ±laÅŸtÄ±rma tipine gÃ¶re hesaplanÄ±r

```
MoM Ã–rnek (27 AralÄ±k 2025):
â”œâ”€ GÃ¼ncel: toDate(created_at) = '2025-12-27' â†’ 169.96M â‚º
â”œâ”€ Ã–nceki: toDate(created_at) = '2025-11-27' â†’ 169.50M â‚º
â””â”€ Trend: +0.27%
```

### Backend AkÄ±ÅŸÄ±

```javascript
// 1. Ana metrik sorgusu (karÅŸÄ±laÅŸtÄ±rma modunda tarih filtreli)
if (metric.comparison_enabled && chartConfig.comparisonColumn) {
  sql += ` WHERE toDate(${dateColumn}) = '${todayStr}'`;
}

// 2. KarÅŸÄ±laÅŸtÄ±rma hesaplamasÄ±
// - GÃ¼ncel dÃ¶nem deÄŸeri zaten hesaplandÄ± (ana sorgu)
// - Ã–nceki dÃ¶nem deÄŸeri ayrÄ±ca hesaplanÄ±r
// - Trend yÃ¼zdesi hesaplanÄ±r
// - metadata.previousValue ve metadata.trend eklenir
```

### Desteklenen VeritabanlarÄ±

| Kaynak DB | Tarih FormatÄ± | DÃ¶nÃ¼ÅŸÃ¼m | KarÅŸÄ±laÅŸtÄ±rma |
|-----------|---------------|---------|---------------|
| SQL Server | `YYYY-MM-DD HH:mm:ss.nnn` | `toDate()` | âœ… |
| PostgreSQL | `YYYY-MM-DD HH:mm:ss.nnnnnn` | `toDate()` | âœ… |
| MySQL | `YYYY-MM-DD HH:mm:ss` | `toDate()` | âœ… |
| Oracle | `DD-MON-YY` | âš ï¸ ETL'de dÃ¶nÃ¼ÅŸÃ¼m | âœ… |
| Excel/CSV | Ã‡eÅŸitli | âš ï¸ ETL'de dÃ¶nÃ¼ÅŸÃ¼m | âœ… |

### KarÅŸÄ±laÅŸtÄ±rma Tipleri

| Tip | Hesaplama | Ã–rnek (27 AralÄ±k 2025) |
|-----|-----------|------------------------|
| YoY | GeÃ§en yÄ±l aynÄ± gÃ¼n | 27 AralÄ±k 2024 |
| MoM | GeÃ§en ay aynÄ± gÃ¼n | 27 KasÄ±m 2025 |
| WoW | GeÃ§en hafta aynÄ± gÃ¼n | 20 AralÄ±k 2025 |
| YTD | YÄ±lbaÅŸÄ±ndan bugÃ¼ne | 1 Ocak - 27 AralÄ±k |
| LFL | Ortak satÄ±ÅŸ gÃ¼nleri | Her iki dÃ¶nemde satÄ±ÅŸ olan gÃ¼nler |

### LFL (Like-for-Like) Ã–zel Hesaplama

```sql
-- Sadece her iki dÃ¶nemde de satÄ±ÅŸ olan gÃ¼nleri karÅŸÄ±laÅŸtÄ±r
-- Yeni aÃ§Ä±lan maÄŸazalar veya kapalÄ± gÃ¼nler hariÃ§ tutulur
SELECT 
  SUM(CASE WHEN year = current_year THEN value ELSE 0 END) as current,
  SUM(CASE WHEN year = previous_year THEN value ELSE 0 END) as previous
FROM (
  SELECT year, day_of_year, SUM(amount) as value
  FROM sales
  GROUP BY year, day_of_year
  HAVING COUNT(DISTINCT year) = 2  -- Her iki yÄ±lda da veri var
)
```

### Kritik Kurallar

1. **Tarih kolonu ZORUNLU** - KarÅŸÄ±laÅŸtÄ±rma iÃ§in mutlaka tarih/zaman kolonu seÃ§ilmeli
2. **Format standart olmalÄ±** - `YYYY-MM-DD` veya `YYYY-MM-DD HH:mm:ss`
3. **String tarihler de Ã§alÄ±ÅŸÄ±r** - Backend'de `toDate()` ile dÃ¶nÃ¼ÅŸÃ¼m yapÄ±lÄ±r
4. **Otomatik filtreleme** - KarÅŸÄ±laÅŸtÄ±rma modunda ana deÄŸer de tarih bazlÄ± filtrelenir
5. **Memory optimizasyonu** - WHERE olmadan 47M+ satÄ±r taranamaz

---

## ğŸ“… v2.1.4 - 27 AralÄ±k 2025

**KarÅŸÄ±laÅŸtÄ±rma Metrikleri Tam Ã‡alÄ±ÅŸÄ±r Hale Getirildi**

1. âœ… **Otomatik tarih filtresi** - KarÅŸÄ±laÅŸtÄ±rma modunda ana metrik "bugÃ¼n" iÃ§in filtrelenir
2. âœ… **chart_config parse** - JSONB ve String formatlarÄ± desteklenir
3. âœ… **Memory optimizasyonu** - BÃ¼yÃ¼k tablolarda WHERE zorunlu
4. âœ… **MoM, YoY, WoW, YTD, LFL** - TÃ¼m karÅŸÄ±laÅŸtÄ±rma tipleri Ã§alÄ±ÅŸÄ±r
5. âœ… **UI format uyarÄ±larÄ±** - KÄ±rmÄ±zÄ± uyarÄ± kutularÄ± eklendi
6. âœ… **Evrensel destek** - SQL Server, PostgreSQL, MySQL, Oracle, Excel

**DeÄŸiÅŸtirilen Dosyalar:**
- `services/analytics-service/src/index.ts` - Otomatik tarih filtresi, chart_config parse
- `frontend/src/pages/MetricsPage.tsx` - Format uyarÄ± kutularÄ±
- `.cursorrules` - Veri format kurallarÄ± dokÃ¼mantasyonu

**Test SonuÃ§larÄ±:**
- MoM karÅŸÄ±laÅŸtÄ±rma: 169.96M (bugÃ¼n) vs 169.50M (geÃ§en ay) = +0.27% âœ…

---

## ğŸ“… v3.0.0 - 27 AralÄ±k 2025 (STABLE RELEASE)

**TÃ¼m Metrik Tipleri Test Edildi ve Ã‡alÄ±ÅŸÄ±yor**

### Aktif Metrik Tipleri (13 adet)

| # | Tip | Backend | Frontend | Test |
|---|-----|---------|----------|------|
| 1 | KPI Card | âœ… | âœ… | âœ… |
| 2 | Comparison | âœ… | âœ… | âœ… |
| 3 | Ranking List | âœ… | âœ… | âœ… |
| 4 | Progress Bar | âœ… | âœ… | âœ… |
| 5 | Gauge | âœ… | âœ… | âœ… |
| 6 | Sparkline | âœ… | âœ… | âœ… |
| 7 | Trend Card | âœ… | âœ… | âœ… |
| 8 | Bar Chart | âœ… | âœ… | âœ… |
| 9 | Line Chart | âœ… | âœ… | âœ… |
| 10 | Pie Chart | âœ… | âœ… | âœ… |
| 11 | Donut Chart | âœ… | âœ… | âœ… |
| 12 | Area Chart | âœ… | âœ… | âœ… |
| 13 | Data Grid | âœ… | âœ… | âœ… |

### KarÅŸÄ±laÅŸtÄ±rma Tipleri (5 adet)

| Tip | Hesaplama | Test |
|-----|-----------|------|
| YoY | GeÃ§en yÄ±l aynÄ± gÃ¼n | âœ… |
| MoM | GeÃ§en ay aynÄ± gÃ¼n | âœ… |
| WoW | GeÃ§en hafta | âœ… |
| YTD | YÄ±lbaÅŸÄ±ndan bugÃ¼ne | âœ… |
| LFL | Ortak satÄ±ÅŸ gÃ¼nleri | âœ… |

### GÃ¼venlik & Yetkilendirme

| Ã–zellik | Durum |
|---------|-------|
| RLS (Row-Level Security) | âœ… |
| Pozisyon bazlÄ± yetki | âœ… |
| TasarÄ±m yetkilendirme | âœ… |
| JWT Token | âœ… |
| Tenant Isolation | âœ… |

### Bekleyen Ã–zellik: Tarih Filtresi

âš ï¸ **Tarih filtresi frontend'de var ama backend'e gÃ¶nderilmiyor!**
- `filterStore.ts` - Tarih mantÄ±ÄŸÄ± âœ…
- `FilterBar.tsx` - UI âœ…
- Dashboard/Analysis sayfalarÄ± - **Filtreyi kullanmÄ±yor âŒ**

Bu Ã¶zellik v3.1.0'da eklenecek.

---

## ğŸ“… v3.0.1 - 27 AralÄ±k 2025

**Performans OptimizasyonlarÄ±**

### 1. âœ… ClickHouse Performance Tuning
- `CLICKHOUSE_MAX_MEMORY_USAGE`: 8GB (query baÅŸÄ±na)
- `CLICKHOUSE_MAX_MEMORY_USAGE_FOR_ALL_QUERIES`: 16GB (toplam)
- `CLICKHOUSE_MAX_EXECUTION_TIME`: 30 saniye
- Container memory limit: 20GB, reservation: 8GB

### 2. âœ… PostgreSQL Performance Tuning
- `max_connections`: 200 (Ã¶nceki: 100)
- `shared_buffers`: 256MB
- `effective_cache_size`: 768MB
- `work_mem`: 16MB
- `maintenance_work_mem`: 128MB
- Container memory limit: 2GB

### 3. âœ… Redis Performance Tuning
- `maxmemory`: 2GB (Ã¶nceki: 512MB)
- `maxclients`: 10,000
- Container memory limit: 3GB

### 4. âœ… Node.js Connection Pool
- PostgreSQL pool max: 50 (Ã¶nceki: 20)

### 5. âœ… Query Timeout
- ClickHouse query timeout: 10 saniye (default)
- AbortController ile timeout mekanizmasÄ±
- Timeout hatasÄ± iÃ§in Ã¶zel error handling

### DeÄŸiÅŸtirilen Dosyalar
- `docker/docker-compose.yml` - ClickHouse, PostgreSQL, Redis config
- `shared/src/db.ts` - PostgreSQL pool max artÄ±rÄ±ldÄ±
- `shared/src/clickhouse.ts` - Query timeout eklendi

### Kapasite KarÅŸÄ±laÅŸtÄ±rmasÄ±

| BileÅŸen | v3.0.0 | v3.0.1 | ArtÄ±ÅŸ |
|---------|--------|--------|-------|
| PostgreSQL baÄŸlantÄ± | 100 | 200 | 2x |
| PostgreSQL pool | 20 | 50 | 2.5x |
| Redis memory | 512MB | 2GB | 4x |
| Redis maxclients | 1000 | 10000 | 10x |
| ClickHouse memory | - | 16GB | âˆ |
| ClickHouse query timeout | - | 10s | âœ… |

**Hedef:** 400+ eÅŸzamanlÄ± kullanÄ±cÄ± desteÄŸi âœ…

---

## ğŸ“… v3.0.2 - 27 AralÄ±k 2025

**GÃ¼venlik Ä°yileÅŸtirmeleri (Security Hardening)**

### 1. âœ… SQL Injection KorumasÄ±
- `shared/src/security.ts` modÃ¼lÃ¼ oluÅŸturuldu
- `sanitizeTableName()` - Tablo adÄ± whitelist kontrolÃ¼
- `sanitizeColumnName()` - Kolon adÄ± whitelist kontrolÃ¼
- `sanitizeAggFunction()` - Aggregation fonksiyonu strict whitelist
- `sanitizeDateString()` - Tarih formatÄ± kontrolÃ¼ (YYYY-MM-DD)
- `containsDangerousSQLKeywords()` - Tehlikeli SQL keyword tespiti

### 2. âœ… Input Validation
- `isValidEmail()` - Email format kontrolÃ¼
- `isValidUUID()` - UUID format kontrolÃ¼
- `sanitizeString()` - XSS korumasÄ± (HTML escape)
- `sanitizeNumber()` - SayÄ±sal deÄŸer kontrolÃ¼
- `sanitizeLimit()` / `sanitizeOffset()` - Pagination gÃ¼venliÄŸi

### 3. âœ… Gateway GÃ¼venlik BaÅŸlÄ±klarÄ± (Helmet.js)
- Content Security Policy (CSP) aktif
- HSTS (HTTP Strict Transport Security) 1 yÄ±l
- X-Frame-Options, X-Content-Type-Options otomatik

### 4. âœ… CORS KÄ±sÄ±tlama
- Development: `*` (aÃ§Ä±k)
- Production: Whitelist (`clixer.app`, `app.clixer.com`)
- Preflight cache: 24 saat

### 5. âœ… Suspicious Request Detection
- SQL Injection pattern tespiti
- XSS pattern tespiti
- Path traversal tespiti
- Otomatik blok + log

### 6. âœ… Request Tracing
- Her request iÃ§in unique X-Trace-Id
- YavaÅŸ istek uyarÄ±sÄ± (>5s)
- IP logging

### Yeni Dosyalar
- `shared/src/security.ts` - GÃ¼venlik helper modÃ¼lÃ¼

### DeÄŸiÅŸtirilen Dosyalar
- `shared/src/index.ts` - Security export
- `gateway/src/index.ts` - CSP, CORS, Suspicious detection
- `services/analytics-service/src/index.ts` - Security import

### GÃ¼venlik Matrisi

| Tehdit | Koruma | Durum |
|--------|--------|-------|
| SQL Injection | Whitelist + Parameterized | âœ… |
| XSS | Helmet CSP + sanitizeString | âœ… |
| Brute Force | Rate limiting (10/15dk) | âœ… |
| DDoS | Rate limiting (200/dk) | âœ… |
| CSRF | CORS restriction | âœ… |
| Path Traversal | Pattern detection | âœ… |
| Session Hijacking | JWT (15dk expire) | âœ… |
| Password Cracking | bcrypt (12 rounds) | âœ… |
| Data Exposure | Tenant isolation + RLS | âœ… |

---

## ğŸ“… v4.0.0 - 27 AralÄ±k 2025 (STABLE RELEASE)

**Tarih Filtresi & UI Ä°yileÅŸtirmeleri**

### 1. âœ… Tarih Filtresi Entegrasyonu
- FilterBar'dan seÃ§ilen tarih aralÄ±ÄŸÄ± backend'e gÃ¶nderiliyor
- `startDate` ve `endDate` parametreleri tÃ¼m metrik sorgularÄ±na ekleniyor
- ClickHouse'da `toDate()` ile tarih karÅŸÄ±laÅŸtÄ±rmasÄ± yapÄ±lÄ±yor
- "TÃ¼m Zamanlar" seÃ§eneÄŸi eklendi (tarih filtresi olmadan tÃ¼m veri)

### 2. âœ… Filtre Entegrasyonu (TÃ¼m Sayfalar)
- `DashboardPage.tsx` - Tarih, bÃ¶lge, maÄŸaza, maÄŸaza tipi filtreleri
- `AnalysisPage.tsx` - Tarih, bÃ¶lge, maÄŸaza, maÄŸaza tipi filtreleri
- `StoresPage.tsx` - FilterBar eklendi
- `OperationsPage.tsx` - FilterBar eklendi
- `FinancePage.tsx` - FilterBar eklendi

### 3. âœ… Kart Renk ModlarÄ± (3 SeÃ§enek)
| Mod | AÃ§Ä±klama | GÃ¶rÃ¼nÃ¼m |
|-----|----------|---------|
| **Sade** | Tema uyumlu, Ã§izgisiz | DÃ¼z arka plan |
| **Accent (Ãœst Bar)** | Renkli Ã¼st Ã§izgi | 3px border-top |
| **Tam Renk** | Google Analytics tarzÄ± | SeÃ§ilen renk arka plan |

### 4. âœ… "Renk Yok" SeÃ§eneÄŸi
- Renk paletine "Renk Yok" seÃ§eneÄŸi eklendi
- Ã‡apraz kÄ±rmÄ±zÄ± Ã§izgi ile gÃ¶rsel olarak belirtiliyor
- SeÃ§ildiÄŸinde kart tamamen tema renklerini kullanÄ±r

### 5. âœ… Full Renk Modunda Okunabilirlik
- TÃ¼m metin renkleri beyaz/beyaz-ÅŸeffaf olarak ayarlandÄ±
- Label, value, trend, period bilgileri okunabilir durumda

### 6. âœ… UI TemizliÄŸi
- "Ä°ndir" ve "PaylaÅŸ" butonlarÄ± AnalysisPage'den kaldÄ±rÄ±ldÄ±
- FilterBar her zaman gÃ¶rÃ¼nÃ¼r (tasarÄ±m seÃ§ildiÄŸinde de)

**DeÄŸiÅŸtirilen Dosyalar:**
- `frontend/src/pages/MetricsPage.tsx` - Renk modlarÄ±, renk yok seÃ§eneÄŸi
- `frontend/src/pages/AnalysisPage.tsx` - Tarih filtresi, renk modlarÄ±, UI temizliÄŸi
- `frontend/src/pages/DashboardPage.tsx` - Tarih filtresi, renk modlarÄ±
- `frontend/src/pages/StoresPage.tsx` - FilterBar eklendi
- `frontend/src/pages/OperationsPage.tsx` - FilterBar eklendi
- `frontend/src/pages/FinancePage.tsx` - FilterBar eklendi
- `frontend/src/stores/filterStore.ts` - "TÃ¼m Zamanlar" preset
- `frontend/src/stores/dashboardStore.ts` - Tarih parametreleri
- `services/analytics-service/src/index.ts` - Tarih ve filtre parametreleri

---

## ğŸ“… v4.1.0 - 27 AralÄ±k 2025

**GÃ¼venlik & Self-Healing GÃ¼ncellemesi**

### Eklenen Ã–zellikler

1. âœ… **2FA (TOTP)** - Ä°ki faktÃ¶rlÃ¼ doÄŸrulama
   - `POST /api/auth/2fa/setup` - QR kod oluÅŸtur
   - `POST /api/auth/2fa/verify` - Kodu doÄŸrula ve aktifleÅŸtir
   - `POST /api/auth/2fa/disable` - 2FA'yÄ± kapat
   - `GET /api/auth/2fa/status` - Durum kontrolÃ¼

2. âœ… **IP Whitelist** - Admin panel iÃ§in IP kÄ±sÄ±tlama
   - `system_settings.admin_ip_whitelist` ayarÄ±
   - Gateway middleware ile kontrol
   - `["*"]` = TÃ¼mÃ¼ne izin (varsayÄ±lan)

3. âœ… **Password Policy** - GÃ¼Ã§lÃ¼ ÅŸifre zorunluluÄŸu
   - Min 8 karakter, bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf, rakam, Ã¶zel karakter
   - `shared/src/security.ts` - validatePassword()

4. âœ… **Session Management** - Aktif oturum yÃ¶netimi
   - `GET /api/auth/sessions` - Aktif oturumlarÄ± listele
   - `DELETE /api/auth/sessions/:id` - Tek oturumu sonlandÄ±r
   - `DELETE /api/auth/sessions` - TÃ¼m oturumlarÄ± sonlandÄ±r

5. âœ… **Harita GÃ¶rselleÅŸtirme** - Leaflet entegrasyonu
   - `frontend/src/components/MapChart.tsx`
   - Metrik tiplerinde "Harita" seÃ§eneÄŸi

6. âœ… **Self-Healing Endpoint'leri** - No-code servis yÃ¶netimi
   - `POST /api/admin/redis/reconnect` - Redis baÄŸlantÄ±sÄ±nÄ± yenile
   - `POST /api/admin/postgres/reconnect` - PostgreSQL pool yenile
   - `POST /api/admin/clickhouse/reconnect` - ClickHouse client yenile

### DÃ¼zeltmeler
- Gateway route sÄ±ralamasÄ± dÃ¼zeltildi (spesifik route'lar Ã¶nce)
- ioredis paketi data-service'e eklendi
- Sistem SaÄŸlÄ±k sayfasÄ±ndaki "Yeniden BaÄŸlan" butonlarÄ± artÄ±k Ã§alÄ±ÅŸÄ±yor

---

## ğŸ“… v4.2.0 - 27 AralÄ±k 2025

**GeliÅŸmiÅŸ GÃ¶rselleÅŸtirme Widget'larÄ±**

### Yeni Widget Tipleri (5 adet)

| Widget | AÃ§Ä±klama | KullanÄ±m AlanÄ± |
|--------|----------|----------------|
| **Combo Chart** | Bar + Line (2 eksenli) | SatÄ±ÅŸ + Kar marjÄ± karÅŸÄ±laÅŸtÄ±rmasÄ± |
| **Scatter Plot** | DaÄŸÄ±lÄ±m grafiÄŸi | Korelasyon analizi |
| **Treemap** | HiyerarÅŸik alan grafiÄŸi | Kategori aÄŸÄ±rlÄ±klarÄ± |
| **Funnel Chart** | Huni grafiÄŸi | SatÄ±ÅŸ hunisi, dÃ¶nÃ¼ÅŸÃ¼m |
| **Heatmap** | IsÄ± haritasÄ± | YoÄŸunluk analizi, saat/gÃ¼n |

### Toplam Widget SayÄ±sÄ±: 19

| # | Widget | Kategori |
|---|--------|----------|
| 1 | KPI Card | Ã–zet |
| 2 | Big Number | Ã–zet |
| 3 | Comparison | KarÅŸÄ±laÅŸtÄ±rma |
| 4 | Ranking List | KarÅŸÄ±laÅŸtÄ±rma |
| 5 | Progress Bar | Trend |
| 6 | Gauge | Trend |
| 7 | Sparkline | Trend |
| 8 | Trend Card | Trend |
| 9 | Bar Chart | Grafik |
| 10 | Line Chart | Grafik |
| 11 | Area Chart | Grafik |
| 12 | Pie Chart | Grafik |
| 13 | Donut Chart | Grafik |
| 14 | Map Chart | Grafik |
| 15 | **Combo Chart** | Grafik (YENÄ°) |
| 16 | **Scatter Plot** | Grafik (YENÄ°) |
| 17 | **Treemap** | Grafik (YENÄ°) |
| 18 | **Funnel Chart** | Grafik (YENÄ°) |
| 19 | **Heatmap** | Grafik (YENÄ°) |

### DeÄŸiÅŸtirilen Dosyalar

- `services/analytics-service/src/index.ts` - 5 yeni visualization type eklendi
- `frontend/src/pages/AnalysisPage.tsx` - Recharts ComposedChart, ScatterChart, Treemap, FunnelChart import ve render
- `frontend/src/pages/DashboardPage.tsx` - AynÄ± widget'larÄ±n kokpit sayfasÄ± desteÄŸi
- Mevcut hiÃ§bir kod deÄŸiÅŸtirilmedi, sadece ekleme yapÄ±ldÄ±

---

## ğŸ“… v4.3.0 - 27 AralÄ±k 2025

**Drill-Down & Cross-Filter - BI Kritik Ã–zellikler**

### 1. âœ… Drill-Down (Detaya Ä°nme)
Widget'ta bir deÄŸere tÄ±klandÄ±ÄŸÄ±nda o deÄŸerin detaylarÄ±nÄ± gÃ¶steren modal.

- `POST /metrics/:metricId/drill-down` endpoint'i eklendi
- Frontend'de Drill-Down Modal implementasyonu
- Tablo formatÄ±nda veri gÃ¶sterimi (max 100 satÄ±r)
- `filterStore.ts`'e drillDown state eklendi

### 2. âœ… Cross-Filter (Widget'lar ArasÄ± Filtre)
Bir widget'ta tÄ±klama yapÄ±ldÄ±ÄŸÄ±nda diÄŸer widget'larÄ±n otomatik filtrelenmesi.

- `filterStore.ts`'e CrossFilter tipi ve state eklendi
- `addCrossFilter`, `removeCrossFilter`, `clearCrossFilters` action'larÄ±
- Cross-filter badge'leri (aktif filtreler gÃ¶rÃ¼nÃ¼r)
- Backend'de `_crossFilters` parametresi iÅŸleniyor
- `executeMetric` fonksiyonuna cross-filter desteÄŸi eklendi

### DeÄŸiÅŸtirilen Dosyalar:
- `frontend/src/stores/filterStore.ts` - CrossFilter, DrillDown state & actions
- `frontend/src/pages/AnalysisPage.tsx` - Widget onClick, Modal, Badge'ler
- `services/analytics-service/src/index.ts` - drill-down endpoint, crossFilters iÅŸleme

### KullanÄ±m:
1. **Bar/Pie Chart'ta tÄ±kla** â†’ Cross-filter uygulanÄ±r + Drill-down aÃ§Ä±lÄ±r
2. **Cross-filter badge'ine tÄ±kla** â†’ Filtreyi kaldÄ±r
3. **"TÃ¼mÃ¼nÃ¼ Temizle"** â†’ TÃ¼m cross-filtreleri sil

---

## ğŸ“… v4.3.1 - 27 AralÄ±k 2025

**Grafik Veri FormatÄ± & UI Ä°yileÅŸtirmeleri**

### 1. âœ… Grafik Veri FormatÄ± DÃ¼zeltmesi
- **Sorun**: Pasta/Bar/Line grafiklerinde GROUP BY sonuÃ§larÄ± tek dilim olarak gÃ¶rÃ¼nÃ¼yordu
- **Neden**: Backend `value` iÃ§inde array gÃ¶nderiyordu ama frontend `data` alanÄ±nÄ± arÄ±yordu
- **Ã‡Ã¶zÃ¼m**: `MetricResult` interface'ine `data?: any[]` eklendi
- Backend artÄ±k hem `value` hem `data` olarak array gÃ¶nderiyor

### 2. âœ… Limit (Top N) Ã–zelliÄŸi
- Metrik formuna "Limit (Top N)" dropdown eklendi
- SeÃ§enekler: Top 5, 10, 20, 50, 100, Limitsiz
- `chartConfig.limit` olarak kaydediliyor
- Backend'de `executeMetric` fonksiyonu limit deÄŸerini okuyor

### DeÄŸiÅŸtirilen Dosyalar:
- `services/analytics-service/src/index.ts`:
  - `MetricResult` interface'ine `data?: any[]` eklendi
  - Result oluÅŸtururken `data: Array.isArray(value) ? value : undefined` eklendi
  - LIMIT iÃ§in `chartConfigParsed?.limit` okunuyor
- `frontend/src/pages/MetricsPage.tsx`:
  - `formData.limit` state eklendi
  - UI'da Limit dropdown eklendi
  - `chartConfig.limit` kaydediliyor
  - SQL preview'da limit kullanÄ±lÄ±yor

### Test:
- Pasta grafik oluÅŸtur â†’ 5 farklÄ± dilim gÃ¶rÃ¼nmeli
- Bar grafik oluÅŸtur â†’ Top N kadar bar gÃ¶rÃ¼nmeli

---

## ğŸ“… v4.3.2 - 27 AralÄ±k 2025

**Cross-Filter Tam Ã‡alÄ±ÅŸÄ±r Hale Getirildi**

### 1. âœ… Cross-Filter Filtreleme DÃ¼zeltmesi
- **Sorun**: Badge ekleniyor ama grafikler filtrelenmiyordu
- **Neden**: `addCrossFilter` Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda veriler yeniden yÃ¼klenmiyordu
- **Ã‡Ã¶zÃ¼m**: `addCrossFilter`, `removeCrossFilter`, `clearCrossFilters` sonrasÄ± `loadDesignDetail` Ã§aÄŸrÄ±lÄ±yor

### 2. âœ… DÃ¼zeltilen Yerler
- Pie Chart onClick â†’ `addCrossFilter` + `loadDesignDetail`
- Bar Chart onClick â†’ `addCrossFilter` + `loadDesignDetail`
- Badge âœ• onClick â†’ `removeCrossFilter` + `loadDesignDetail`
- "TÃ¼mÃ¼nÃ¼ Temizle" onClick â†’ `clearCrossFilters` + `loadDesignDetail`

### 3. âœ… Beklenen DavranÄ±ÅŸ
| Aksiyon | SonuÃ§ |
|---------|-------|
| Ã‡ubuÄŸa/Dilime tÄ±kla | Sadece o Ã¶ÄŸe gÃ¶rÃ¼nÃ¼r + Badge eklenir + Drill-Down aÃ§Ä±lÄ±r |
| Badge âœ• tÄ±kla | TÃ¼m Ã¶ÄŸeler geri gelir |
| "TÃ¼mÃ¼nÃ¼ Temizle" | TÃ¼m Ã¶ÄŸeler geri gelir |

### DeÄŸiÅŸtirilen Dosyalar:
- `frontend/src/pages/AnalysisPage.tsx`:
  - `handlePieClick` â†’ `loadDesignDetail` eklendi
  - `handleBarClick` â†’ `loadDesignDetail` eklendi
  - `removeCrossFilter` onClick â†’ `loadDesignDetail` eklendi
  - `clearCrossFilters` onClick â†’ `loadDesignDetail` eklendi

---

## ğŸ“… v4.3.3 - 27 AralÄ±k 2025

**Cross-Filter Zustand Subscription DÃ¼zeltmesi**

### 1. âœ… Root Cause Bulundu ve DÃ¼zeltildi
- **Sorun**: GrafiÄŸe tÄ±klandÄ±ÄŸÄ±nda `addCrossFilter` Ã§aÄŸrÄ±lÄ±yordu ama `useEffect` tetiklenmiyordu
- **Neden**: Eski kod Ã§alÄ±ÅŸÄ±yordu (Vite hot reload sorunu)
- **Ã‡Ã¶zÃ¼m**: `useEffect` dependency'sine `crossFilters` eklendi, Zustand state gÃ¼ncellemesi dÃ¼zgÃ¼n Ã§alÄ±ÅŸÄ±yor

### 2. âœ… AkÄ±ÅŸ DoÄŸrulandÄ±
```
TÄ±klama â†’ addCrossFilter() â†’ Zustand state gÃ¼ncellenir â†’ 
useEffect tetiklenir â†’ loadDesignDetail() â†’ API Ã§aÄŸrÄ±sÄ± â†’ 
FiltrelenmiÅŸ veri dÃ¶ner â†’ Widget'lar gÃ¼ncellenir
```

### 3. âœ… Test SonuÃ§larÄ±
| Widget | Filtresiz | Filtreli (product_id=45) |
|--------|-----------|--------------------------|
| coreee | 61 | **1** âœ… |
| combo | 61 | **1** âœ… |
| Ä±sÄ± | 61 | **1** âœ… |
| barchart | 61 | **1** âœ… |
| skalater | 50 | 50 (farklÄ± dataset) |
| Treemap | 10 | 10 (product_id yok) |

### 4. âœ… Temizlik YapÄ±ldÄ±
- Debug loglarÄ± kaldÄ±rÄ±ldÄ± (ğŸ”´, ğŸŸ¢, ğŸ”¥, ğŸ“¥, ğŸŒ, ğŸ“¦)
- Console temiz

---

## ğŸ› ï¸ UZAKTAN YÃ–NETÄ°M & HEALTH CHECK

### SSH ile Uzaktan BaÄŸlantÄ±

```bash
# MÃ¼ÅŸteri sunucusuna baÄŸlan
ssh root@musteri-ip-adresi

# Ã–rnek:
ssh root@185.92.150.42
```

### Health Check Script

TÃ¼m servislerin durumunu tek komutla kontrol et:

```bash
./scripts/health-check.sh
```

**Kontrol Edilen Servisler:**
| Kategori | Servisler |
|----------|-----------|
| Docker Containers | PostgreSQL, ClickHouse, Redis |
| Backend Servisleri | Gateway (4000), Auth (4001), Core (4002), Data (4003), Notification (4004), Analytics (4005) |
| API Health | /health endpoint'leri |
| Frontend | Vite (3000) |
| DB BaÄŸlantÄ±larÄ± | PostgreSQL, ClickHouse, Redis ping |

**Ã–rnek Ã‡Ä±ktÄ±:**
```
ğŸ“¦ DOCKER CONTAINERS
  âœ… PostgreSQL Ã‡ALIÅIYOR
  âœ… ClickHouse Ã‡ALIÅIYOR
  âœ… Redis Ã‡ALIÅIYOR

ğŸ”§ BACKEND SERVÄ°SLERÄ°
  âœ… API Gateway (Port 4000) AÃ‡IK
  âœ… Auth Service (Port 4001) AÃ‡IK
  ...

ğŸ“Š Ã–ZET
  âœ… BaÅŸarÄ±lÄ±: 18
  âŒ BaÅŸarÄ±sÄ±z: 0
  ğŸ‰ TÃœM SÄ°STEMLER Ã‡ALIÅIYOR!
```

### DiÄŸer YÃ¶netim Scriptleri

| Script | AÃ§Ä±klama |
|--------|----------|
| `./scripts/start-all.sh` | TÃ¼m servisleri baÅŸlat |
| `./scripts/stop-all.sh` | TÃ¼m servisleri durdur |
| `./scripts/health-check.sh` | Sistem saÄŸlÄ±k kontrolÃ¼ |
| `docker logs <container>` | Container loglarÄ±nÄ± gÃ¶r |

### Hata Durumunda

```bash
# 1. Hangi servis Ã§alÄ±ÅŸmÄ±yor?
./scripts/health-check.sh

# 2. O servisin loguna bak
docker logs clixer_auth --tail 100

# 3. Servisi yeniden baÅŸlat
docker-compose restart auth-service

# 4. TÃ¼m sistemi yeniden baÅŸlat
./scripts/stop-all.sh && ./scripts/start-all.sh
```

---

## ğŸ“… v5.3.0 - 30 AralÄ±k 2025

**âœ… Rol vs Pozisyon AyrÄ±mÄ± & Profil YÃ¶netimi**

### 1. ROL ve POZÄ°SYON AYRIMI

| Kavram | AmaÃ§ | Ã–rnek |
|--------|------|-------|
| **Rol (role)** | Sistem yetkileri, menÃ¼ eriÅŸimi | ADMIN, MANAGER, USER, VIEWER |
| **Pozisyon (position)** | Veri eriÅŸimi (RLS), organizasyon yapÄ±sÄ± | GENERAL_MANAGER, REGIONAL_MANAGER, STORE_MANAGER |

**Kritik Kural:** `ADMIN` rolÃ¼ndeki kullanÄ±cÄ±lar pozisyon bazlÄ± menÃ¼ kÄ±sÄ±tlamalarÄ±ndan **MUAFtÄ±r**.

### 2. ADMIN ROL BYPASS

`frontend/src/stores/settingsStore.ts` - `canViewMenu` fonksiyonu:
```typescript
canViewMenu: (menuKey: string) => {
  const user = useAuthStore.getState().user
  if (user?.role === 'ADMIN') return true  // â† ADMIN her ÅŸeyi gÃ¶rÃ¼r
  // ... pozisyon bazlÄ± kontrol
}
```

### 3. SÄ°STEM ROLÃœ DROPDOWN

Admin Panel â†’ KullanÄ±cÄ±lar â†’ DÃ¼zenle'de "Sistem RolÃ¼" dropdown eklendi:
- ADMIN: TÃ¼m yetkiler, tÃ¼m menÃ¼ler
- MANAGER: YÃ¶netici yetkileri
- USER: Standart kullanÄ±cÄ±
- VIEWER: Sadece gÃ¶rÃ¼ntÃ¼leme

### 4. PROFÄ°L SAYFASI GÃœNCELLEMELERÄ°

| Ã–zellik | Durum | AÃ§Ä±klama |
|---------|-------|----------|
| Ad Soyad dÃ¼zenleme | âœ… | Profil â†’ DÃ¼zenle â†’ Kaydet |
| Email dÃ¼zenleme | âœ… | Profil â†’ DÃ¼zenle â†’ Kaydet (yeni email ile login gerekir) |
| Åifre deÄŸiÅŸtirme | âœ… | GÃ¼venlik sekmesi â†’ Mevcut/Yeni ÅŸifre |
| 2FA aktivasyon | âœ… | GÃ¼venlik sekmesi â†’ QR kod â†’ DoÄŸrulama kodu |

### 5. EMAÄ°L DEÄÄ°ÅTÄ°RME

Backend: `services/core-service/src/index.ts` - PUT /users/:id
- Email deÄŸiÅŸikliÄŸi varsa duplicate kontrolÃ¼ yapÄ±lÄ±r
- KÃ¼Ã§Ã¼k harfe dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼r ve trim edilir
- BaÅŸarÄ±lÄ± olursa authStore gÃ¼ncellenir

### 6. ÅÄ°FRE DEÄÄ°ÅTÄ°RME

Backend: `services/auth-service/src/index.ts` - POST /change-password
- Mevcut ÅŸifre doÄŸrulanÄ±r
- Yeni ÅŸifre policy kontrolÃ¼nden geÃ§er
- bcrypt ile hashlenir

### 7. 2FA (TOTP)

Backend: `services/auth-service/src/index.ts`
- POST /2fa/setup: QR kod ve secret oluÅŸturur
- POST /2fa/verify: Kodu doÄŸrular, 2FA aktifleÅŸtirir
- POST /2fa/disable: 2FA kapatÄ±r

### DEÄÄ°ÅTÄ°RÄ°LEN DOSYALAR

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `frontend/src/stores/settingsStore.ts` | ADMIN rol bypass |
| `frontend/src/stores/authStore.ts` | setUser action eklendi |
| `frontend/src/pages/AdminPage.tsx` | Sistem RolÃ¼ dropdown |
| `frontend/src/pages/ProfilePage.tsx` | Ad, Email dÃ¼zenleme + Åifre + 2FA UI |
| `services/core-service/src/index.ts` | Email gÃ¼ncelleme desteÄŸi |
| `services/auth-service/src/index.ts` | Åifre deÄŸiÅŸtirme, 2FA endpoint'leri |
| `shared/src/index.ts` | validatePassword export dÃ¼zeltmesi |

### MEVCUT ADMIN BÄ°LGÄ°LERÄ°

| Alan | DeÄŸer |
|------|-------|
| Email | `admin@clixer` |
| Åifre | `Admin123!` |
| Rol | ADMIN |
| Pozisyon | GENERAL_MANAGER |

---

## ğŸ“… v5.2.6 - 29 AralÄ±k 2025

**âœ… Widget Responsive DÃ¼zeltmeleri**

### 1. Sparkline & Trend Card TaÅŸma Sorunu Ã‡Ã¶zÃ¼ldÃ¼
- `min-h-0` eklendi (flexbox shrink iÃ§in kritik)
- `max-h-16` ile grafik maksimum yÃ¼ksekliÄŸi sÄ±nÄ±rlandÄ±rÄ±ldÄ±
- `overflow-hidden` hem container hem grafik div'ine eklendi
- Ãœst kÄ±sÄ±m `flex-shrink-0` ile sabitlendi

### 2. Sayfa Boyutu DeÄŸiÅŸince Crash Ã–nlendi
- Debounce sÃ¼resi 150ms â†’ 300ms'ye artÄ±rÄ±ldÄ±
- `isUnmounted` flag eklendi - component unmount olduysa state gÃ¼ncelleme engellendi

### 3. Font BoyutlarÄ± TutarlÄ± Hale Getirildi

| Widget | Ã–nceki | Sonraki |
|--------|--------|---------|
| Ä°lerleme - Ana DeÄŸer | `text-3xl` | `text-2xl` |
| GÃ¶sterge - Ana DeÄŸer | `text-3xl` | `text-2xl` |
| GÃ¶sterge - YÃ¼zde | `text-2xl` | `text-xl` |
| GÃ¶sterge - SVG | `w-24 h-14` | `w-20 h-12` |
| Sparkline - DeÄŸer | `text-3xl` | `text-2xl` |
| Trend Card - DeÄŸer | `text-3xl` | `text-2xl` |

### 4. Widget Layout YapÄ±sÄ± (STANDART)

```jsx
// Sparkline, Trend Card iÃ§in DOÄRU yapÄ±
<div className="flex-1 flex flex-col min-h-0 overflow-hidden">
  {/* Ãœst: DeÄŸer + Trend - Sabit */}
  <div className="flex-shrink-0">
    <p className="text-2xl font-bold">â‚º170</p>
    <div className="flex items-center gap-2 mt-1">
      <span className="badge">â†— +69.8%</span>
      <span className="text-xs">Son 30 gÃ¼n</span>
    </div>
  </div>
  
  {/* Alt: Grafik - TaÅŸmaz */}
  <div className="flex-1 min-h-0 mt-2 max-h-16 overflow-hidden">
    <Sparklines data={...} margin={4} height={64} style={{ width: '100%', height: '100%' }} />
  </div>
</div>
```

### 5. Kritik CSS KurallarÄ±

| Kural | AÃ§Ä±klama |
|-------|----------|
| `min-h-0` | Flexbox'ta shrink Ã§alÄ±ÅŸmasÄ± iÃ§in ZORUNLU |
| `flex-shrink-0` | Sabit yÃ¼kseklikli elemanlar iÃ§in |
| `max-h-16` | Grafik taÅŸmasÄ±nÄ± Ã¶nler |
| `overflow-hidden` | TaÅŸan iÃ§erik kesilir |

**Etkilenen Dosyalar:**
- `frontend/src/pages/AnalysisPage.tsx`
- `frontend/src/pages/DashboardPage.tsx`

---

## ğŸ“¦ SON BACKUP

- **Versiyon**: v5.3.0
- **Tarih**: 30 AralÄ±k 2025
- **Konum**: `backups/v5.3.0_role_profile_YYYYMMDD_HHMMSS/`
- **Ä°Ã§erik**: 
  - Kod: frontend, services, shared, gateway
  - PostgreSQL dump (DATA DAHÄ°L)
  - ClickHouse schema
  - MSSQL data
  - .cursorrules

---

## ğŸ“… v5.2.5 - 29 AralÄ±k 2025

**âœ… SÄ±ralama Listesi Otomatik Trend Hesaplama**

### YapÄ±lan DeÄŸiÅŸiklikler

1. âœ… **Otomatik Trend Hesaplama aktif edildi**
   - `analytics-service`'de `TODO: Otomatik trend hesaplama ÅŸimdilik devre dÄ±ÅŸÄ±` kaldÄ±rÄ±ldÄ±
   - MoM (Month-over-Month) trend hesaplamasÄ± Ã§alÄ±ÅŸÄ±yor

2. âœ… **Bug Fix'ler**
   - `chartConfig` â†’ `rankingChartConfig` deÄŸiÅŸken adÄ± dÃ¼zeltildi
   - Aggregate kolon regex'i iyileÅŸtirildi (`as value` alias'Ä± Ã¶ncelikli)
   - `tableName` artÄ±k `metric.clickhouse_table`'dan okunuyor (regex yerine)
   - `metadata.trendSource` override sorunu dÃ¼zeltildi

3. âœ… **Gateway Security Fix**
   - `/metrics/:id/execute` endpoint'i iÃ§in `execute` keyword'Ã¼ gÃ¼venlik filtresinden Ã§Ä±karÄ±ldÄ±
   - `suspiciousPatterns` regex'i gÃ¼ncellendi

### Test SonuÃ§larÄ± (10M satÄ±r - TEKSTIL_SATIS)

| ÃœrÃ¼n ID | DeÄŸer | Trend |
|---------|-------|-------|
| 1334 | â‚º50K | â†— 141.5% |
| 2793 | â‚º49K | â†— 168.9% |
| 3979 | â‚º49K | â†— 73.4% |
| 3509 | â‚º49K | â†— 87.7% |

### KullanÄ±m

Metrik oluÅŸturulurken "Otomatik Trend Hesapla" seÃ§eneÄŸi aÃ§Ä±ksa:
1. Backend geÃ§en ayÄ±n aynÄ± gÃ¼nÃ¼ne ait verileri Ã§eker
2. `(current - previous) / previous * 100` formÃ¼lÃ¼ ile trend hesaplanÄ±r
3. Pozitif â†’ YeÅŸil â†—, Negatif â†’ KÄ±rmÄ±zÄ± â†˜

### DeÄŸiÅŸtirilen Dosyalar

- `services/analytics-service/src/index.ts` - Trend hesaplama aktif ve dÃ¼zeltildi
- `gateway/src/index.ts` - Security filter gÃ¼ncellendi

---

## ğŸ”´ BÄ°LÄ°NEN SORUNLAR (v4.3.4)

### Cross-Filter Frontend Render Sorunu

**Durum:** âš ï¸ KÄ±smen Ã§alÄ±ÅŸÄ±yor

**Ã‡alÄ±ÅŸan:**
- Backend crossFilters parametresini alÄ±yor âœ…
- SQL'e WHERE koÅŸulu ekleniyor âœ…
- API doÄŸru filtrelenmiÅŸ veri dÃ¶nÃ¼yor âœ… (curl ile test edildi)

**Ã‡alÄ±ÅŸmayan:**
- Frontend'de grafikler filtrelenmiÅŸ veriyi gÃ¶stermiyor âŒ
- React state gÃ¼ncellenmiyor veya re-render olmuyor âŒ

**Denenenler:**
1. AbortController (race condition Ã¶nleme)
2. Cache bypass (crossFilters aktifken cache okumama)
3. useEffect dependency array dÃ¼zeltmeleri
4. Debug loglarÄ± ile state takibi

**Sonraki AdÄ±mlar:**
- React DevTools ile state deÄŸiÅŸikliklerini izle
- designWidgets state'inin gerÃ§ekten gÃ¼ncellenip gÃ¼ncellenmediÄŸini kontrol et
- Belki Zustand yerine useState ile test et

---

## ğŸ“… VERSÄ°YON GEÃ‡MÄ°ÅÄ° (GÃ¼ncel)

| Tarih | Versiyon | AÃ§Ä±klama |
|-------|----------|----------|
| 2025-12-30 | **v5.3.0** | **âœ… Rol vs Pozisyon AyrÄ±mÄ±, Profil YÃ¶netimi, 2FA, Email DeÄŸiÅŸtirme** |
| 2025-12-29 | v5.2.6 | Widget Responsive DÃ¼zeltmeleri - Sparkline, Gauge, Progress Stabil |
| 2025-12-29 | v5.2.5 | SÄ±ralama Listesi Otomatik Trend Hesaplama - 10M SatÄ±ra Kadar Ã‡alÄ±ÅŸÄ±yor |
| 2025-12-29 | v5.2.4 | RLS Tip Uyumluluk DÃ¼zeltmesi - Dashboard Veri GÃ¶rÃ¼nÃ¼mÃ¼ Ã‡alÄ±ÅŸÄ±yor |
| 2025-12-29 | v5.2.3 | ETL Sync Stratejileri Stabil - Full, ID-Based, Date Delete Ã‡alÄ±ÅŸÄ±yor |
| 2025-12-28 | v5.2.2 | ETL Sync Tam Ã‡alÄ±ÅŸÄ±r - ID-Based Cursor, MySQL Inline Query |
| 2025-12-28 | v5.2.1 | Dataset LIMIT YÃ¶netimi - Initial 10, Sync Full |
| 2025-12-28 | v5.2.0 | KapsamlÄ± Tip Mapping & Multi-DB DesteÄŸi |
| 2025-12-28 | v5.1.0 | Self-Healing ETL & Tip DÃ¶nÃ¼ÅŸÃ¼m Ä°yileÅŸtirmeleri |
| 2025-12-28 | v5.0.0 | ğŸš€ ENTERPRISE READY - Production Version |
| 2025-12-28 | v4.8.0 | No-Code Cache YÃ¶netimi - Admin Panel Performans AyarlarÄ± |
| 2025-12-28 | v4.7.0 | Production Ready - TypeScript TemizliÄŸi & Build Optimizasyonu |
| 2025-12-28 | v4.6.0 | Performans DanÄ±ÅŸmanÄ± - VeritabanÄ± Optimizasyon Ã–nerileri |
| 2025-12-27 | v4.5.2 | Ranking List 4-Kolon, Otomatik Trend (disabled), Gradient UI |
| 2025-12-27 | v4.3.4 | Cross-Filter backend Ã§alÄ±ÅŸÄ±yor, frontend sorunu devam ediyor |
| 2025-12-27 | v4.3.0 | Drill-Down & Cross-Filter implementasyonu |
| 2025-12-27 | v4.2.0 | 5 yeni widget (Combo, Scatter, Treemap, Funnel, Heatmap) |
| 2025-12-27 | v4.1.0 | 2FA, IP Whitelist, Session Management |
| 2025-12-27 | v4.0.0 | Tarih Filtresi & UI Ä°yileÅŸtirmeleri |

---

## ğŸ“… v5.0.0 - 28 AralÄ±k 2025

**ğŸš€ ENTERPRISE READY - Production Version**

### Bu SÃ¼rÃ¼mde Neler Var?

| Kategori | Ã–zellikler |
|----------|------------|
| **Widget** | 19 tip (KPI, Grafik, Harita, Combo, Treemap, Funnel, Heatmap, Scatter, vb.) |
| **BI Ã–zellikleri** | Drill-Down, Cross-Filter (backend Ã§alÄ±ÅŸÄ±yor) |
| **GÃ¼venlik** | RLS, 2FA, IP Whitelist, Password Policy, Session Management |
| **Performans** | No-Code Cache YÃ¶netimi, Performans DanÄ±ÅŸmanÄ±, ClickHouse OPTIMIZE |
| **UI/UX** | 5 Tema, Gradient Sidebar, Responsive, Glassmorphism |
| **ETL** | Streaming, ID-Based Sync, Progress Bar, Stuck Job Detection |
| **VeritabanÄ±** | PostgreSQL OLTP + ClickHouse OLAP + Redis Cache |

### Kapasiteler

| Metrik | DeÄŸer |
|--------|-------|
| EÅŸzamanlÄ± KullanÄ±cÄ± | 400+ |
| ClickHouse SatÄ±r | 100M+ |
| Dashboard YÃ¼klenme | <500ms (cache'li) |
| Widget SayÄ±sÄ± | 19 |
| Tema SayÄ±sÄ± | 5 |

### Yedekleme

- **Backup**: `backups/v5.0.0_enterprise_ready_20251228_192423/`
- **Boyut**: 1.3 GB
- **Ä°Ã§erik**: Frontend, Services, Shared, Gateway, Docker, Scripts, PostgreSQL, ClickHouse schema, Redis keys

---

## ğŸ“… v4.8.0 - 28 AralÄ±k 2025

**No-Code Cache YÃ¶netimi - Admin Panel Performans AyarlarÄ±**

### Yeni Ã–zellikler

1. âœ… **Admin Panel â†’ Performans Sekmesi**
   - Cache aktif/pasif toggle
   - Redis bellek limiti seÃ§imi (512MB - 8GB)
   - Eviction politikasÄ± seÃ§imi (LRU, LFU, TTL)
   - Cache temizleme butonlarÄ± (TÃ¼m, Dashboard, Metrikler)

2. âœ… **Cache TTL AyarlarÄ± (Parametrik)**
   - Dashboard cache sÃ¼resi (1dk - 1saat)
   - KPI kartlarÄ± cache sÃ¼resi (1dk - 15dk)
   - Grafik cache sÃ¼resi (5dk - 1saat)
   - Tablo cache sÃ¼resi (15dk - 2saat)

3. âœ… **ETL SonrasÄ± Cache Invalidation**
   - Otomatik cache temizleme toggle
   - ETL tamamlandÄ±ÄŸÄ±nda ilgili cache silinir

4. âœ… **Redis Ä°statistikleri (Real-time)**
   - KullanÄ±lan bellek
   - Toplam key sayÄ±sÄ±
   - Hit rate (%)
   - Uptime

5. âœ… **Backend API Endpoint'leri**
   - `GET /data/performance/redis` - Redis bilgileri
   - `POST /data/cache/clear` - Cache temizle

6. âœ… **ClickHouse OPTIMIZE**
   - Part sayÄ±sÄ± azaltÄ±ldÄ± (verimlilik artÄ±ÅŸÄ±)
   - 47M satÄ±rlÄ±k tablo: 4 part â†’ 1 part

### system_settings'e Eklenen Ayarlar

| Key | AÃ§Ä±klama | VarsayÄ±lan |
|-----|----------|------------|
| cache_enabled | Cache aktif/pasif | true |
| cache_redis_max_memory | Redis bellek limiti | 2gb |
| cache_redis_policy | Eviction politikasÄ± | allkeys-lru |
| cache_dashboard_ttl | Dashboard cache sÃ¼resi | 900 (15dk) |
| cache_kpi_ttl | KPI cache sÃ¼resi | 300 (5dk) |
| cache_chart_ttl | Grafik cache sÃ¼resi | 900 (15dk) |
| cache_table_ttl | Tablo cache sÃ¼resi | 1800 (30dk) |
| cache_invalidate_on_etl | ETL sonrasÄ± temizle | true |

### Yedekleme

- **Backup**: `backups/v4.8.0_performance_ui_20251228_182759/`
- **Ä°Ã§erik**: Frontend, Services, Shared, PostgreSQL dump

---

## ğŸ“… v4.7.0 - 28 AralÄ±k 2025

**Production Ready - TypeScript TemizliÄŸi & Build Optimizasyonu**

### DÃ¼zeltilen Hatalar (69 â†’ 0)

1. âœ… **Tema Property'leri Eklendi**
   - TÃ¼m temalara `border` property'si eklendi (light, dark, corporate, midnight, ember)
   - `inputBorder` eksik olan temalara (light, dark) eklendi

2. âœ… **Vite TypeScript DesteÄŸi**
   - `vite-env.d.ts` dosyasÄ± oluÅŸturuldu
   - `ImportMeta.env` tipi tanÄ±mlandÄ±

3. âœ… **DashboardPage.tsx DÃ¼zeltmeleri**
   - `widgetColor` tanÄ±msÄ±z deÄŸiÅŸken hatasÄ± â†’ `CHART_COLORS[0]` ile deÄŸiÅŸtirildi
   - React UMD global hatasÄ± â†’ `import React` eklendi

4. âœ… **AdminPage.tsx DÃ¼zeltmeleri**
   - `filter_value` eksik property â†’ userForm state'ine eklendi
   - Duplicate property hatasÄ± dÃ¼zeltildi

5. âœ… **DataPage.tsx DÃ¼zeltmeleri**
   - `partition_column` â†’ Dataset interface'ine eklendi
   - `api_auth_config` â†’ Connection interface'ine eklendi
   - Tip karÅŸÄ±laÅŸtÄ±rma sorunlarÄ± â†’ Connection type geniÅŸletildi

### Production Build

- âœ… TypeScript: 0 hata
- âœ… Vite build: BaÅŸarÄ±lÄ± (2.53s)
- âœ… Bundle size: 1.32 MB (gzip: 335 KB)

### Yedekleme

- **Backup**: `backups/v4.7.0_production_ready_20251228_180021/`
- **Ä°Ã§erik**: Frontend, Services, Shared, Gateway, PostgreSQL dump

---

## ğŸ“… v4.6.0 - 28 AralÄ±k 2025

**Performans DanÄ±ÅŸmanÄ± - Self-Service VeritabanÄ± Optimizasyonu**

### Yeni Ã–zellikler

1. âœ… **Veri BaÄŸlantÄ±larÄ± â†’ Performans DanÄ±ÅŸmanÄ± TabÄ±**
   - Yeni "Performans DanÄ±ÅŸmanÄ±" tabÄ± eklendi (DataPage)
   - PostgreSQL, ClickHouse, MÃ¼ÅŸteri DB'leri iÃ§in analiz

2. âœ… **PostgreSQL Analizi**
   - KullanÄ±lmayan index'lerin listesi ve silme butonu
   - Dead tuple tespiti ve VACUUM butonu
   - Seq scan fazla olan tablolar (index eksik uyarÄ±sÄ±)
   - BaÄŸlantÄ± durumu (aktif/max)
   - VeritabanÄ± boyutu

3. âœ… **ClickHouse Analizi**
   - Tablo boyutlarÄ± ve part sayÄ±sÄ±
   - OPTIMIZE gerekli tablolar
   - YavaÅŸ sorgular (son 24 saat, >3s)
   - "TÃ¼mÃ¼nÃ¼ Optimize Et" butonu
   - Partition daÄŸÄ±lÄ±mÄ±

4. âœ… **ETL Performans Analizi**
   - Dataset bazlÄ± sync sÃ¼releri
   - BaÅŸarÄ±/baÅŸarÄ±sÄ±zlÄ±k oranlarÄ±
   - SÄ±k karÅŸÄ±laÅŸÄ±lan hata patternleri
   - Toplam iÅŸlenen satÄ±r sayÄ±sÄ±

5. âœ… **MÃ¼ÅŸteri Veri KaynaklarÄ±**
   - MSSQL: Missing index Ã¶nerileri (SQL Server'Ä±n kendi Ã¶nerdiÄŸi)
   - MSSQL: Fragmented index tespiti
   - MySQL: Tablo boyutlarÄ± ve index durumu
   - PostgreSQL (uzak): Index ve vacuum analizi
   - Her baÄŸlantÄ± iÃ§in "Analiz Et" butonu

### API Endpoint'leri

| Endpoint | Metod | AÃ§Ä±klama |
|----------|-------|----------|
| `/data/performance/postgres` | GET | PostgreSQL analizi |
| `/data/performance/postgres/vacuum/:table` | POST | VACUUM Ã§alÄ±ÅŸtÄ±r |
| `/data/performance/postgres/index/:name` | DELETE | Index sil |
| `/data/performance/clickhouse` | GET | ClickHouse analizi |
| `/data/performance/clickhouse/optimize-all` | POST | TÃ¼m tablolarÄ± optimize et |
| `/data/performance/connections/:id` | GET | MÃ¼ÅŸteri DB analizi |
| `/data/performance/etl` | GET | ETL performans analizi |

### DeÄŸiÅŸtirilen Dosyalar

- `services/data-service/src/index.ts` - 7 yeni endpoint
- `frontend/src/pages/DataPage.tsx` - Performans DanÄ±ÅŸmanÄ± UI

### Rakip KarÅŸÄ±laÅŸtÄ±rmasÄ±

| Ã–zellik | Clixer | Power BI | Tableau | Qlik |
|---------|--------|----------|---------|------|
| Sistem performans monitÃ¶rÃ¼ | âœ… | âŒ | âŒ | âŒ |
| MÃ¼ÅŸteri DB index analizi | âœ… | âŒ | âŒ | âŒ |
| Otomatik optimize Ã¶nerileri | âœ… | âŒ | âŒ | âŒ |
| No-code index yÃ¶netimi | âœ… | âŒ | âŒ | âŒ |

### Yedekleme

- **Backup**: `backups/v4.6.0_performance_advisor_20251228_172338/`
- **Ä°Ã§erik**: Frontend, Services, Shared, PostgreSQL dump

---

## ğŸ”´ KRÄ°TÄ°K: BACKUP VE VERÄ° KORUMA KURALLARI

### ğŸ“¦ BACKUP KURALLARI (HER ZAMAN DATA DAHÄ°L!)

**Backup alÄ±rken SADECE ÅŸema deÄŸil, VERÄ°LER de dahil edilmeli:**

```bash
# âœ… DOÄRU BACKUP KOMUTU
BACKUP_DIR="backups/vX.X.X_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"

# 1. Kod backup
cp -r frontend services shared gateway scripts .cursorrules .env "$BACKUP_DIR/"

# 2. PostgreSQL (DATA DAHÄ°L!)
docker exec clixer_postgres pg_dump -U clixer -d clixer --no-owner > "$BACKUP_DIR/postgresql_full.sql"

# 3. ClickHouse schema + tablo bilgileri
mkdir -p "$BACKUP_DIR/clickhouse"
curl -s "http://localhost:8123/?user=clixer&password=clixer_click_2025" \
  --data "SELECT name, total_rows FROM system.tables WHERE database='clixer_analytics'" \
  > "$BACKUP_DIR/clickhouse/tables_info.txt"

# 4. Redis keys
docker exec clixer_redis redis-cli KEYS "*" > "$BACKUP_DIR/redis_keys.txt"
```

**Backup Ä°Ã§eriÄŸi Kontrol Listesi:**
| BileÅŸen | Dahil mi? | Kontrol |
|---------|-----------|---------|
| Kod (frontend, services, shared) | âœ… | `ls $BACKUP_DIR/frontend` |
| PostgreSQL DATA | âœ… | `wc -l postgresql_full.sql` > 1000 satÄ±r |
| ClickHouse schema | âœ… | `ls clickhouse/*.sql` |
| .cursorrules | âœ… | DokÃ¼mantasyon |
| .env | âœ… | Åifreler |

---

### ASLA YAPMA - VERÄ° KAYBI OLUR!

```bash
# âŒ ASLA Ã‡ALIÅTIRMA - TÃœM VERÄ°LER SÄ°LÄ°NÄ°R!
docker volume rm docker_postgres_data
docker volume rm docker_clickhouse_data
docker volume rm docker_redis_data

# âŒ ASLA YAPMA
docker-compose down -v  # -v flag'i volume'larÄ± siler!
```

### âœ… RESTART SONRASI BAÅLATMA PROSEDÃœRÃœ

```bash
# 1. Docker container'larÄ± kontrol et
docker ps

# 2. Container'lar Ã§alÄ±ÅŸmÄ±yorsa baÅŸlat
cd /Users/cihanadar/Downloads/clixer/docker
docker-compose up -d

# 3. Servisleri baÅŸlat
./scripts/start-all.sh

# 4. Test MySQL container (opsiyonel)
docker-compose -f docker-compose.test.yml up -d test-mysql
```

### ğŸ“‹ VERÄ°TABANI ÅÄ°FRELERÄ°

| VeritabanÄ± | Host | Port | User | Password |
|------------|------|------|------|----------|
| **PostgreSQL (Clixer)** | localhost | 5432 | clixer | clixer_secret_2025 |
| **ClickHouse** | localhost | 8123 | clixer | clixer_click_2025 |
| **Redis** | localhost | 6379 | - | - |
| **MySQL Test** | localhost | 3307 | testuser | TestPassword123! |
| **MySQL Root** | localhost | 3307 | root | TestPassword123! |

### ğŸ“‹ TEST VERÄ°TABANLARI

| VeritabanÄ± | Ä°Ã§erik | KayÄ±t |
|------------|--------|-------|
| `pa_clixer` (PostgreSQL) | 9M SatÄ±ÅŸ, MaÄŸazalar, ÃœrÃ¼nler | 9M+ |
| `test_university` (MySQL) | Ã–ÄŸrenci, Fatura, FakÃ¼lte | 50K Ã¶ÄŸrenci, 50K fatura |
| `test_erp` (MySQL) | ERP test verileri | DeÄŸiÅŸken |

### ğŸ”§ MySQL TÃœRKÃ‡E KARAKTER KURALI

MySQL baÄŸlantÄ±sÄ± ve tablo oluÅŸturma sÄ±rasÄ±nda **ZORUNLU**:

```sql
-- VeritabanÄ± oluÅŸturma
CREATE DATABASE dbname CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Tablo oluÅŸturma
CREATE TABLE tablo (...) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Sorgu Ã¶ncesi
SET NAMES utf8mb4;
```

```javascript
// Node.js MySQL baÄŸlantÄ±sÄ±
{
  charset: 'utf8mb4',
  // veya
  // --default-character-set=utf8mb4 (CLI)
}
```

### ğŸ”§ KAPSAMLI TÄ°P DÃ–NÃœÅÃœM KURALLARI (ZORUNLU)

**PostgreSQL, MySQL, SQL Server (MSSQL), Oracle â†’ ClickHouse dÃ¶nÃ¼ÅŸÃ¼mÃ¼:**

#### INTEGER TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| int, int4, integer | Int32 | PostgreSQL, MySQL, MSSQL |
| int2, smallint | Int16 | PostgreSQL, MySQL, MSSQL |
| int8, bigint | Int64 | PostgreSQL, MySQL, MSSQL |
| tinyint | Int8 | MySQL, MSSQL |
| mediumint | Int32 | MySQL |
| serial, bigserial, smallserial | Int32/Int64/Int16 | PostgreSQL |
| oid | UInt32 | PostgreSQL |
| year | Int16 | MySQL |
| number, pls_integer, binary_integer | Float64/Int32 | Oracle |

#### FLOAT TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| float, float8, double, double precision | Float64 | TÃ¼mÃ¼ |
| float4, real | Float32 | PostgreSQL |
| decimal, numeric, money | Float64 | TÃ¼mÃ¼ |
| **newdecimal** | **Float64** | **MySQL (internal type 246)** |
| smallmoney | Float64 | MSSQL |
| binary_float | Float32 | Oracle |
| binary_double | Float64 | Oracle |

#### STRING TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| text, varchar, char | String | TÃ¼mÃ¼ |
| character varying, character, bpchar | String | PostgreSQL |
| name, uuid, json, jsonb, xml | String | PostgreSQL |
| citext, inet, cidr, macaddr | String | PostgreSQL |
| tinytext, mediumtext, longtext | String | MySQL |
| enum, set | String | MySQL |
| nvarchar, nchar, ntext | String | MSSQL |
| uniqueidentifier, sql_variant, sysname | String | MSSQL |
| varchar2, nvarchar2, clob, nclob, long, rowid | String | Oracle |

#### TARÄ°H/ZAMAN TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| date | Date | TÃ¼mÃ¼ |
| newdate | Date | MySQL |
| time, timetz, interval | String | PostgreSQL |
| timestamp, timestamptz | DateTime | PostgreSQL |
| timestamp without/with time zone | DateTime | PostgreSQL |
| datetime | DateTime | MySQL, MSSQL |
| datetime2, smalldatetime, datetimeoffset | DateTime | MSSQL |
| timestamp with local time zone | DateTime | Oracle |

#### BOOLEAN TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| boolean, bool | UInt8 | PostgreSQL, MySQL |
| bit | UInt8 | MSSQL |

#### BINARY TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| bytea | String | PostgreSQL |
| blob, tinyblob, mediumblob, longblob | String | MySQL |
| binary, varbinary | String | MySQL, MSSQL |
| image | String | MSSQL |
| raw, long raw, bfile | String | Oracle |

#### GEOMETRY TÄ°PLERÄ°
| Kaynak Tip | ClickHouse Tip | Kaynak DB |
|------------|----------------|-----------|
| geometry, geography | String | MSSQL, PostgreSQL |
| point, linestring, polygon | String | MySQL, PostgreSQL |

### ğŸ”§ SAYISAL KOLON OTOMATÄ°K ALGILAMA

Kolon adÄ±nda aÅŸaÄŸÄ±daki kelimeler geÃ§iyorsa â†’ **Float64** olarak tanÄ±mla:

```javascript
const numericPatterns = [
  'amount', 'tutar', 'price', 'fiyat', 'total', 'toplam', 
  'adet', 'quantity', 'miktar', 'indirim', 'discount', 
  'brut', 'net', 'gross', 'ucret', 'maas', 'salary', 'fee',
  'cost', 'maliyet', 'borc', 'alacak', 'bakiye', 'balance'
];
```

### ğŸ”§ UNIQUE KOLON ALGILA (TÃ¼rkÃ§e Dahil)

```javascript
const uniqueCandidates = [
  'id', 'code', 'kod',  // â† TÃ¼rkÃ§e 'kod' eklendi
  'uuid', 'pk', 'primary_key', '_id', 'key', 'unique_id',
  'magaza_kodu', 'store_code'  // â† Ã–zel kolonlar
];
```

### ğŸ”§ POSTGRESQL OID â†’ TÄ°P ADI DÃ–NÃœÅÃœMÃœ

```javascript
const pgTypeMap: Record<number, string> = {
  16: 'bool', 20: 'int8', 21: 'int2', 23: 'int4', 25: 'text',
  700: 'float4', 701: 'float8', 1042: 'char', 1043: 'varchar',
  1082: 'date', 1114: 'timestamp', 1184: 'timestamptz', 1700: 'numeric'
};
```

### ğŸ”§ MYSQL TYPE ID â†’ TÄ°P ADI DÃ–NÃœÅÃœMÃœ

```javascript
const mysqlTypeMap: Record<number, string> = {
  0: 'decimal', 1: 'tinyint', 2: 'smallint', 3: 'int', 4: 'float', 5: 'double',
  6: 'null', 7: 'timestamp', 8: 'bigint', 9: 'mediumint', 10: 'date', 11: 'time',
  12: 'datetime', 13: 'year', 14: 'newdate', 15: 'varchar', 16: 'bit',
  245: 'json', 246: 'newdecimal', 247: 'enum', 248: 'set', 249: 'tinyblob',
  250: 'mediumblob', 251: 'longblob', 252: 'blob', 253: 'varchar', 254: 'char',
  255: 'geometry'
};
```

### ğŸ”§ TÄ°P DÃ–NÃœÅÃœM UYGULANMA YERLERÄ°

| Dosya | DeÄŸiÅŸken/Fonksiyon | AmaÃ§ |
|-------|-------------------|------|
| `frontend/src/pages/DataPage.tsx` | `SQL_TO_CLICKHOUSE_TYPE` | UI'da tip Ã¶nizleme |
| `services/data-service/src/index.ts` | `SQL_TO_CLICKHOUSE_TYPE` | API endpoint'lerde tip dÃ¶nÃ¼ÅŸÃ¼m |
| `services/etl-worker/src/index.ts` | `SQL_TO_CLICKHOUSE_TYPE` + `mapSourceTypeToClickHouse()` | ETL sÄ±rasÄ±nda tablo oluÅŸturma |
| `services/data-service/src/index.ts` | `pgTypeMap` | PostgreSQL OID â†’ Tip AdÄ± |
| `services/data-service/src/index.ts` | `mysqlTypeMap` | MySQL Type ID â†’ Tip AdÄ± |

---

## ğŸ”„ DATASET OLUÅTURMA & SYNC AKIÅI

### ğŸ”´ MUTLAK KURAL: KAYNAK NE OLURSA OLSUN MANTIK AYNI!

**PostgreSQL, MySQL, MSSQL, Oracle, API** - Fark etmez. AkÄ±ÅŸ her zaman:

```
AÅAMA 1: DATASET OLUÅTURMA (UI'dan)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQL EditÃ¶r â†’ SELECT * FROM faturalar LIMIT 10               â”‚
â”‚              â†“                                               â”‚
â”‚ Ã‡alÄ±ÅŸtÄ±r â†’ 10 satÄ±r + kolon tipleri gÃ¶rÃ¼ntÃ¼lenir            â”‚
â”‚              â†“                                               â”‚
â”‚ Dataset OluÅŸtur â†’ source_query LIMIT dahil kaydedilir       â”‚
â”‚              â†“                                               â”‚
â”‚ ClickHouse â†’ BOÅ TABLO oluÅŸturulur (VERÄ° YOK!)              â”‚
â”‚              â†“                                               â”‚
â”‚ âš ï¸ initial_sync TETÄ°KLENMEZ! KullanÄ±cÄ± bekler...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AÅAMA 2: MANUEL SYNC (KullanÄ±cÄ± Butona Basar)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KullanÄ±cÄ± â†’ "â–¶ Sync BaÅŸlat" butonuna basar                  â”‚
â”‚              â†“                                               â”‚
â”‚ ETL Worker â†’ source_query'den LIMIT/TOP KALDIRILIR          â”‚
â”‚              â†“                                               â”‚
â”‚ Full Refresh â†’ TRUNCATE + TÃœM veri Ã§ekilir                  â”‚
â”‚ ID-Based â†’ Cursor/Pagination (5000'erlik batch)             â”‚
â”‚ Timestamp â†’ Son deÄŸiÅŸenler                                   â”‚
â”‚              â†“                                               â”‚
â”‚ row_limit varsa uygulanÄ±r (Ã¶rn: 10M satÄ±r)                  â”‚
â”‚              â†“                                               â”‚
â”‚ ClickHouse'a streaming yazÄ±lÄ±r                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Neden Bu Kurgu?

1. **50M satÄ±rlÄ±k tablo olabilir** - Direkt TÃœM veriyi Ã§ekmek tehlikeli
2. **Tip uyumsuzluÄŸu olabilir** - 50M satÄ±r Ã§ektikten sonra hata vermesi felaket
3. **LIMIT 10 ile Ã¶nce test** - Tipler uyumlu mu, INSERT Ã§alÄ±ÅŸÄ±yor mu?
4. **Sonra Full Refresh** - Sorun yoksa TÃœM veriyi Ã§ek

### â— KRÄ°TÄ°K: Ä°LK OLUÅTURMA vs SYNC (v5.2.1 - 28 AralÄ±k 2025)

**1. Dataset OluÅŸturma (Ä°lk AdÄ±m) - SADECE TABLO OLUÅTUR:**
- `source_query` LIMIT DAHÄ°L kaydedilir (Ã¶rn: `SELECT * FROM faturalar LIMIT 10`)
- ClickHouse'da BOÅ tablo oluÅŸturulur (kolon tipleri belirlenir)
- âš ï¸ **VERÄ° YAZILMAZ!** `initial_sync` TETÄ°KLENMEZ!
- KullanÄ±cÄ± kolonlarÄ± ve tipleri UI'da gÃ¶rÃ¼r

**2. Manuel Sync (KullanÄ±cÄ± Butona Basar):**
- KullanÄ±cÄ± "Sync BaÅŸlat" butonuna basar
- ETL Worker `source_query`'deki LIMIT'i **KALDIRIR**
- `sync_strategy`'ye gÃ¶re:
  - **Full Refresh:** TRUNCATE + TÃœM veri (LIMIT yok)
  - **ID-Based:** Cursor/Pagination (5000'erlik batch)
  - **Timestamp-Based:** Son deÄŸiÅŸen kayÄ±tlar
- `row_limit` varsa o kadar satÄ±r Ã§ekilir (Ã¶rn: 10M)

**3. NEDEN initial_sync KALDIRILDI?**
- ESKÄ° HATA: Dataset oluÅŸturulunca otomatik Full Refresh yapÄ±lÄ±yordu
- SONUÃ‡: LIMIT 10 yazsan bile 50K veri geliyordu!
- YENÄ°: KullanÄ±cÄ± ne zaman isterse o zaman sync yapar

**ETL Worker'da LIMIT Temizleme (sync sÄ±rasÄ±nda):**
```javascript
// PostgreSQL, MySQL iÃ§in:
query = query.replace(/\s+LIMIT\s+\d+\s*/gi, ' ').trim();

// MSSQL iÃ§in:
query = query.replace(/\bSELECT\s+TOP\s*\(?(\d+)\)?\s+/gi, 'SELECT ').trim();

// KullanÄ±cÄ±nÄ±n row_limit'i varsa yeniden ekle
if (rowLimit) {
  query += ` LIMIT ${rowLimit}`; // veya TOP iÃ§in regex
}
```

### Uygulanan Dosyalar

| Dosya | Fonksiyon | AÃ§Ä±klama |
|-------|-----------|----------|
| `frontend/src/pages/DataPage.tsx` | `handleCreateDataset()` | LIMIT dahil kaydeder (ilk test) |
| `etl-worker/src/index.ts` | `streamingPostgreSQLSync()` | Sync'te LIMIT kaldÄ±rÄ±r |
| `etl-worker/src/index.ts` | `mssqlSync()` | Sync'te TOP kaldÄ±rÄ±r |
| `etl-worker/src/index.ts` | `mysqlSync()` | Sync'te LIMIT kaldÄ±rÄ±r |

### ğŸ”´ Ã–ZET: BU KURGU DEÄÄ°ÅMEZ! (v5.2.2 - 28 AralÄ±k 2025)

| Kaynak DB | Test Sorgusu | Kaydedilen (source_query) | Ä°lk OluÅŸturma (initial_sync) | Sonraki Sync |
|-----------|--------------|---------------------------|------------------------------|--------------|
| PostgreSQL | `SELECT * LIMIT 10` | `SELECT * LIMIT 10` | âœ… **10 satÄ±r** | TÃœM VERÄ° |
| MySQL | `SELECT * LIMIT 10` | `SELECT * LIMIT 10` | âœ… **10 satÄ±r** | TÃœM VERÄ° |
| MSSQL | `SELECT TOP 10 *` | `SELECT TOP 10 *` | âœ… **10 satÄ±r** | TÃœM VERÄ° |
| Oracle | `WHERE ROWNUM <= 10` | `WHERE ROWNUM <= 10` | âœ… **10 satÄ±r** | TÃœM VERÄ° |
| API | `?limit=10` | `?limit=10` | âœ… **10 satÄ±r** | TÃœM VERÄ° |

**Prensip:** 
1. Dataset oluÅŸturulunca â†’ `initial_sync` tetiklenir â†’ LIMIT korunarak 10 satÄ±r yazÄ±lÄ±r
2. Manuel Sync'te â†’ LIMIT kaldÄ±rÄ±lÄ±r â†’ Strateji'ye gÃ¶re (Full/ID-Based/Timestamp) veri Ã§ekilir
3. ID-Based Sync â†’ `WHERE id > max_id` ile sadece YENÄ° kayÄ±tlar eklenir (TRUNCATE yok!)

---

## ğŸ”„ ID-BASED SYNC - CURSOR/PAGINATION MANTIÄI

### Problem
```javascript
// âŒ ESKÄ° KOD (YANLIÅ - Bellek patlar!)
const query = `SELECT * FROM table WHERE id > ? LIMIT 10000000`;
const [rows] = await conn.execute(query); // 10M satÄ±r BELLEÄE!
```

### Ã‡Ã¶zÃ¼m: Cursor/Pagination + Inline Query (MySQL iÃ§in)
```javascript
// âœ… YENÄ° KOD (DOÄRU - 5000'erlik parÃ§alar)
// âš ï¸ MySQL prepared statement LIMIT hatasÄ± nedeniyle deÄŸerler inline yazÄ±lÄ±yor!
const BATCH_SIZE = 5000;
let currentMaxId = maxId;

// MySQL iÃ§in YANLIÅ (prepared statement hatasÄ±):
// const query = `SELECT * FROM table WHERE id > ? LIMIT ?`;
// await conn.execute(query, [currentMaxId, BATCH_SIZE]); // âŒ HATA!

// MySQL iÃ§in DOÄRU (inline values):
const query = `SELECT * FROM table WHERE id > ${currentMaxId} LIMIT ${BATCH_SIZE}`;
await conn.query(query); // âœ… Ã‡ALIÅIR!

while (hasMoreData) {
  const [rows] = await conn.execute(
    `SELECT * FROM table WHERE id > ? ORDER BY id LIMIT ?`,
    [currentMaxId, BATCH_SIZE]
  );
  
  if (rows.length === 0) break;
  
  await clickhouse.insert(table, rows);
  currentMaxId = rows[rows.length - 1].id;
  totalInserted += rows.length;
}
```

### AvantajlarÄ±
| Ã–zellik | Eski YapÄ± | Yeni YapÄ± |
|---------|-----------|-----------|
| Bellek kullanÄ±mÄ± | 10M satÄ±r = PATLAMA | 5K satÄ±r = OK |
| 50M satÄ±r sync | âŒ Timeout/OOM | âœ… Ã‡alÄ±ÅŸÄ±r |
| Progress bar | AnlÄ±k deÄŸil | GerÃ§ek zamanlÄ± |
| Hata durumu | TÃ¼m veri kaybolur | KaldÄ±ÄŸÄ± yerden devam |

### Uygulanan Dosyalar
- `etl-worker/src/index.ts` â†’ `syncById()` fonksiyonu
- MSSQL, MySQL, PostgreSQL iÃ§in cursor mantÄ±ÄŸÄ± eklendi

---

## ğŸ“… v5.2.2 - 28 AralÄ±k 2025

**âœ… ETL Sync Tam Ã‡alÄ±ÅŸÄ±r Hale Getirildi**

### DÃ¼zeltilen Sorunlar

1. âœ… **MySQL Prepared Statement HatasÄ±**
   - **Sorun**: `Incorrect arguments to mysqld_stmt_execute` hatasÄ±
   - **Neden**: MySQL `LIMIT` ile prepared statement parametrelerini kabul etmiyor
   - **Ã‡Ã¶zÃ¼m**: `conn.execute` yerine `conn.query` kullanÄ±ldÄ±, deÄŸerler inline yazÄ±ldÄ±

2. âœ… **Initial Sync ile 10 SatÄ±r Yazma**
   - Dataset oluÅŸturulunca `initial_sync` tetikleniyor
   - `initialTestSync` fonksiyonu LIMIT'i koruyarak 10 satÄ±r yazÄ±yor
   - Tip testi baÅŸarÄ±lÄ± olursa kullanÄ±cÄ± manuel sync baÅŸlatabilir

3. âœ… **ID-Based Sync Cursor/Pagination**
   - 5000'erlik batch'lerle veri Ã§ekme aktif
   - `WHERE id > currentMaxId` ile sadece yeni kayÄ±tlar
   - TRUNCATE yok, mevcut verilere ekleme yapÄ±lÄ±yor

4. âœ… **Duplicate TemizliÄŸi**
   - `OPTIMIZE TABLE FINAL` her sync sonrasÄ± Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor
   - ReplacingMergeTree ile duplicate'lar otomatik merge ediliyor

### Test SonuÃ§larÄ± (MySQL - 50.000 satÄ±r)

| AdÄ±m | Beklenen | GerÃ§ekleÅŸen | Durum |
|------|----------|-------------|-------|
| Ä°lk oluÅŸturma | 10 satÄ±r | 10 satÄ±r | âœ… |
| ID-Based 1. sync | 49.990 satÄ±r | 49.990 satÄ±r | âœ… |
| ID-Based 2. sync | 0 satÄ±r | 0 satÄ±r | âœ… |
| Toplam | 50.000 satÄ±r | 50.000 satÄ±r | âœ… |

### DeÄŸiÅŸtirilen Dosyalar

- `services/etl-worker/src/index.ts`:
  - `syncById` iÃ§in `conn.query` kullanÄ±mÄ± (inline values)
  - `initialTestSync` fonksiyonu eklendi
  - `OPTIMIZE TABLE FINAL` eklendi
- `.cursorrules` - DokÃ¼mantasyon gÃ¼ncellemesi

---

## ğŸ”„ ETL SYNC STRATEJÄ°LERÄ° - STABÄ°L YAPI (v5.2.3 - 29 AralÄ±k 2025)

### âœ… TEST EDÄ°LMÄ°Å VE Ã‡ALIÅAN STRATEJÄ°LER

| Strateji | Kod | DavranÄ±ÅŸ | Test Durumu |
|----------|-----|----------|-------------|
| **Full Refresh** | `full_refresh` | TÃ¼m veriyi sil, tamamÄ±nÄ± yeniden yaz | âœ… Ã‡alÄ±ÅŸÄ±yor |
| **ID-Based** | `id` | Cursor/pagination ile sadece yeni kayÄ±tlarÄ± ekle | âœ… Ã‡alÄ±ÅŸÄ±yor |
| **Date Delete & Insert** | `date_delete_insert` | Son X gÃ¼nÃ¼ sil, son X gÃ¼nÃ¼ yeniden yaz | âœ… Ã‡alÄ±ÅŸÄ±yor |
| **Timestamp-Based** | `timestamp` | Son sync'ten sonra deÄŸiÅŸenleri gÃ¼ncelle | â³ Test edilecek |

### ğŸ“Š FULL REFRESH

```
AkÄ±ÅŸ: TRUNCATE â†’ TÃ¼m veriyi Ã§ek â†’ INSERT
KullanÄ±m: KÃ¼Ã§Ã¼k tablolar, referans veriler
Avantaj: En basit, tutarlÄ±
Dezavantaj: BÃ¼yÃ¼k tablolarda yavaÅŸ
```

### ğŸ”¢ ID-BASED SYNC (Cursor/Pagination)

```javascript
// 5000'lik batch'lerle Ã§eker - BELLEK DOLMAZ!
const BATCH_SIZE = 5000;
let currentMaxId = await getMaxIdFromClickHouse();

while (hasMoreData) {
  // MySQL iÃ§in INLINE QUERY (prepared statement hatasÄ±!)
  const query = `SELECT * FROM table WHERE id > ${currentMaxId} ORDER BY id LIMIT ${BATCH_SIZE}`;
  const rows = await conn.query(query);
  
  await clickhouse.insert(table, rows);
  currentMaxId = rows[rows.length - 1].id;
}
```

**Kritik Kurallar:**
- MySQL: `conn.query()` kullan, `conn.execute()` HATALI (prepared statement LIMIT sorunu)
- PostgreSQL: `client.query(sql, [params])` kullan - prepared statement Ã‡ALIÅIR
- MSSQL: `pool.request().query()` kullan - inline query Ã‡ALIÅIR
- Her batch sonrasÄ± progress gÃ¼ncelle
- 50M+ satÄ±r bile Ã§ekilebilir

### ğŸ“… DATE DELETE & INSERT

```javascript
// 1. ClickHouse'tan son X gÃ¼nÃ¼ SÄ°L
await clickhouse.execute(`
  ALTER TABLE ${table} DELETE WHERE toDate(${dateColumn}) >= '${startDate}'
`);

// 2. Kaynak DB'den son X gÃ¼nÃ¼ Ã‡EK
// MySQL:
WHERE ${dateColumn} >= DATE_SUB(CURDATE(), INTERVAL ${days} DAY)

// PostgreSQL:
WHERE ${dateColumn} >= CURRENT_DATE - INTERVAL '${days} days'

// MSSQL:
WHERE ${dateColumn} >= DATEADD(day, -${days}, CAST(GETDATE() AS DATE))
```

**GÃ¼n Hesaplama MantÄ±ÄŸÄ±:**
| UI SeÃ§eneÄŸi | delete_days | FormÃ¼l | Ã–rnek (BugÃ¼n 28 AralÄ±k) |
|-------------|-------------|--------|-------------------------|
| BugÃ¼n | 0 | `= CURDATE()` | 28 AralÄ±k (1 gÃ¼n) |
| Son 1 gÃ¼n | 1 | `>= CURDATE() - 1` | 27-28+ AralÄ±k (2+ gÃ¼n) |
| Son 3 gÃ¼n | 3 | `>= CURDATE() - 3` | 25-28+ AralÄ±k (4+ gÃ¼n) |
| Son 7 gÃ¼n | 7 | `>= CURDATE() - 7` | 21-28+ AralÄ±k (8+ gÃ¼n) |
| Son 30 gÃ¼n | 30 | `>= CURDATE() - 30` | 28 KasÄ±m-28+ AralÄ±k |

**Kritik:** `toDate()` fonksiyonu SAAT DÄ°KKATE ALMAZ, sadece tarih bazlÄ± Ã§alÄ±ÅŸÄ±r!

### ğŸ”§ TÃœM DB TÄ°PLERÄ° Ä°Ã‡Ä°N AYNI MANTIK

| Ã–zellik | MySQL | PostgreSQL | MSSQL |
|---------|-------|------------|-------|
| Cursor/Pagination | âœ… | âœ… | âœ… |
| Batch Size | 5000 | 5000 | 5000 |
| Query Tipi | Inline (conn.query) | Prepared (client.query) | Inline (pool.request) |
| Date Filter | DATE_SUB(CURDATE()...) | CURRENT_DATE - INTERVAL | DATEADD(day, -, CAST...) |
| LIMIT Syntax | LIMIT N | LIMIT N | TOP N |

### ğŸ“‹ DATASET OLUÅTURMA AKIÅI

```
1. UI'da SQL yaz: SELECT * FROM tablo LIMIT 10
2. Ã‡alÄ±ÅŸtÄ±r â†’ 10 satÄ±r gÃ¶rÃ¼ntÃ¼lenir, tipler algÄ±lanÄ±r
3. Dataset OluÅŸtur â†’ source_query LIMIT DAHÄ°L kaydedilir
4. initial_sync tetiklenir â†’ 10 satÄ±r ClickHouse'a yazÄ±lÄ±r (tip testi)
5. KullanÄ±cÄ± "Sync BaÅŸlat" der â†’ LIMIT kaldÄ±rÄ±lÄ±r, strateji'ye gÃ¶re sync yapÄ±lÄ±r
```

### ğŸ›¡ï¸ DUPLICATE Ã–NLEME

1. **ReplacingMergeTree Engine** - AynÄ± ORDER BY key'e sahip satÄ±rlardan en yeni kalÄ±r
2. **OPTIMIZE TABLE FINAL** - Her sync sonrasÄ± Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r
3. **Unique Kolon Zorunlu** - ORDER BY iÃ§in (View'larda composite key)

### âš ï¸ VIEW'LAR Ä°Ã‡Ä°N Ã–ZEL DURUM

- View'larda unique kolon OLMAZ â†’ UyarÄ± ile devam edilebilir
- Composite ORDER BY kullanÄ±lÄ±r (ilk 5 kolon)
- **ID-Based sync Ã‡ALIÅMAZ** â†’ Full Refresh veya Date Delete kullan

### ğŸ“ ETL WORKER DOSYA KONUMLARI

| Fonksiyon | Dosya | SatÄ±r (yaklaÅŸÄ±k) |
|-----------|-------|------------------|
| `fullRefresh` | etl-worker/src/index.ts | 800-900 |
| `syncById` | etl-worker/src/index.ts | 1550-1850 |
| `syncByDateDeleteInsert` | etl-worker/src/index.ts | 1970-2130 |
| `syncByTimestamp` | etl-worker/src/index.ts | 1400-1500 |
| `mysqlSync` | etl-worker/src/index.ts | 2800-3000 |
| `streamingPostgreSQLSync` | etl-worker/src/index.ts | 1030-1280 |
| `mssqlSync` | etl-worker/src/index.ts | 2500-2700 |

---

## ğŸ“… v5.2.0 - 28 AralÄ±k 2025

**KapsamlÄ± Tip Mapping & Multi-DB DesteÄŸi**

### Eklenen Ã–zellikler

1. âœ… **KapsamlÄ± Tip Mapping** - 80+ SQL tipi â†’ ClickHouse karÅŸÄ±lÄ±klarÄ±
2. âœ… **Multi-Database DesteÄŸi** - PostgreSQL, MySQL, MSSQL, Oracle
3. âœ… **ETL Worker Tip DÃ¶nÃ¼ÅŸÃ¼m** - `mapSourceTypeToClickHouse()` fonksiyonu
4. âœ… **SayÄ±sal Kolon AlgÄ±lama GeniÅŸletildi** - 20+ TÃ¼rkÃ§e/Ä°ngilizce pattern
5. âœ… **Binary Tip DesteÄŸi** - blob, bytea, image, raw â†’ String
6. âœ… **Geometry Tip DesteÄŸi** - geometry, geography, point â†’ String
7. âœ… **Oracle Tip DesteÄŸi** - varchar2, number, clob, nclob

### GÃ¼ncellenen Dosyalar

- `frontend/src/pages/DataPage.tsx` - 80+ tip mapping
- `services/data-service/src/index.ts` - 80+ tip mapping
- `services/etl-worker/src/index.ts` - `mapSourceTypeToClickHouse()` + 80+ tip mapping
- `.cursorrules` - KapsamlÄ± tip mapping dokÃ¼mantasyonu

---

## ğŸ“… v5.1.0 - 28 AralÄ±k 2025

**Self-Healing ETL & Tip DÃ¶nÃ¼ÅŸÃ¼m Ä°yileÅŸtirmeleri**

### Eklenen Ã–zellikler

1. âœ… **Self-Healing ETL** - Tablo yoksa otomatik oluÅŸtur (`ensureTableExists`)
2. âœ… **PostgreSQL OID â†’ Tip AdÄ±** - 1043â†’varchar, 23â†’int4
3. âœ… **MySQL Type ID â†’ Tip AdÄ±** - 246â†’newdecimal, 3â†’int
4. âœ… **newdecimal â†’ Float64** - Frontend ve Backend
5. âœ… **TÃ¼rkÃ§e Unique Kolon** - 'kod' algÄ±lama
6. âœ… **SayÄ±sal Kolon AlgÄ±lama** - tutar, adet, indirim â†’ Float64
7. âœ… **ClickHouse Yeniden BaÄŸlan** - UI butonu eklendi

### DÃ¼zeltilen Sorunlar

1. âœ… ClickHouse health check authentication hatasÄ±
2. âœ… PostgreSQL OID sayÄ±sal ID gÃ¶sterme sorunu
3. âœ… MySQL newdecimal â†’ String dÃ¶nÃ¼ÅŸÃ¼m hatasÄ±
4. âœ… TÃ¼rkÃ§e karakter sorunu (utf8mb4)
5. âœ… Tablo yoksa sync hatasÄ± â†’ Otomatik oluÅŸturma

### DeÄŸiÅŸtirilen Dosyalar

- `services/data-service/src/index.ts` - OID mapping, newdecimal
- `services/etl-worker/src/index.ts` - ensureTableExists, sayÄ±sal algÄ±lama
- `services/core-service/src/index.ts` - ClickHouse auth fix
- `frontend/src/pages/DataPage.tsx` - newdecimal, kod algÄ±lama, yeniden baÄŸlan

asla geÃ§iÃ§i Ã§Ã¶zÃ¼mler uygulanmyacak. bir hata keÅŸfedildiyse bunun Ã§Ã¶zÃ¼mÃ¼ kalÄ±cÄ± olarak uygulamada yapÄ±lacak.

---

## ğŸ“… v6.4.0 - 31 AralÄ±k 2025

**Login SayfasÄ± Clixer TemasÄ± & JWT Fix & Schedule Fix**

### 1. âœ… Login SayfasÄ± Clixer TemasÄ±na UyumlandÄ±

| Ã–ÄŸe | DeÄŸer |
|-----|-------|
| Arka Plan | Coal (#0F1116) |
| Kart | Anthracite (#181B21) |
| Border | Surface Highlight (#2F3542) |
| Input | Surface (#21252E) |
| Accent | Neon Cyan (#00CFDE) |
| Buton | Neon Cyan gradient |

### 2. âœ… Logo SilÃ¼eti Kart Ä°Ã§ine TaÅŸÄ±ndÄ±

- `logo-dark.png` eklendi (koyu arka planlÄ± logo)
- Siluet kart iÃ§inde, formun arkasÄ±nda %6 opacity
- Sayfa arka planÄ±nda da bÃ¼yÃ¼k siluet mevcut

### 3. âœ… JWT Secret UyumsuzluÄŸu DÃ¼zeltildi

**Problem:** Auth Service ve Data Service farklÄ± JWT_SECRET kullanÄ±yordu
- Auth Service: `.env`'den okuyordu
- Data Service: Default fallback kullanÄ±yordu

**Ã‡Ã¶zÃ¼m:** TÃ¼m servisler yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda `.env`'den okuyorlar

### 4. âœ… Schedule next_run_at DÃ¼zeltmesi

**Problem:** Schedule oluÅŸturulduÄŸunda `next_run_at` ayarlanmÄ±yordu, gelecek tarihe atanÄ±yordu

**Ã‡Ã¶zÃ¼m:** `data-service/src/index.ts`'de:
```sql
-- Schedule oluÅŸturulurken
INSERT INTO etl_schedules (..., next_run_at) VALUES (..., NOW())

-- Schedule gÃ¼ncellenirken  
UPDATE etl_schedules SET next_run_at = NOW(), ...
```

### 5. âœ… Token GeÃ§erlilik KontrolÃ¼

- `App.tsx`: Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda token geÃ§erliliÄŸi kontrol ediliyor
- `api.ts`: Login endpoint'inde 401 gelirse logout yapmÄ±yor

### DeÄŸiÅŸtirilen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `frontend/src/pages/LoginPage.tsx` | Clixer temasÄ±, siluet logo |
| `frontend/src/App.tsx` | Token geÃ§erlilik kontrolÃ¼ |
| `frontend/src/services/api.ts` | Login 401 bypass |
| `frontend/public/logo-dark.png` | Yeni logo dosyasÄ± |
| `services/data-service/src/index.ts` | next_run_at = NOW() |

### Login Bilgileri

```
Email: admin@clixer
Åifre: Admin1234!
```

---

## ğŸ“… v6.5.0 - 2 Ocak 2026

**Production Ready - Debug TemizliÄŸi & GÃ¼venlik KontrolÃ¼**

### 1. âœ… Console.log TemizliÄŸi (34+ log kaldÄ±rÄ±ldÄ±)

| Dosya | Temizlenen |
|-------|------------|
| DesignerPage.tsx | 12 emoji debug log |
| App.tsx | 3 [APP] log |
| MetricsPage.tsx | 7 debug log |
| AnalysisPage.tsx | 1 filtre log |
| DashboardPage.tsx | 1 filtre log |
| DataPage.tsx | 2 API log |
| Layout.tsx | 1 render log |
| AdminPage.tsx | 2 ayar log |
| authStore.ts | 1 rehydrate log |
| settingsStore.ts | 3 settings log |
| filterStore.ts | 1 filter log |

### 2. âœ… GÃ¼venlik KontrolÃ¼ TamamlandÄ±

| Ã–zellik | Durum |
|---------|-------|
| Helmet.js | âœ… CSP, HSTS aktif |
| CORS | âœ… Production whitelist |
| Rate Limiting | âœ… 200/dk genel, 10/15dk login |
| SQL Injection | âœ… shared/security.ts |
| XSS | âœ… CSP + React escape |
| JWT | âœ… 15dk access, 7 gÃ¼n refresh |
| Hardcoded Secrets | âœ… .env'de, gitignore'da |

### 3. âœ… Build KontrolÃ¼

```
TypeScript: 0 hata
Vite build: 2.78s
Bundle: 1.34MB (gzip: 340KB)
```

### Yedekleme

- **Backup**: `backups/v6.5.0_production_ready_20260102_113720/`
- **Ä°Ã§erik**: Frontend, Services, Shared, Gateway, PostgreSQL dump

---

## ğŸ“‹ VERSÄ°YON GEÃ‡MÄ°ÅÄ° (Ã–zet - GÃ¼ncel)

| Tarih | Versiyon | AÃ§Ä±klama |
|-------|----------|----------|
| 2026-01-04 | **v2.0-prod** | **ğŸš€ Production Ready - Ubuntu Kurulum, Nginx, SSL, Firewall** |
| 2026-01-04 | v1.1 | Kod + PostgreSQL veritabanÄ± yedeÄŸi |
| 2026-01-04 | v1 | Ä°lk Windows kurulum sÃ¼rÃ¼mÃ¼ |
| 2026-01-02 | v6.5.0 | Production Ready - Debug TemizliÄŸi & GÃ¼venlik KontrolÃ¼ |
| 2025-12-31 | v6.4.0 | Login Clixer TemasÄ±, JWT Fix, Schedule Fix |
| 2025-12-31 | v6.3.0 | KonuÅŸma geÃ§miÅŸi, Clixer varsayÄ±lan tema |
| 2025-12-30 | v6.2.0 | Clixer temasÄ± tasarÄ±mÄ± |
| 2025-12-30 | v6.1.0 | API POST Sync |
| 2025-12-30 | v6.0.0 | Logo entegrasyonu |

---

## ğŸ“… v2.0-prod - 4 Ocak 2026

**ğŸš€ Production Ready - MÃ¼ÅŸteri Ubuntu Sunucusu iÃ§in HazÄ±r**

### GitHub Repository
- **URL**: https://github.com/absadama/clixer_windows
- **Branch**: main
- **Tags**: v1, v1.1, v2.0

### Eklenen Production DosyalarÄ±

| Dosya | AÃ§Ä±klama |
|-------|----------|
| `deploy/install-ubuntu.sh` | Tek komutla Ubuntu kurulum scripti |
| `deploy/README-PRODUCTION.md` | Production kurulum dÃ¶kÃ¼manÄ± |
| `db-backup/postgresql_full.sql` | PostgreSQL veritabanÄ± yedeÄŸi |
| `docker/clickhouse/users.xml` | ClickHouse clixer kullanÄ±cÄ±sÄ± |

### Ubuntu Sunucu Kurulumu (SSH ile)

```bash
# 1. Sunucuya baÄŸlan
ssh root@SUNUCU_IP

# 2. Tek komutla kur
curl -fsSL https://raw.githubusercontent.com/absadama/clixer_windows/main/deploy/install-ubuntu.sh | sudo bash

# 3. SSL sertifikasÄ± al
sudo certbot --nginx -d analytics.domain.com
```

### Kurulum Scripti Neler Yapar?

1. âœ… Sistem gÃ¼ncellemesi
2. âœ… Docker + Docker Compose kurulumu
3. âœ… Node.js 20 kurulumu
4. âœ… Clixer kullanÄ±cÄ±sÄ± oluÅŸturma (/opt/clixer)
5. âœ… GitHub'dan kod Ã§ekme
6. âœ… .env dosyasÄ± oluÅŸturma
7. âœ… PostgreSQL, ClickHouse, Redis baÅŸlatma
8. âœ… VeritabanÄ± yedeÄŸini yÃ¼kleme
9. âœ… npm install tÃ¼m servislerde
10. âœ… Nginx reverse proxy yapÄ±landÄ±rma
11. âœ… UFW Firewall (22, 80, 443)
12. âœ… Fail2ban gÃ¼venlik

### GiriÅŸ Bilgileri

| Alan | DeÄŸer |
|------|-------|
| URL | http://SUNUCU_IP veya https://domain.com |
| Email | admin@clixer |
| Åifre | Admin1234! |

---

## ğŸ”´ GITHUB YEDEKLEMEYÄ° GÄ°TMEYENLER (KRÄ°TÄ°K!)

GitHub'a `.gitignore` nedeniyle GÄ°TMEYEN dosyalar:

| Dosya/KlasÃ¶r | Neden | Ã‡Ã¶zÃ¼m |
|--------------|-------|-------|
| `.env` | GÃ¼venlik (ÅŸifreler) | `.env.example` kopyala |
| `node_modules/` | Ã‡ok bÃ¼yÃ¼k | `npm install` |
| `docker/*_data/` | VeritabanÄ± verileri | Docker oluÅŸturur |
| `dist/`, `build/` | Derlenen dosyalar | `npm run build` |
| `backups/` | Yedekler | Ã‡ok bÃ¼yÃ¼k |

### Yeni Kurulumda YapÄ±lacaklar

```bash
# 1. .env oluÅŸtur
cp .env.example .env

# 2. BaÄŸÄ±mlÄ±lÄ±klarÄ± kur
cd shared && npm install && npm run build && cd ..
npm install --prefix gateway
npm install --prefix services/auth-service
# ... diÄŸer servisler

# 3. PostgreSQL yedeÄŸini yÃ¼kle (varsa)
docker exec -i clixer_postgres psql -U clixer -d clixer < db-backup/postgresql_full.sql
```

---

## ğŸ“¦ FULL YEDEK KURALI

"Full yedek al" dediÄŸinde:
1. âœ… TÃ¼m kod GitHub'a push
2. âœ… PostgreSQL dump alÄ±nÄ±p `db-backup/` klasÃ¶rÃ¼ne eklenmeli
3. âœ… ClickHouse tablolar varsa dump alÄ±nmalÄ±
4. âœ… GitHub'a commit + push + tag

---

## ğŸ”´ PRODUCTION PRE-DEPLOYMENT KONTROL LÄ°STESÄ° (ZORUNLU!)

### MUTLAK KURAL: Yedek almadan ve production'a deploy etmeden Ã¶nce bu kontroller ZORUNLU!

**"Yedek al" veya "GitHub'a gÃ¶nder" dediÄŸinde ÅŸu kontroller OTOMATÄ°K yapÄ±lmalÄ±:**

### 1. API Testleri (api-tester)
```powershell
# TÃ¼m servisler Ã§alÄ±ÅŸÄ±yor mu?
- Gateway (4000): /health
- Auth (4001): /health
- Core (4002): /health
- Data (4003): /health
- Notification (4004): /health
- Analytics (4005): /health
- Login test: POST /api/auth/login
```

### 2. VeritabanÄ± SaÄŸlÄ±ÄŸÄ± (db-health)
```powershell
# TÃ¼m veritabanlarÄ± eriÅŸilebilir mi?
- PostgreSQL: pg_isready
- ClickHouse: SELECT 1
- Redis: PING â†’ PONG
```

### 3. GÃ¼venlik Denetimi (security-audit)
```powershell
# GÃ¼venlik Ã¶nlemleri aktif mi?
- CORS yapÄ±landÄ±rÄ±lmÄ±ÅŸ mÄ±?
- Helmet.js security headers aktif mi?
- Rate limiting Ã§alÄ±ÅŸÄ±yor mu?
- .env dosyasÄ± gitignore'da mÄ±?
- Hardcoded ÅŸifre var mÄ±? (grep ile kontrol)
```

### 4. Production DosyalarÄ± (deploy-checker)
```powershell
# Production iÃ§in gerekli dosyalar mevcut mu?
- deploy/install-ubuntu.sh
- deploy/README-PRODUCTION.md
- db-backup/postgresql_full.sql (gÃ¼ncel mi?)
- .env.example
- docker/docker-compose.yml
```

### 5. Build KontrolÃ¼
```powershell
# TypeScript hatasÄ±z build oluyor mu?
cd shared && npm run build
cd frontend && npm run build
```

### 6. GitHub Sync
```powershell
# TÃ¼m deÄŸiÅŸiklikler commit edilmiÅŸ mi?
git status --porcelain
# BoÅŸ dÃ¶nmeli, deÄŸiÅŸiklik varsa UYAR!
```

### Kontrol BaÅŸarÄ±sÄ±z Olursa:
âŒ **YEDEK ALINMAZ!**
âŒ **GITHUB'A PUSH YAPILMAZ!**
âŒ **PRODUCTION'A DEPLOY EDÄ°LMEZ!**

Ã–nce sorun Ã§Ã¶zÃ¼lÃ¼r, sonra tekrar kontrol edilir.

---

## ğŸ¯ PRODUCTION MÄ°NDSET (HER ZAMAN HATIRLA!)

### MUTLAK KURAL: Her hamle mÃ¼ÅŸteri sunucusu dÃ¼ÅŸÃ¼nÃ¼lerek yapÄ±lacak!

1. **Kod deÄŸiÅŸikliÄŸi yaparken:**
   - "Bu deÄŸiÅŸiklik mÃ¼ÅŸteri sunucusunda Ã§alÄ±ÅŸÄ±r mÄ±?"
   - "Ubuntu'da Docker ile sorunsuz Ã§alÄ±ÅŸÄ±r mÄ±?"
   - ".env baÄŸÄ±mlÄ±lÄ±ÄŸÄ± var mÄ±? .env.example gÃ¼ncellendi mi?"

2. **Yeni Ã¶zellik eklerken:**
   - "GitHub'dan Ã§ekildiÄŸinde Ã§alÄ±ÅŸÄ±r mÄ±?"
   - "npm install yeterli mi, yoksa baÅŸka kurulum gerekli mi?"
   - "Database migration gerekiyor mu?"

3. **Yedek alÄ±rken:**
   - "PostgreSQL dump gÃ¼ncel mi?"
   - "TÃ¼m testler geÃ§iyor mu?"
   - "Security audit temiz mi?"

4. **Deploy Ã¶ncesi:**
   - "install-ubuntu.sh scripti gÃ¼ncel mi?"
   - "README-PRODUCTION.md doÄŸru mu?"
   - "TÃ¼m servisler health check geÃ§iyor mu?"

### MÃ¼ÅŸteri Sunucusu DÃ¼ÅŸÃ¼ncesi:
```
Her commit = MÃ¼ÅŸteriye gidecek kod
Her push = Production'a deploy edilebilir olmalÄ±
Her tag = Stabil, test edilmiÅŸ sÃ¼rÃ¼m
```

---

## ğŸ¤– CLIXER AI AGENT SÄ°STEMÄ°

### Agent DosyalarÄ±: `.claude/agents/`

| Agent | Dosya | GÃ¶rev |
|-------|-------|-------|
| api-tester | `api-tester.md` | TÃ¼m API endpoint'lerini test eder |
| db-health | `db-health.md` | PostgreSQL, ClickHouse, Redis durumu |
| deploy-checker | `deploy-checker.md` | Production Ã¶ncesi kontroller |
| security-audit | `security-audit.md` | GÃ¼venlik aÃ§Ä±klarÄ± taramasÄ± |
| etl-validator | `etl-validator.md` | ETL job'larÄ± ve veri tutarlÄ±lÄ±ÄŸÄ± |
| verify-app | `verify-app.md` | Uygulama Ã§alÄ±ÅŸÄ±yor mu doÄŸrulamasÄ± |

### KullanÄ±m:
- "API testlerini Ã§alÄ±ÅŸtÄ±r"
- "VeritabanlarÄ± saÄŸlÄ±klÄ± mÄ±?"
- "Production'a deploy edebilir miyiz?"
- "GÃ¼venlik aÃ§Ä±ÄŸÄ± var mÄ±?"
- "Uygulama Ã§alÄ±ÅŸÄ±yor mu?"

---

## ğŸ“‹ SLASH KOMUTLARI (Gelecek Ã–zellik)

`.claude/commands/` klasÃ¶rÃ¼nde tanÄ±mlanacak:

| Komut | AÃ§Ä±klama |
|-------|----------|
| `/full-backup` | TÃ¼m kontroller + PostgreSQL dump + GitHub push + tag |
| `/deploy-check` | Production Ã¶ncesi tÃ¼m kontrolleri Ã§alÄ±ÅŸtÄ±r |
| `/health-check` | TÃ¼m servislerin saÄŸlÄ±k durumunu kontrol et |
| `/security-scan` | GÃ¼venlik taramasÄ± yap |

---

## ğŸ”„ PostToolUse Hook (Gelecek Ã–zellik)

Kod yazÄ±ldÄ±ktan sonra otomatik format dÃ¼zeltme:

```json
{
  "PostToolUse": [
    {
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "command",
          "command": "npm run format || true"
        }
      ]
    }
  ]
}
```

---

## ğŸ“… v2.1-prod - 4 Ocak 2026

**Production Mindset & Pre-Deployment Kontrolleri**

1. âœ… Production pre-deployment kontrol listesi eklendi
2. âœ… AI Agent sistemi dokÃ¼mante edildi
3. âœ… "Her hamle mÃ¼ÅŸteri sunucusu dÃ¼ÅŸÃ¼nÃ¼lerek" kuralÄ± eklendi
4. âœ… Yedek almadan Ã¶nce zorunlu kontroller tanÄ±mlandÄ±
5. âœ… Slash komutlarÄ± ve PostToolUse hook planlandÄ±

---

## ğŸ“… v3.1 - 4 Ocak 2026

**MÃ¼ÅŸteri Kurulumu TemizliÄŸi - Test Verileri KaldÄ±rÄ±ldÄ±**

### Sorun
`docker/init-scripts/postgres/00-schema-and-seed.sql` dosyasÄ± eski `pg_dump` Ã§Ä±ktÄ±sÄ±ydÄ± ve tÃ¼m test verileri (kullanÄ±cÄ±lar, tasarÄ±mlar, metrikler, baÄŸlantÄ±lar) iÃ§eriyordu. Docker container'larÄ± baÅŸlatÄ±ldÄ±ÄŸÄ±nda bu veriler otomatik yÃ¼kleniyordu.

### Ã‡Ã¶zÃ¼m
1. âœ… Init script sadece ÅŸema + temel seed iÃ§erecek ÅŸekilde yeniden oluÅŸturuldu
2. âœ… Test kullanÄ±cÄ±larÄ± kaldÄ±rÄ±ldÄ± (sadece admin@clixer kalÄ±yor)
3. âœ… Test tasarÄ±mlarÄ±, metrikleri, baÄŸlantÄ±larÄ± kaldÄ±rÄ±ldÄ±
4. âœ… `db-backup/postgresql_full.sql` temiz veri ile gÃ¼ncellendi
5. âœ… `docker/docker-compose.db.yml` eklendi (Windows iÃ§in sadece DB container'larÄ±)

### MÃ¼ÅŸteri Kurulumunda ArtÄ±k:
| Tablo | Ä°Ã§erik |
|-------|--------|
| users | Sadece `admin@clixer` |
| designs | BOÅ |
| metrics | BOÅ |
| data_connections | BOÅ |
| datasets | BOÅ |
| positions | 6 varsayÄ±lan pozisyon |

### GiriÅŸ Bilgileri
- **Email**: `admin@clixer`
- **Åifre**: `Admin1234!`

### Init Script KuralÄ± (KRÄ°TÄ°K!)
```
docker/init-scripts/postgres/00-schema-and-seed.sql:
- ASLA pg_dump Ã§Ä±ktÄ±sÄ± olarak bÄ±rakÄ±lmamalÄ±!
- Sadece CREATE TABLE + temel INSERT iÃ§ermeli
- Test verileri ASLA dahil edilmemeli
```

---

## ğŸ“… v3.2 - 4 Ocak 2026

**Dinamik Etiketler & Token Refresh & Route DÃ¼zeltmeleri**

### 1. âœ… Dinamik Etiket Sistemi (labels tablosu)

MenÃ¼ baÅŸlÄ±klarÄ± ve pozisyon isimleri artÄ±k ÅŸirketten ÅŸirkete deÄŸiÅŸtirilebilir.

| Ã–zellik | AÃ§Ä±klama |
|---------|----------|
| `labels` tablosu | PostgreSQL'de tenant bazlÄ± etiketler |
| CRUD Endpoint'leri | `/labels`, `/labels/:type`, `/labels/batch` |
| Admin Panel | YÃ¶netim Paneli â†’ Etiketler sekmesi |
| Sidebar | Dinamik menÃ¼ isimleri |
| Pozisyonlar | Dinamik pozisyon isimleri |

**Tablo YapÄ±sÄ±:**
```sql
CREATE TABLE labels (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  label_type VARCHAR(50) NOT NULL, -- 'menu', 'position'
  label_key VARCHAR(100) NOT NULL, -- 'stores', 'STORE_MANAGER'
  label_value VARCHAR(200) NOT NULL, -- 'Magazalar', 'Magaza Muduru'
  description TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  UNIQUE (tenant_id, label_type, label_key)
);
```

**VarsayÄ±lan Etiketler (ASCII):**
```
MenÃ¼: Kokpit, Finans, Operasyon, Detayli Analiz, Magazalar, Tasarim Studyosu, Veri Baglantilari, Yonetim Paneli
Pozisyon: Genel Mudur, Direktor, Bolge Muduru, Magaza Muduru, Analist, Izleyici
```

### 2. âœ… Token Refresh MekanizmasÄ±

JWT token sÃ¼resi dolduÄŸunda otomatik yenileme.

| BileÅŸen | DeÄŸiÅŸiklik |
|---------|------------|
| `authStore.ts` | `refreshToken` state + `refreshAccessToken()` fonksiyonu |
| `api.ts` | Axios interceptor - 401'de otomatik refresh |
| `auth-service` | `/refresh` endpoint (zaten mevcuttu) |

**AkÄ±ÅŸ:**
```
401 Unauthorized â†’ refreshAccessToken() â†’ Yeni token â†’ Ä°stek tekrarla
Refresh baÅŸarÄ±sÄ±z â†’ logout()
```

### 3. âœ… Route SÄ±ralama DÃ¼zeltmesi

**Sorun:** `/labels/batch` route'u `/labels/:id`'den SONRA tanÄ±mlÄ±ydÄ±. Express "batch"i UUID olarak algÄ±lÄ±yordu.

**Ã‡Ã¶zÃ¼m:** `/labels/batch` artÄ±k `/labels/:id`'den Ã–NCE:
```javascript
app.put('/labels/batch', ...)  // Ã–NCELÄ°KLÄ°
app.put('/labels/:id', ...)    // SONRA
```

### 4. âœ… React Router v6 UyarÄ±larÄ± DÃ¼zeltildi

```typescript
<BrowserRouter future={{ v7_startTransition: true, v7_relativeSplatPath: true }}>
```

### DeÄŸiÅŸtirilen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `docker/init-scripts/postgres/00-schema-and-seed.sql` | labels tablosu + seed |
| `services/core-service/src/index.ts` | CRUD endpoint'leri, route sÄ±ralamasÄ± |
| `frontend/src/pages/AdminPage.tsx` | Etiketler sekmesi UI |
| `frontend/src/components/Layout.tsx` | Dinamik menÃ¼ isimleri |
| `frontend/src/stores/settingsStore.ts` | Pozisyon etiketleri |
| `frontend/src/stores/authStore.ts` | refreshToken, refreshAccessToken |
| `frontend/src/services/api.ts` | 401 interceptor + token refresh |
| `frontend/src/main.tsx` | React Router future flags |
| `frontend/src/App.tsx` | Manuel token check kaldÄ±rÄ±ldÄ± |

### KullanÄ±m

1. **Etiket DeÄŸiÅŸtirme:** Admin Panel â†’ Etiketler â†’ DÃ¼zenle â†’ Kaydet
2. **Ã–rnek:** "Magazalar" â†’ "Restoranlar" (restoran zinciri mÃ¼ÅŸterisi iÃ§in)
3. **Pozisyon:** "Magaza Muduru" â†’ "Restoran Muduru"

### Yedekleme

- **Backup:** `backups/v3.2_dynamic_labels_20260104/`
- **GitHub Tag:** `v3.2`

---

## ğŸ”´ ROUTE SIRALAMA KURALI (Express.js)

### MUTLAK KURAL: Parametrik route'lar (:id) her zaman SONA!

Express.js route'larÄ± tanÄ±mlanma sÄ±rasÄ±na gÃ¶re eÅŸleÅŸir. Parametrik route'lar Ã¶zel route'lardan SONRA tanÄ±mlanmalÄ±.

**DOÄRU:**
```javascript
app.get('/users/me', ...)       // Ã–zel route - Ã–NCELÄ°KLÄ°
app.put('/labels/batch', ...)   // Ã–zel route - Ã–NCELÄ°KLÄ°
app.get('/users/:id', ...)      // Parametrik - SONDA
app.put('/labels/:id', ...)     // Parametrik - SONDA
```

**YANLIÅ:**
```javascript
app.get('/users/:id', ...)      // âŒ "me" burada yakalanÄ±r!
app.get('/users/me', ...)       // âŒ Buraya asla ulaÅŸÄ±lmaz
```

### Etkilenen Endpoint'ler

| Ã–zel Route | Parametrik Route |
|------------|------------------|
| `/labels/batch` | `/labels/:id` |
| `/users/me` | `/users/:id` |
| `/designs/templates` | `/designs/:id` |

---

## ğŸ¨ VARSAYILAN TEMA: CLÄ°XER

### MUTLAK KURAL: VarsayÄ±lan tema her zaman 'clixer' olmalÄ±!

**Prensip:** KullanÄ±cÄ± tema deÄŸiÅŸtirmediÄŸi sÃ¼rece Clixer temasÄ± aktif olmalÄ±.

### Uygulama Yerleri

| Konum | DeÄŸer | Dosya |
|-------|-------|-------|
| Frontend varsayÄ±lan | `'clixer'` | `Layout.tsx:226` |
| settingsStore varsayÄ±lan | `'clixer'` | `settingsStore.ts:84` |
| VeritabanÄ± seed | `'clixer'` | `00-schema-and-seed.sql` |
| system_settings | `"clixer"` | PostgreSQL |

### Tema SeÃ§enekleri

| Tema | AÃ§Ä±klama | Renk Paleti |
|------|----------|-------------|
| **clixer** | Koyu tema (varsayÄ±lan) | Coal, Anthracite, Neon Cyan |
| light | AÃ§Ä±k tema | Beyaz, Gri, Ä°ndigo |
| corporate | Kurumsal tema | Teal, Koyu yeÅŸil tonlarÄ± |

### DeÄŸiÅŸiklik Yaparken

1. Yeni tema eklenirse â†’ Clixer varsayÄ±lan kalsÄ±n
2. KullanÄ±cÄ± tema seÃ§erse â†’ LocalStorage'a kaydedilir
3. Yeni kurulum â†’ Clixer ile aÃ§Ä±lÄ±r
4. VeritabanÄ± sÄ±fÄ±rlanÄ±rsa â†’ Clixer seed edilir

---

## ğŸ”´ CLICKHOUSE KULLANICI YÃ–NETÄ°MÄ° (KRÄ°TÄ°K!)

### MUTLAK KURAL: ClickHouse kullanÄ±cÄ±larÄ± XML ile yÃ¶netilir, ENV ile DEÄÄ°L!

### Sorun (v3.3 Ã¶ncesi)

Docker Compose'da `CLICKHOUSE_USER` ve `CLICKHOUSE_PASSWORD` environment deÄŸiÅŸkenleri kullanÄ±ldÄ±ÄŸÄ±nda:

1. ClickHouse otomatik olarak `/etc/clickhouse-server/users.d/default-user.xml` dosyasÄ± oluÅŸturur
2. Bu dosyada `<default remove="remove">` satÄ±rÄ± var â†’ **Default kullanÄ±cÄ± SÄ°LÄ°NÄ°R!**
3. SonuÃ§: Hem `default` hem `clixer` kullanÄ±cÄ±sÄ± Ã‡ALIÅMAZ
4. Hata: `Authentication failed: password is incorrect, or there is no user with such name`

### Ã‡Ã¶zÃ¼m

1. **CLICKHOUSE_USER ve CLICKHOUSE_PASSWORD environment deÄŸiÅŸkenlerini KULLANMA!**
2. KullanÄ±cÄ±larÄ± `docker/clickhouse/users.xml` dosyasÄ± ile yÃ¶net
3. Bu dosyayÄ± Docker volume olarak mount et

### docker-compose.yml (DOÄRU)

```yaml
clickhouse:
  image: clickhouse/clickhouse-server:25.12.1
  environment:
    CLICKHOUSE_DB: clixer_analytics
    # âŒ CLICKHOUSE_USER: clixer         # KULLANMA!
    # âŒ CLICKHOUSE_PASSWORD: ...        # KULLANMA!
    CLICKHOUSE_MAX_MEMORY_USAGE: 6000000000
  volumes:
    - clickhouse_data:/var/lib/clickhouse
    - ./clickhouse/users.xml:/etc/clickhouse-server/users.d/users.xml  # âœ… XML ile yÃ¶net
```

### docker/clickhouse/users.xml (ZORUNLU DOSYA)

```xml
<?xml version="1.0"?>
<clickhouse>
    <users>
        <!-- Default user (ÅŸifresiz) -->
        <default>
            <password></password>
            <networks><ip>::/0</ip></networks>
            <profile>default</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </default>
        
        <!-- Clixer user (ÅŸifreli) -->
        <clixer>
            <password>clixer_click_2025</password>
            <networks><ip>::/0</ip></networks>
            <profile>default</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </clixer>
    </users>
</clickhouse>
```

### MÃ¼ÅŸteri Kurulumunda Kontrol

```bash
# ClickHouse kullanÄ±cÄ± testi
docker exec clixer_clickhouse clickhouse-client --user clixer --password clixer_click_2025 --query "SELECT currentUser()"

# Beklenen Ã§Ä±ktÄ±: clixer
```

### Hata Durumunda Kurtarma

```bash
# 1. Container ve volume sil
docker stop clixer_clickhouse
docker rm clixer_clickhouse
docker volume rm docker_clickhouse_data

# 2. Yeniden oluÅŸtur
docker-compose -f docker-compose.db.yml up -d clickhouse

# 3. Test et
docker exec clixer_clickhouse clickhouse-client --user clixer --password clixer_click_2025 --query "SELECT 1"
```

### Etkilenen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `docker/docker-compose.yml` | CLICKHOUSE_USER/PASSWORD kaldÄ±rÄ±ldÄ± |
| `docker/docker-compose.db.yml` | CLICKHOUSE_USER/PASSWORD kaldÄ±rÄ±ldÄ± |
| `docker/clickhouse/users.xml` | KullanÄ±cÄ± tanÄ±mlarÄ± (ZORUNLU) |

---

## ğŸ“… v3.3 - 4 Ocak 2026

**ClickHouse KullanÄ±cÄ± YÃ¶netimi DÃ¼zeltmesi**

1. âœ… `CLICKHOUSE_USER` ve `CLICKHOUSE_PASSWORD` environment deÄŸiÅŸkenleri kaldÄ±rÄ±ldÄ±
2. âœ… KullanÄ±cÄ± yÃ¶netimi `docker/clickhouse/users.xml` ile yapÄ±lÄ±yor
3. âœ… Hem `default` hem `clixer` kullanÄ±cÄ±sÄ± aktif
4. âœ… "Authentication failed" hatasÄ± dÃ¼zeltildi
5. âœ… UI'dan "Yeniden BaÄŸlan" Ã§alÄ±ÅŸÄ±yor

**KÃ¶k Neden:**
Docker'Ä±n CLICKHOUSE_USER environment deÄŸiÅŸkeni `default-user.xml` oluÅŸturup default kullanÄ±cÄ±yÄ± siliyordu.

**Yedekleme:**
- SQL Server Express baÄŸlantÄ± testi baÅŸarÄ±lÄ±
- Ãœniversite demo veritabanÄ± (17.594 kayÄ±t) oluÅŸturuldu

---

## ğŸ”´ SIDEBAR â†” ROL & YETKÄ°LER SENKRONÄ°ZASYONU (KRÄ°TÄ°K!)

### MUTLAK KURAL: Sidebar'a eklenen her menÃ¼ 3 yerde gÃ¼ncellenmeli!

**Prensip:** Sidebar'a yeni bir menÃ¼/sayfa eklendiÄŸinde, bu menÃ¼ otomatik olarak:
1. **Rol & Yetkiler** ekranÄ±nda gÃ¶rÃ¼nmeli (YÃ¶netim Paneli â†’ Rol & Yetkiler)
2. **Etiketler** tablosunda gÃ¶rÃ¼nmeli (Ã§eviri iÃ§in)
3. **Pozisyon bazlÄ± eriÅŸim** kontrol edilebilmeli

### Etkilenen Dosyalar

| Dosya | AmaÃ§ |
|-------|------|
| `frontend/src/components/Layout.tsx` | Sidebar menÃ¼ tanÄ±mlarÄ± |
| `frontend/src/pages/AdminPage.tsx` | Rol & Yetkiler â†’ MenÃ¼ Ä°zinleri listesi |
| `docker/init-scripts/postgres/00-schema-and-seed.sql` | labels tablosu seed |
| `frontend/src/stores/settingsStore.ts` | `canViewMenu()` fonksiyonu |

### Yeni MenÃ¼ Ekleme AkÄ±ÅŸÄ±

```
1. Layout.tsx'e menÃ¼ ekle (sidebar)
      â†“
2. AdminPage.tsx â†’ menuPermissions array'ine ekle
      â†“
3. labels tablosuna TÃ¼rkÃ§e/Ä°ngilizce etiket ekle
      â†“
4. settingsStore.ts â†’ canViewMenu() kontrol et
```

### Ã–rnek: DataGrid Demo Ekleme

```typescript
// 1. Layout.tsx - Sidebar menÃ¼
{ icon: Grid3X3, label: 'DataGrid Demo', path: '/datagrid-demo', key: 'datagrid_demo' }

// 2. AdminPage.tsx - menuPermissions array
{ key: 'datagrid_demo', label: 'DataGrid Demo' }

// 3. labels tablosu (SQL)
INSERT INTO labels (tenant_id, label_type, label_key, label_value) 
VALUES ('...', 'menu', 'datagrid_demo', 'DataGrid Demo');

// 4. settingsStore.ts - EriÅŸim kontrolÃ¼ otomatik Ã§alÄ±ÅŸÄ±r
```

### ASLA YAPMA

1. âŒ Sadece Layout.tsx'e menÃ¼ ekleyip diÄŸerlerini unutma
2. âŒ Rol & Yetkiler'de menÃ¼yÃ¼ hardcode etme
3. âŒ Etiket eklemeden menÃ¼ ekleme

### KONTROL LÄ°STESÄ°

Yeni sayfa/menÃ¼ eklerken:
- [ ] Layout.tsx'e eklendi mi?
- [ ] AdminPage.tsx menuPermissions'a eklendi mi?
- [ ] labels seed'ine eklendi mi?
- [ ] Rol & Yetkiler'de gÃ¶rÃ¼nÃ¼yor mu? (TEST!)
- [ ] Pozisyon bazlÄ± eriÅŸim Ã§alÄ±ÅŸÄ±yor mu? (TEST!)

---

## ğŸ“… v3.4 - 4 Ocak 2026

**Sidebar â†” Rol & Yetkiler Senkronizasyon KuralÄ±**

1. âœ… DataGrid Demo sayfasÄ± eklendi
2. âœ… Sidebar'a menÃ¼ ekleme kuralÄ± dokÃ¼mante edildi
3. âœ… 3 dosya senkronizasyonu zorunlu hale getirildi
4. âš ï¸ DataGrid Demo â†’ Rol & Yetkiler'e eklenmeli (BEKLEMEDE)

---

## ğŸ”´ ENTERPRISE DATAGRID KRÄ°TÄ°K KURALLAR (v3.5 - 5 Ocak 2026)

### 1. "Functions are not valid as a React child" HATASI

**Sorun:** Gruplu ÅŸablonlarda aggregated deÄŸer render edilirken `flexRender` fonksiyon dÃ¶ndÃ¼rÃ¼yor.

**KÃ–K NEDEN:** `@tanstack/react-table` gruplu satÄ±rlarda aggregated cell'leri farklÄ± iÅŸliyor. `flexRender` bazen fonksiyon dÃ¶ndÃ¼rÃ¼r.

**Ã‡Ã–ZÃœM:**
```typescript
// âŒ YANLIÅ - Fonksiyon dÃ¶nebilir!
{flexRender(cell.column.columnDef.aggregatedCell, cell.getContext())}

// âœ… DOÄRU - DeÄŸeri doÄŸrudan al ve formatla
{row.getVisibleCells()
  .filter(cell => cell.getIsAggregated())
  .map(cell => {
    const rawValue = cell.getValue()
    let displayValue: string = '-'

    if (rawValue !== null && rawValue !== undefined && typeof rawValue !== 'function') {
      if (typeof rawValue === 'number') {
        displayValue = new Intl.NumberFormat('tr-TR').format(rawValue)
      } else {
        displayValue = String(rawValue)
      }
    }
    return <span key={cell.id}>{displayValue}</span>
  })
}
```

---

### 2. "[Table] Column with id 'xxx' does not exist" HATASI

**Sorun:** KayÄ±tlÄ± ÅŸablonda farklÄ± dataset'ten kalan kolon ID'leri tablo state'inde kalÄ±yor.

**KÃ–K NEDEN:** `useReactTable`'a geÃ§irilen state'ler (`grouping`, `sorting`, `columnFilters`, `columnVisibility`, `columnOrder`) mevcut kolon tanÄ±mlarÄ±nda olmayan ID'ler iÃ§eriyor.

**Ã‡Ã–ZÃœM:** TÃœM STATE'LERÄ° FÄ°LTRELE!
```typescript
// 1. GeÃ§erli kolon ID'lerini al
const validColumnIds = useMemo(() => columnConfigs.map(c => c.id), [columnConfigs])

// 2. TÃœM state'leri filtrele (sadece grouping DEÄÄ°L!)
const validGrouping = useMemo(() => 
  grouping.filter(id => validColumnIds.includes(id)), [grouping, validColumnIds])

const validSorting = useMemo(() => 
  sorting.filter(s => validColumnIds.includes(s.id)), [sorting, validColumnIds])

const validColumnFilters = useMemo(() => 
  columnFilters.filter(f => validColumnIds.includes(f.id)), [columnFilters, validColumnIds])

const validColumnVisibility = useMemo(() => {
  const valid: Record<string, boolean> = {}
  for (const [key, value] of Object.entries(columnVisibility)) {
    if (validColumnIds.includes(key)) valid[key] = value
  }
  return valid
}, [columnVisibility, validColumnIds])

const validColumnOrder = useMemo(() => 
  columnOrder.filter(id => validColumnIds.includes(id)), [columnOrder, validColumnIds])

// 3. FiltrelenmiÅŸ state'leri kullan
const table = useReactTable({
  state: {
    sorting: validSorting,
    columnFilters: validColumnFilters,
    grouping: validGrouping,
    columnVisibility: validColumnVisibility,
    columnOrder: validColumnOrder,
    // ...
  }
})
```

---

### 3. "Can't perform a React state update on a component that hasn't mounted yet" HATASI

**Sorun:** Async operasyonlar component mount olmadan state gÃ¼ncellemeye Ã§alÄ±ÅŸÄ±yor.

**Ã‡Ã–ZÃœM:**
```typescript
// 1. Mount tracking
const isUnmountedRef = useRef(false)
const isReady = useRef(false)

// 2. requestAnimationFrame ile ready state
useEffect(() => {
  isUnmountedRef.current = false
  const timer = requestAnimationFrame(() => {
    if (!isUnmountedRef.current) isReady.current = true
  })
  return () => {
    cancelAnimationFrame(timer)
    isUnmountedRef.current = true
  }
}, [])

// 3. Async iÅŸlemlerde kontrol
const loadData = async () => {
  if (isUnmountedRef.current) return
  // ...
  if (!isUnmountedRef.current) setState(data)
}
```

---

### 4. Arama Yaparken Toplamlar DeÄŸiÅŸmiyor

**Sorun:** Footer server-side aggregates kullanÄ±yor, filtrelenmiÅŸ veriyi deÄŸil.

**Ã‡Ã–ZÃœM:**
```typescript
const hasActiveFilters = globalFilter || columnFilters.length > 0

if (!hasActiveFilters && serverSideAggregates) {
  // Server-side toplam (TÃœM 10M satÄ±r)
  aggregatedValue = serverSideAggregates[column].sum
} else {
  // Client-side toplam (FÄ°LTRELENMÄ°Å satÄ±rlar)
  const rows = table.getFilteredRowModel().rows
  aggregatedValue = rows.reduce((sum, row) => sum + row.getValue(column), 0)
}
```

---

### 5. Tarih FormatÄ±nda Arama Ã‡alÄ±ÅŸmÄ±yor

**Sorun:** `05.01.2026` formatÄ±nda arama yapÄ±nca sonuÃ§ gelmiyor.

**Ã‡Ã–ZÃœM:** Ã–zel globalFilterFn tanÄ±mla:
```typescript
const globalFilterFn = useCallback((row, columnId, filterValue) => {
  const value = row.getValue(columnId)
  const searchValue = filterValue.toLowerCase().trim()
  
  // Normal string arama
  if (String(value).toLowerCase().includes(searchValue)) return true
  
  // Tarih kolonlarÄ± iÃ§in ek format kontrolleri
  const config = columnConfigs.find(c => c.id === columnId)
  if (config?.type === 'date') {
    const dateValue = new Date(value)
    // TÃ¼rkÃ§e: 05.01.2026
    if (dateValue.toLocaleDateString('tr-TR').includes(searchValue)) return true
    // ISO: 2026-01-05
    if (dateValue.toISOString().split('T')[0].includes(searchValue)) return true
  }
  
  return false
}, [columnConfigs])

// useReactTable'a ekle
const table = useReactTable({
  globalFilterFn,
  // ...
})
```

---

### 6. 401 Unauthorized for grid-designs

**Sorun:** `/api/core/grid-designs` endpoint'i IP whitelist'e takÄ±lÄ±yor.

**Ã‡Ã–ZÃœM:** Gateway'de Ã¶zel route ekle (Ã–NCE tanÄ±mla!):
```typescript
// âœ… DOÄRU SIRA - Spesifik route Ã–NCE
app.use('/api/core/grid-designs', createProxyMiddleware({
  ...proxyOptions(SERVICES.CORE),
  pathRewrite: { '^/api/core': '' }
}))

// Sonra genel route (IP whitelist ile)
app.use('/api/core', adminIPWhitelist, createProxyMiddleware({...}))
```

---

### Ã–ZET: DataGrid TasarÄ±m YÃ¼kleme SÄ±rasÄ±

```
1. Sayfa mount â†’ isReady = true (requestAnimationFrame ile)
2. loadDesigns() â†’ KayÄ±tlÄ± ÅŸablonlarÄ± getir
3. Default ÅŸablon varsa â†’ dataset_id kontrol et
4. dataset_id varsa â†’ Ã–nce veriyi yÃ¼kle (loadDatasetData)
5. Veri gelince â†’ validColumnIds hesapla
6. State'leri filtrele â†’ validGrouping, validSorting, vb.
7. applyDesign() â†’ FiltrelenmiÅŸ state'leri uygula
8. Tablo render â†’ HatasÄ±z!
```

**MUTLAK KURAL:** KayÄ±tlÄ± tasarÄ±mÄ± uygulamadan Ã–NCE veri ve kolonlar yÃ¼klenmiÅŸ olmalÄ±!

---

## ğŸ“… v3.5 - 5 Ocak 2026

**Enterprise DataGrid Kritik Hata Ã‡Ã¶zÃ¼mleri**

1. âœ… "Functions are not valid as a React child" - flexRender yerine getValue() kullan
2. âœ… "Column with id does not exist" - TÃœM state'leri validColumnIds ile filtrele
3. âœ… "Can't perform React state update" - Mount tracking ve requestAnimationFrame
4. âœ… Arama yaparken toplamlar deÄŸiÅŸmiyor - hasActiveFilters kontrolÃ¼
5. âœ… Tarih formatÄ±nda arama Ã§alÄ±ÅŸmÄ±yor - Ã–zel globalFilterFn
6. âœ… 401 Unauthorized - Gateway route sÄ±ralamasÄ±

**Backup:** `backups/v3.5_datagrid_fixes_20260105/`

---

## ğŸ”´ WHITELABEL & NOCODE PRENSÄ°BÄ° (KRÄ°TÄ°K!)

### MUTLAK KURAL: Clixer 100% NoCode ve WhiteLabel bir Ã¼rÃ¼ndÃ¼r!

**Prensip:** MÃ¼ÅŸteriler hiÃ§bir kod yazmadan, hiÃ§bir teknik bilgi gerektirmeden tÃ¼m sistemi kullanabilmeli ve Ã¶zelleÅŸtirebilmeli.

### WhiteLabel Gereksinimleri:

| Ã–ÄŸe | YÃ¶netim Yeri | Ã–zelleÅŸtirilebilir |
|-----|-------------|-------------------|
| Logo | Admin Panel â†’ Sistem AyarlarÄ± | âœ… |
| Uygulama AdÄ± | Admin Panel â†’ Sistem AyarlarÄ± | âœ… |
| MenÃ¼ Ä°simleri | Admin Panel â†’ Etiketler | âœ… |
| Pozisyon Ä°simleri | Admin Panel â†’ Etiketler | âœ… |
| Tema | Sidebar alt kÄ±sÄ±m | âœ… |
| Dil | Sidebar alt kÄ±sÄ±m | âœ… |

### Sidebar MenÃ¼ Ekleme (4 Dosya KuralÄ±):

Yeni bir sayfa/menÃ¼ eklendiÄŸinde ZORUNLU olarak:

1. **`Layout.tsx`** - Sidebar menÃ¼ tanÄ±mÄ±
2. **`AdminPage.tsx`** - `defaultMenuLabels` objesi
3. **`06-labels-seed.sql`** - VeritabanÄ± seed
4. **VeritabanÄ± (Ã§alÄ±ÅŸan)** - `INSERT INTO labels` ile ekleme

### NoCode Kontrol Listesi:

- [ ] TÃ¼m ayarlar UI'dan yÃ¶netilebilir mi?
- [ ] Hardcoded metin var mÄ±? (varsa etiket sistemine taÅŸÄ±)
- [ ] MÃ¼ÅŸteri bu Ã¶zelliÄŸi teknik destek olmadan kullanabilir mi?
- [ ] Yeni Ã¶zellik eklendi mi? Etiketler tablosuna eklendi mi?

### ASLA YAPMA:

1. âŒ MenÃ¼/sayfa adÄ±nÄ± hardcode etme
2. âŒ Sadece kod deÄŸiÅŸikliÄŸi ile isim deÄŸiÅŸtirilebilir hale getirme
3. âŒ Yeni Ã¶zellik ekleyip etiket sistemini atla
4. âŒ MÃ¼ÅŸterinin gÃ¶receÄŸi metni Ä°ngilizce bÄ±rakma

### Ã–RNEK AKIÅ (DoÄŸru):

```
MÃ¼ÅŸteri: "MaÄŸazalar" menÃ¼sÃ¼nÃ¼ "FakÃ¼lteler" yapmak istiyor
  â†“
Admin Panel â†’ Etiketler â†’ stores â†’ "Fakulteler" yaz â†’ Kaydet
  â†“
Sidebar otomatik gÃ¼ncellenir âœ…
```

---

## ğŸ”´ EXCEL EXPORT TASARIM KURALLARI (KRÄ°TÄ°K!)

### MUTLAK KURAL: Excel export, ekrandaki tasarÄ±mÄ±n birebir kopyasÄ± olmalÄ±!

**Prensip:** DataGrid'de gÃ¶rÃ¼nen gruplama, sÄ±ralama, renk ve format Excel'e aynÄ± ÅŸekilde yansÄ±malÄ±.

### Export Gereksinimleri:

| Ã–zellik | DÃ¼z Export | TasarÄ±mlÄ± Export |
|---------|------------|------------------|
| Gruplama | âŒ | âœ… HiyerarÅŸik satÄ±rlar |
| SÄ±ralama | âŒ | âœ… GÃ¶rÃ¼nen sÄ±ra |
| Kolon GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ | âŒ | âœ… Gizli kolonlar export edilmez |
| Kolon SÄ±rasÄ± | âŒ | âœ… SÃ¼rÃ¼klenmiÅŸ sÄ±ra |
| Renk/Format | âŒ | âœ… BaÅŸlÄ±k rengi, zebra Ã§izgi |
| Footer Toplamlar | âŒ | âœ… Sum, Avg, Count |

### Multi-Sheet Export (1M+ SatÄ±r):

Excel satÄ±r limiti: 1.048.576 satÄ±r

```
EÄŸer totalRows > 1.000.000:
  - Sheet 1: SatÄ±r 1-1.000.000
  - Sheet 2: SatÄ±r 1.000.001-2.000.000
  - ... devam
```

### Grup SatÄ±rlarÄ± Excel'de:

```
| A                          | B     | C      |
|----------------------------|-------|--------|
| â–¼ Marmara BÃ¶lgesi (5 kayÄ±t)|       |        |
|   Ä°stanbul KadÄ±kÃ¶y         | 1.234 | 56.789 |
|   Ä°stanbul AtaÅŸehir        | 2.345 | 67.890 |
| â–¼ Ege BÃ¶lgesi (3 kayÄ±t)    |       |        |
|   Ä°zmir Bornova            | 3.456 | 78.901 |
```

### Excel Stil KurallarÄ±:

1. **BaÅŸlÄ±k satÄ±rÄ±**: Koyu arka plan, beyaz yazÄ±, kalÄ±n font
2. **Grup satÄ±rlarÄ±**: AÃ§Ä±k gri arka plan, kalÄ±n font
3. **Alt satÄ±rlar**: Ä°ndent (boÅŸluk ile)
4. **Footer toplamlar**: Koyu Ã§izgi Ã¼stÃ¼nde, kalÄ±n font

---

## ğŸ“… v3.6 - 5 Ocak 2026

**WhiteLabel/NoCode & Excel Export & Enterprise DataGrid Ã–zellikleri**

### Tamamlanan Ã–zellikler:

| # | Ã–zellik | AÃ§Ä±klama |
|---|---------|----------|
| 1 | DataGrid Demo Etiketi | Dinamik etiket sistemine eklendi |
| 2 | Excel Export (TasarÄ±mlÄ±) | Gruplama, sÄ±ralama, format desteÄŸi |
| 3 | Excel Multi-Sheet | 1M+ satÄ±rda otomatik sayfa bÃ¶lme |
| 4 | Column Pinning | Sola/saÄŸa kolon sabitleme |
| 5 | Context Menu | SaÄŸ tÄ±k menÃ¼sÃ¼ (header + cell) |
| 6 | Status Bar | Alt bilgi Ã§ubuÄŸu (satÄ±r sayÄ±larÄ±, durum) |
| 7 | Clipboard | Ctrl+C ile kopyalama, Ctrl+A ile seÃ§im |

### Yeni Dosyalar:
- `docker/init-scripts/postgres/06-labels-seed.sql` - Etiket seed'leri

### DeÄŸiÅŸtirilen Dosyalar:
- `frontend/src/components/EnterpriseDataGrid/index.tsx` - TÃ¼m yeni Ã¶zellikler
- `frontend/src/pages/AdminPage.tsx` - `datagrid` etiketi eklendi

### Bekleyen Ã–zellik:
- â³ Sparklines (HÃ¼cre iÃ§i mini grafikler) - KarmaÅŸÄ±k, sonraya bÄ±rakÄ±ldÄ±

---

## ğŸ”´ ENTERPRISE DATAGRID KULLANIM KILAVUZU

### Column Pinning (Kolon Sabitleme)

```
Sola Sabitle: Kolon baÅŸlÄ±ÄŸÄ± hover â†’ â—€ butonu
SaÄŸa Sabitle: Kolon baÅŸlÄ±ÄŸÄ± hover â†’ â–¶ butonu
KaldÄ±r: Sabitlenen kolonda ğŸ“Œ butonuna tÄ±kla
SaÄŸ tÄ±k: Context menu â†’ Sola/SaÄŸa Sabitle
```

### Context Menu (SaÄŸ TÄ±k)

**Kolon BaÅŸlÄ±ÄŸÄ±nda:**
- A'dan Z'ye / Z'den A'ya SÄ±rala
- Sola/SaÄŸa Sabitle
- Grupla / Grubu KaldÄ±r
- Kolonu Gizle

**HÃ¼crede:**
- Kopyala
- Bu DeÄŸere GÃ¶re Filtrele
- Genel Aramaya Ekle

### Clipboard (Kopyala)

```
Ctrl+C: SeÃ§ili satÄ±rlarÄ± kopyala (TSV formatÄ±nda)
Ctrl+A: TÃ¼m satÄ±rlarÄ± seÃ§
```

### Excel Export

- Gruplama korunur (hiyerarÅŸik satÄ±rlar)
- Kolon sÄ±rasÄ± korunur
- Footer toplamlarÄ± dahil
- 1M+ satÄ±rda otomatik sayfa bÃ¶lme

### Status Bar Bilgileri

| Ä°kon | AnlamÄ± |
|------|--------|
| ğŸ“Š | YÃ¼klenmiÅŸ satÄ±r sayÄ±sÄ± |
| ğŸ“ˆ | Toplam satÄ±r sayÄ±sÄ± (server-side) |
| ğŸ” | FiltrelenmiÅŸ satÄ±r sayÄ±sÄ± |
| âœ“ | SeÃ§ili satÄ±r sayÄ±sÄ± |
| âŠ | Gruplu kolon sayÄ±sÄ± |
| ğŸ“Œ | SabitlenmiÅŸ kolon sayÄ±sÄ± |
| ğŸ‘ | Gizli kolon sayÄ±sÄ± |

---

## ğŸ”´ğŸ”´ğŸ”´ ENTERPRISE DATAGRID KRÄ°TÄ°K HATALAR VE Ã‡Ã–ZÃœMLER (v3.6)

### MUTLAK KURAL: Bu hatalar ve Ã§Ã¶zÃ¼mler belgelenmiÅŸtir. TEKRAR EDÄ°LMEMELÄ°!

Bu bÃ¶lÃ¼m, Enterprise DataGrid geliÅŸtirmesi sÄ±rasÄ±nda karÅŸÄ±laÅŸÄ±lan kritik hatalarÄ± ve **kesin Ã§Ã¶zÃ¼mlerini** iÃ§erir.

---

### HATA 1: "Can't perform a React state update on a component that hasn't mounted yet"

**Belirtiler:**
```
Warning: Can't perform a React state update on a component that hasn't mounted yet.
This indicates that you have a side-effect in your render function that asynchronously 
later calls tries to update the component. Move this work to useEffect instead.
```

**KÃ–K NEDEN:** 
Async operasyonlar (API Ã§aÄŸrÄ±larÄ±, tasarÄ±m yÃ¼kleme) component tam mount olmadan state gÃ¼ncellemeye Ã§alÄ±ÅŸÄ±yor.

**Ã‡Ã–ZÃœM (2 KatmanlÄ±):**

1. **Sayfa seviyesinde (DataGridDemoPage.tsx):** Lazy render ile component'i mount sonrasÄ± gÃ¶ster:
```typescript
const [isPageMounted, setIsPageMounted] = useState(false);

useLayoutEffect(() => {
  const timer = requestAnimationFrame(() => {
    setIsPageMounted(true);
  });
  return () => cancelAnimationFrame(timer);
}, []);

return (
  {isPageMounted ? (
    <EnterpriseDataGrid ... />
  ) : (
    <div>YÃ¼kleniyor...</div>
  )}
);
```

2. **Component seviyesinde (EnterpriseDataGrid/index.tsx):** Mount tracking:
```typescript
const isUnmountedRef = useRef(false);
const isReady = useRef(false);

useEffect(() => {
  isUnmountedRef.current = false;
  const timer = requestAnimationFrame(() => {
    if (!isUnmountedRef.current) isReady.current = true;
  });
  return () => {
    cancelAnimationFrame(timer);
    isUnmountedRef.current = true;
  };
}, []);

// Her async iÅŸlemde kontrol:
const loadData = async () => {
  if (isUnmountedRef.current) return;
  const data = await fetchData();
  if (!isUnmountedRef.current) setState(data);
};
```

---

### HATA 2: "Functions are not valid as a React child"

**Belirtiler:**
```
Warning: Functions are not valid as a React child. This may happen if you return 
a Component instead of <Component /> from render. Or maybe you meant to call this 
function rather than return it.
```

**KÃ–K NEDEN:** 
`@tanstack/react-table` gruplu satÄ±rlarda `flexRender` bazen fonksiyon dÃ¶ndÃ¼rÃ¼r.

**Ã‡Ã–ZÃœM:**
```typescript
// âŒ YANLIÅ - Fonksiyon dÃ¶nebilir!
{flexRender(cell.column.columnDef.aggregatedCell, cell.getContext())}

// âœ… DOÄRU - DeÄŸeri doÄŸrudan al ve formatla
{row.getVisibleCells()
  .filter(cell => cell.getIsAggregated())
  .map(cell => {
    const rawValue = cell.getValue();
    let displayValue: string = '-';

    if (rawValue !== null && rawValue !== undefined && typeof rawValue !== 'function') {
      if (typeof rawValue === 'number') {
        displayValue = new Intl.NumberFormat('tr-TR').format(rawValue);
      } else {
        displayValue = String(rawValue);
      }
    }
    return <span key={cell.id}>{displayValue}</span>;
  })
}
```

---

### HATA 3: "[Table] Column with id 'xxx' does not exist"

**Belirtiler:**
```
[Table] Column with id 'city_name' does not exist.
[Table] Column with id 'occupancy_rate' does not exist.
```

**KÃ–K NEDEN:** 
KayÄ±tlÄ± tasarÄ±mda farklÄ± dataset'ten kalan kolon ID'leri state'lerde kalÄ±yor.

**Ã‡Ã–ZÃœM - TÃœM STATE'LERÄ° FÄ°LTRELE:**
```typescript
// 1. GeÃ§erli kolon ID'lerini al
const validColumnIds = useMemo(() => columnConfigs.map(c => c.id), [columnConfigs]);

// 2. TÃœM state'leri filtrele (SADECE grouping DEÄÄ°L, HEPSÄ°!)
const validGrouping = useMemo(() => 
  grouping.filter(id => validColumnIds.includes(id)), [grouping, validColumnIds]);

const validSorting = useMemo(() => 
  sorting.filter(s => validColumnIds.includes(s.id)), [sorting, validColumnIds]);

const validColumnFilters = useMemo(() => 
  columnFilters.filter(f => validColumnIds.includes(f.id)), [columnFilters, validColumnIds]);

const validColumnVisibility = useMemo(() => {
  const valid: Record<string, boolean> = {};
  for (const [key, value] of Object.entries(columnVisibility)) {
    if (validColumnIds.includes(key)) valid[key] = value;
  }
  return valid;
}, [columnVisibility, validColumnIds]);

const validColumnOrder = useMemo(() => 
  columnOrder.filter(id => validColumnIds.includes(id)), [columnOrder, validColumnIds]);

// 3. FiltrelenmiÅŸ state'leri kullan
const table = useReactTable({
  state: {
    sorting: validSorting,
    columnFilters: validColumnFilters,
    grouping: validGrouping,
    columnVisibility: validColumnVisibility,
    columnOrder: validColumnOrder,
    // ...
  }
});
```

---

### HATA 4: Arama Yaparken Toplamlar DeÄŸiÅŸmiyor

**Belirtiler:**
Footer'daki toplamlar arama/filtre sonucuna gÃ¶re gÃ¼ncellenmiyor.

**KÃ–K NEDEN:** 
Footer sadece server-side aggregates kullanÄ±yor, client-side filtrelemeyi dikkate almÄ±yor.

**Ã‡Ã–ZÃœM:**
```typescript
const hasActiveFilters = globalFilter || columnFilters.length > 0;

// Footer'da:
if (!hasActiveFilters && serverSideAggregates) {
  // Server-side toplam (TÃœM veri)
  aggregatedValue = serverSideAggregates[column].sum;
} else {
  // Client-side toplam (FÄ°LTRELENMÄ°Å satÄ±rlar)
  const rows = table.getFilteredRowModel().rows;
  aggregatedValue = rows.reduce((sum, row) => sum + (row.getValue(column) as number), 0);
}
```

---

### HATA 5: Tarih FormatÄ±nda Arama Ã‡alÄ±ÅŸmÄ±yor

**Belirtiler:**
`05.01.2026` formatÄ±nda arama yapÄ±nca sonuÃ§ gelmiyor.

**KÃ–K NEDEN:** 
VarsayÄ±lan filtre fonksiyonu sadece ISO tarih formatÄ±nÄ± destekliyor.

**Ã‡Ã–ZÃœM - Ã–zel globalFilterFn:**
```typescript
const globalFilterFn = useCallback((row: any, columnId: string, filterValue: string): boolean => {
  const value = row.getValue(columnId);
  const searchValue = filterValue.toLowerCase().trim();
  
  // Normal string arama
  if (String(value).toLowerCase().includes(searchValue)) return true;
  
  // Tarih kolonlarÄ± iÃ§in ek format kontrolleri
  const config = columnConfigs.find(c => c.id === columnId);
  if (config?.type === 'date' || config?.type === 'datetime') {
    try {
      const dateValue = new Date(value as string);
      if (!isNaN(dateValue.getTime())) {
        // TÃ¼rkÃ§e format: 05.01.2026
        if (dateValue.toLocaleDateString('tr-TR').includes(searchValue)) return true;
        // ISO format: 2026-01-05
        if (dateValue.toISOString().split('T')[0].includes(searchValue)) return true;
        // KÄ±sa yÄ±l: 05.01.26
        const shortYear = dateValue.toLocaleDateString('tr-TR').replace(/\d{4}$/, 
          String(dateValue.getFullYear()).slice(-2));
        if (shortYear.includes(searchValue)) return true;
      }
    } catch {}
  }
  
  return false;
}, [columnConfigs]);

// useReactTable'a ekle
const table = useReactTable({
  globalFilterFn,
  // ...
});
```

---

### HATA 6: Export'ta "datasets/undefined/export" HatasÄ±

**Belirtiler:**
```
GET http://localhost:4000/api/data/datasets/undefined/export ... 500 (Internal Server Error)
```

**KÃ–K NEDEN:** 
Demo veri kullanÄ±rken `datasetId` undefined oluyor.

**Ã‡Ã–ZÃœM:**
```typescript
const exportToExcel = useCallback(async (exportLimit: number | 'all') => {
  // datasetId yoksa (demo veri) mevcut grid verisini export et
  if (!datasetId) {
    // Mevcut tablo verisini kullan
    const rows = table.getRowModel().rows;
    // ... export iÅŸlemi
    return;
  }
  
  // datasetId varsa backend'den Ã§ek
  const response = await fetch(`${API_BASE}/data/datasets/${datasetId}/export?...`);
  // ...
}, [datasetId, table]);
```

---

### ğŸ›¡ï¸ Ã–NLEME KURALLARI

1. **Yeni DataGrid geliÅŸtirmelerinde MUTLAKA bu hatalarÄ± kontrol et**
2. **Mount tracking her async operasyonda kullanÄ±lmalÄ±**
3. **KayÄ±tlÄ± tasarÄ±m yÃ¼klenirken TÃœM state'ler validColumnIds ile filtrelenmeli**
4. **Footer hesaplamalarÄ± hasActiveFilters durumuna gÃ¶re ayrÄ±lmalÄ±**
5. **Tarih aramasÄ± iÃ§in globalFilterFn override edilmeli**
6. **Export iÅŸlemlerinde datasetId kontrolÃ¼ zorunlu**

---

## ğŸ“… v3.6 BACKUP BÄ°LGÄ°LERÄ°

- **Tarih:** 5 Ocak 2026
- **Backup:** `backups/v3.6_datagrid_complete_20260105_102912/`
- **Ä°Ã§erik:** Frontend, Services, Shared, Gateway, PostgreSQL dump (347 KB), ClickHouse tablo bilgileri
- **Toplam Boyut:** 460 MB

---

## âœ… v3.6 TAMAMLANAN Ã–ZELLÄ°KLER

| # | Ã–zellik | Durum |
|---|---------|-------|
| 1 | Temel Grid (Virtual scroll, 100K+ satÄ±r) | âœ… |
| 2 | SÄ±ralama & Filtreleme | âœ… |
| 3 | Gruplama (HiyerarÅŸik) | âœ… |
| 4 | Kolon YÃ¶netimi (Gizleme, SÄ±ralama) | âœ… |
| 5 | Footer Toplamlar (Sum, Avg, Count) | âœ… |
| 6 | TasarÄ±m Kaydetme/YÃ¼kleme | âœ… |
| 7 | Excel Export (TasarÄ±mlÄ±, Multi-Sheet) | âœ… |
| 8 | CSV Export | âœ… |
| 9 | Column Pinning | âœ… |
| 10 | Context Menu | âœ… |
| 11 | Status Bar | âœ… |
| 12 | Clipboard (Ctrl+C, Ctrl+A) | âœ… |
| 13 | Dinamik Etiket (WhiteLabel) | âœ… |

---

## ğŸ”œ SONRAKÄ° ADIMLAR

| # | Ã–zellik | Ã–ncelik |
|---|---------|---------|
| 1 | PM2/Start Script | Orta |
| 2 | Sparklines (Mini grafikler) | DÃ¼ÅŸÃ¼k |
| 3 | Production Deploy | YÃ¼ksek |

---

## ğŸš€ MÃœÅTERÄ° KURULUM KONTROL LÄ°STESÄ° (v4.0 - 6 Ocak 2026)

### MUTLAK KURAL: Her mÃ¼ÅŸteri kurulumunda bu adÄ±mlar ZORUNLU!

Bu liste, SSH ile mÃ¼ÅŸteri sunucusuna kurulum yaparken karÅŸÄ±laÅŸÄ±lan hatalar ve Ã§Ã¶zÃ¼mlerinden oluÅŸturulmuÅŸtur.

### ğŸ“‹ KURULUM Ã–NCESÄ° KONTROLLER

| # | Kontrol | Komut |
|---|---------|-------|
| 1 | Docker yÃ¼klÃ¼ mÃ¼? | `docker --version` |
| 2 | Docker Compose yÃ¼klÃ¼ mÃ¼? | `docker-compose --version` |
| 3 | Node.js 20+ yÃ¼klÃ¼ mÃ¼? | `node --version` |
| 4 | Git yÃ¼klÃ¼ mÃ¼? | `git --version` |
| 5 | Yeterli disk alanÄ± var mÄ±? (min 10GB) | `df -h` |

### ğŸ“¦ KURULUM ADIMLARI

```bash
# 1. Kod Ã§ek
cd /opt
sudo git clone https://github.com/absadama/clixer_windows clixer
cd /opt/clixer

# 2. .env oluÅŸtur
sudo cp .env.example .env
sudo nano .env  # Åifreleri dÃ¼zenle

# 3. Docker container'larÄ± baÅŸlat
cd docker
sudo docker-compose up -d

# 4. npm install (her serviste)
cd /opt/clixer/shared && sudo npm install && sudo npm run build
sudo npm install --prefix /opt/clixer/gateway
sudo npm install --prefix /opt/clixer/services/auth-service
sudo npm install --prefix /opt/clixer/services/core-service
sudo npm install --prefix /opt/clixer/services/data-service
sudo npm install --prefix /opt/clixer/services/notification-service
sudo npm install --prefix /opt/clixer/services/analytics-service
sudo npm install --prefix /opt/clixer/services/etl-worker
sudo npm install --prefix /opt/clixer/frontend

# 5. Servisleri baÅŸlat
sudo bash /opt/clixer/scripts/start-all.sh
```

### ğŸ”´ BÄ°LÄ°NEN HATALAR VE Ã‡Ã–ZÃœMLER

#### HATA 1: Docker permission denied
```
permission denied while trying to connect to the docker API at unix:///var/run/docker.sock
```
**Ã‡Ã–ZÃœM:** TÃ¼m Docker komutlarÄ±nÄ±n baÅŸÄ±na `sudo` ekle:
```bash
sudo docker-compose up -d
sudo docker ps
sudo docker exec ...
```

---

#### HATA 2: ClickHouse Authentication Failed
```
ClickHouse: clixer: Authentication failed: password is incorrect, or there is no user with such name.
```
**KÃ–K NEDEN:** Docker Compose'daki `CLICKHOUSE_USER` environment deÄŸiÅŸkeni `default-user.xml` oluÅŸturup default kullanÄ±cÄ±yÄ± siliyor.

**Ã‡Ã–ZÃœM:**
1. `docker/docker-compose.yml`'dan `CLICKHOUSE_USER` ve `CLICKHOUSE_PASSWORD` environment deÄŸiÅŸkenlerini KALDIR
2. `docker/clickhouse/users.xml` dosyasÄ± oluÅŸtur:
```xml
<?xml version="1.0"?>
<clickhouse>
    <users>
        <default>
            <password></password>
            <networks><ip>::/0</ip></networks>
            <profile>default</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </default>
        <clixer>
            <password>clixer_click_2025</password>
            <networks><ip>::/0</ip></networks>
            <profile>default</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </clixer>
    </users>
</clickhouse>
```
3. Docker Compose'da volume mount ekle:
```yaml
volumes:
  - ./clickhouse/users.xml:/etc/clickhouse-server/users.d/users.xml
```
4. Container'Ä± yeniden oluÅŸtur:
```bash
cd /opt/clixer/docker
sudo docker-compose up -d --force-recreate clickhouse
```
5. Test et:
```bash
curl -s "http://localhost:8123/?user=clixer&password=clixer_click_2025" --data "SELECT currentUser()"
# Beklenen Ã§Ä±ktÄ±: clixer
```

---

#### HATA 3: labels tablosu yok (500 Internal Server Error)
```
GET /api/core/labels/menu 500 (Internal Server Error)
```
**Ã‡Ã–ZÃœM:** PostgreSQL'de labels tablosu ve seed verileri oluÅŸtur:
```bash
sudo docker exec -i clixer_postgres psql -U clixer -d clixer << 'EOF'
CREATE TABLE IF NOT EXISTS labels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL,
  label_type VARCHAR(50) NOT NULL,
  label_key VARCHAR(100) NOT NULL,
  label_value VARCHAR(200) NOT NULL,
  description TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE (tenant_id, label_type, label_key)
);

INSERT INTO labels (tenant_id, label_type, label_key, label_value) VALUES
('00000000-0000-0000-0000-000000000001', 'menu', 'dashboard', 'Kokpit'),
('00000000-0000-0000-0000-000000000001', 'menu', 'finance', 'Finans'),
('00000000-0000-0000-0000-000000000001', 'menu', 'operations', 'Operasyon'),
('00000000-0000-0000-0000-000000000001', 'menu', 'analysis', 'Detayli Analiz'),
('00000000-0000-0000-0000-000000000001', 'menu', 'stores', 'Magazalar'),
('00000000-0000-0000-0000-000000000001', 'menu', 'designer', 'Tasarim Studyosu'),
('00000000-0000-0000-0000-000000000001', 'menu', 'data', 'Veri Baglantilari'),
('00000000-0000-0000-0000-000000000001', 'menu', 'admin', 'Yonetim Paneli'),
('00000000-0000-0000-0000-000000000001', 'menu', 'datagrid', 'DataGrid Demo'),
('00000000-0000-0000-0000-000000000001', 'menu', 'metrics', 'Metrikler'),
('00000000-0000-0000-0000-000000000001', 'position', 'GENERAL_MANAGER', 'Genel Mudur'),
('00000000-0000-0000-0000-000000000001', 'position', 'DIRECTOR', 'Direktor'),
('00000000-0000-0000-0000-000000000001', 'position', 'REGIONAL_MANAGER', 'Bolge Muduru'),
('00000000-0000-0000-0000-000000000001', 'position', 'STORE_MANAGER', 'Magaza Muduru'),
('00000000-0000-0000-0000-000000000001', 'position', 'ANALYST', 'Analist'),
('00000000-0000-0000-0000-000000000001', 'position', 'VIEWER', 'Izleyici')
ON CONFLICT (tenant_id, label_type, label_key) DO NOTHING;
EOF
```

---

#### HATA 4: grid_designs tablosu yok veya eksik kolonlar
```
column gd.dataset_id does not exist
Failed to load designs: SyntaxError: Unexpected token '<'
```
**Ã‡Ã–ZÃœM:** PostgreSQL'de grid_designs tablosu ve eksik kolonlarÄ± oluÅŸtur:
```bash
sudo docker exec -i clixer_postgres psql -U clixer -d clixer << 'EOF'
CREATE TABLE IF NOT EXISTS grid_designs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  tenant_id UUID NOT NULL,
  grid_key VARCHAR(100) NOT NULL,
  name VARCHAR(200) NOT NULL,
  config JSONB NOT NULL DEFAULT '{}',
  is_default BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  dataset_id UUID,
  grid_id VARCHAR(100),
  state JSONB DEFAULT '{}',
  UNIQUE (user_id, grid_key, name)
);

-- Eksik kolonlarÄ± ekle (tablo zaten varsa)
ALTER TABLE grid_designs ADD COLUMN IF NOT EXISTS dataset_id UUID;
ALTER TABLE grid_designs ADD COLUMN IF NOT EXISTS grid_id VARCHAR(100);
ALTER TABLE grid_designs ADD COLUMN IF NOT EXISTS state JSONB DEFAULT '{}';

CREATE INDEX IF NOT EXISTS idx_grid_designs_user ON grid_designs(user_id);
CREATE INDEX IF NOT EXISTS idx_grid_designs_grid_key ON grid_designs(grid_key);
EOF
```

---

#### HATA 5: Cannot find module 'multer'
```
Error: Cannot find module 'multer'
```
**Ã‡Ã–ZÃœM:** data-service'e multer paketini kur:
```bash
cd /opt/clixer/services/data-service
sudo npm install multer @types/multer
```

---

#### HATA 6: Cannot find module 'socket.io'
```
Error: Cannot find module 'socket.io'
```
**Ã‡Ã–ZÃœM:** notification-service'e socket.io paketini kur:
```bash
cd /opt/clixer/services/notification-service
sudo npm install socket.io
```

---

#### HATA 7: EADDRINUSE - Port zaten kullanÄ±mda
```
Error: listen EADDRINUSE: address already in use :::4002
```
**KÃ–K NEDEN:** Birden fazla Node.js process aynÄ± portu kullanmaya Ã§alÄ±ÅŸÄ±yor.

**Ã‡Ã–ZÃœM:**
```bash
# TÃ¼m Node.js process'lerini Ã¶ldÃ¼r
sudo pkill -9 -f "node"

# Temiz baÅŸlat
sudo bash /opt/clixer/scripts/stop-all.sh
sleep 3
sudo bash /opt/clixer/scripts/start-all.sh
```

---

#### HATA 8: Permission denied for log files
```
EACCES: permission denied, open '/opt/clixer/logs/xxx.log'
```
**Ã‡Ã–ZÃœM:**
```bash
sudo chmod 777 /opt/clixer/logs/
```

---

#### HATA 9: column reference "status" is ambiguous
```
column reference "status" is ambiguous
```
**KÃ–K NEDEN:** SQL sorgusunda birden fazla tabloda aynÄ± kolon adÄ± var.

**Ã‡Ã–ZÃœM:** Bu bir kod hatasÄ±dÄ±r. `data-service/src/index.ts` dosyasÄ±nda `/performance/etl` endpoint'indeki sorgu dÃ¼zeltilmeli. Kolon adÄ±nÄ±n Ã¶nÃ¼ne tablo alias'Ä± eklenmeli (Ã¶rn: `ej.status`).

---

### âœ… KURULUM SONRASI KONTROLLER

```bash
# 1. TÃ¼m container'lar Ã§alÄ±ÅŸÄ±yor mu?
sudo docker ps

# 2. PostgreSQL baÄŸlantÄ±sÄ±
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "SELECT 1"

# 3. ClickHouse baÄŸlantÄ±sÄ±
curl -s "http://localhost:8123/?user=clixer&password=clixer_click_2025" --data "SELECT 1"

# 4. Redis baÄŸlantÄ±sÄ±
sudo docker exec clixer_redis redis-cli ping

# 5. API Gateway (token al ve test et)
TOKEN=$(curl -s -X POST http://localhost:4000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@clixer","password":"Admin1234!"}' \
  | grep -o '"accessToken":"[^"]*"' | cut -d'"' -f4)

# Labels API
curl -s http://localhost:4000/api/core/labels/menu -H "Authorization: Bearer $TOKEN"

# ClickHouse API
curl -s http://localhost:4000/api/data/clickhouse/tables -H "Authorization: Bearer $TOKEN"

# Grid Designs API
curl -s http://localhost:4000/api/core/grid-designs/demo-grid -H "Authorization: Bearer $TOKEN"
```

### ğŸ“ TEMÄ°Z KURULUM Ä°Ã‡Ä°N INIT SCRIPTS

Docker PostgreSQL container'Ä± ilk baÅŸlatÄ±ldÄ±ÄŸÄ±nda `docker/init-scripts/postgres/` klasÃ¶rÃ¼ndeki SQL dosyalarÄ± sÄ±rayla Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r:

| Dosya | Ä°Ã§erik |
|-------|--------|
| `00-schema-and-seed.sql` | TÃ¼m tablolar + temel seed (SADECE admin kullanÄ±cÄ±) |
| `07-labels.sql` | Labels tablosu + varsayÄ±lan etiketler |
| `08-grid-designs.sql` | Grid Designs tablosu |

**KRÄ°TÄ°K:** `00-schema-and-seed.sql` ASLA pg_dump Ã§Ä±ktÄ±sÄ± olarak bÄ±rakÄ±lmamalÄ±! Test verileri (connections, datasets, metrics, designs) DAHÄ°L EDÄ°LMEMELÄ°!

### ğŸ“¦ package.json ZORUNLU BAÄIMLILIKLAR

| Servis | Paket | Komut |
|--------|-------|-------|
| data-service | multer, @types/multer | `npm install multer @types/multer` |
| notification-service | socket.io | `npm install socket.io` |

### ğŸ”‘ GÄ°RÄ°Å BÄ°LGÄ°LERÄ°

| Alan | DeÄŸer |
|------|-------|
| URL | `http://SUNUCU_IP:3000` |
| Email | `admin@clixer` |
| Åifre | `Admin1234!` |

---

## ğŸ“… v4.0 - 6 Ocak 2026

**MÃ¼ÅŸteri Kurulum DÃ¼zeltmeleri & DokÃ¼mantasyon**

### YapÄ±lan DeÄŸiÅŸiklikler

1. âœ… `data-service/package.json` - multer ve @types/multer eklendi
2. âœ… `notification-service/package.json` - socket.io eklendi
3. âœ… `docker/init-scripts/postgres/07-labels.sql` - Labels tablosu oluÅŸturma scripti
4. âœ… `docker/init-scripts/postgres/08-grid-designs.sql` - Grid Designs tablosu oluÅŸturma scripti
5. âœ… `docker/init-scripts/postgres/00-schema-and-seed.sql` - TEMÄ°Z ÅŸema (pg_dump DEÄÄ°L, test verisi YOK)
6. âœ… `.cursorrules` - MÃ¼ÅŸteri Kurulum Kontrol Listesi eklendi

### Init Scripts KuralÄ±

| Dosya | Ä°Ã§erik | Test Verisi |
|-------|--------|-------------|
| `00-schema-and-seed.sql` | Tablo ÅŸemalarÄ± + admin kullanÄ±cÄ± | âŒ YOK |
| `07-labels.sql` | Labels tablosu + varsayÄ±lan etiketler | âŒ YOK |
| `08-grid-designs.sql` | Grid Designs tablosu | âŒ YOK |

**KRÄ°TÄ°K:** Yeni mÃ¼ÅŸteri kurulumunda tablolar BOÅ olmalÄ± (admin kullanÄ±cÄ± hariÃ§). Test verileri (baÄŸlantÄ±lar, datasetler, metrikler, tasarÄ±mlar) ASLA init script'lere dahil edilmemeli!

### Yedekleme

- **Backup:** `backups/v4.0_customer_install_fixes_YYYYMMDD/`
- **GitHub Tag:** `v4.0`

---

## ğŸ”´ğŸ”´ğŸ”´ MÃœÅTERÄ° KURULUM KONTROL LÄ°STESÄ° (Ubuntu SSH ile)

### Ã–N GEREKSÄ°NÄ°MLER

| Gereksinim | Kontrol Komutu | Beklenen |
|------------|----------------|----------|
| Docker | `docker --version` | 20.10+ |
| Docker Compose | `docker-compose --version` | 2.0+ |
| Node.js | `node --version` | 18+ veya 20+ |
| npm | `npm --version` | 9+ |
| Git | `git --version` | 2.30+ |

### KURULUM ADIMLARI

```bash
# 1. Sunucuya baÄŸlan
ssh root@SUNUCU_IP

# 2. Kodu Ã§ek
cd /opt
git clone https://github.com/absadama/clixer_windows.git clixer
cd /opt/clixer

# 3. .env oluÅŸtur
cp env.example .env
# .env dosyasÄ±nÄ± dÃ¼zenle (ÅŸifreler, domain vb.)

# 4. Docker container'larÄ± baÅŸlat
cd /opt/clixer/docker
sudo docker-compose up -d

# 5. PostgreSQL veritabanÄ±nÄ± yÃ¼kle (varsa backup)
# Ä°lk kurulumda init-scripts otomatik Ã§alÄ±ÅŸÄ±r

# 6. npm install (tÃ¼m servisler)
cd /opt/clixer/shared && npm install && npm run build
cd /opt/clixer/gateway && npm install
cd /opt/clixer/services/auth-service && npm install
cd /opt/clixer/services/core-service && npm install
cd /opt/clixer/services/data-service && npm install
cd /opt/clixer/services/notification-service && npm install
cd /opt/clixer/services/analytics-service && npm install
cd /opt/clixer/services/etl-worker && npm install

# 7. Script izinleri
sudo chmod +x /opt/clixer/scripts/*.sh

# 8. Servisleri baÅŸlat
cd /opt/clixer
sudo bash scripts/start-all.sh

# 9. Frontend build (production iÃ§in)
cd /opt/clixer/frontend && npm install && npm run build
```

### KURULUM SONRASI KONTROLLER

```bash
# Docker container'lar
sudo docker ps

# Servis portlarÄ±
ss -tlnp | grep -E "3000|4000|4001|4002|4003|4004|4005"

# API testi
TOKEN=$(curl -s -X POST http://localhost:4000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@clixer","password":"Admin1234!"}' | \
  grep -o '"accessToken":"[^"]*"' | cut -d'"' -f4)

curl -s http://localhost:4000/api/core/labels/menu -H "Authorization: Bearer $TOKEN"
curl -s http://localhost:4000/api/data/clickhouse/tables -H "Authorization: Bearer $TOKEN"
```

---

## ğŸ”´ MÃœÅTERÄ° KURULUM HATALARI VE Ã‡Ã–ZÃœMLERÄ°

### HATA 1: Docker Permission Denied

**Belirti:**
```
permission denied while trying to connect to the docker API at unix:///var/run/docker.sock
```

**Ã‡Ã¶zÃ¼m:**
```bash
# TÃ¼m docker komutlarÄ±nÄ±n baÅŸÄ±na sudo ekle
sudo docker ps
sudo docker-compose up -d
```

---

### HATA 2: ClickHouse Authentication Failed

**Belirti:**
```
ClickHouse: clixer: Authentication failed: password is incorrect, or there is no user with such name.
```

**KÃ¶k Neden:** Docker'Ä±n `CLICKHOUSE_USER` environment deÄŸiÅŸkeni `default-user.xml` oluÅŸturup default kullanÄ±cÄ±yÄ± siliyor.

**Ã‡Ã¶zÃ¼m:**
```bash
# 1. KlasÃ¶r oluÅŸtur
sudo mkdir -p /opt/clixer/docker/clickhouse

# 2. users.xml yaz
sudo tee /opt/clixer/docker/clickhouse/users.xml << 'EOF'
<?xml version="1.0"?>
<clickhouse>
    <users>
        <default>
            <password></password>
            <networks><ip>::/0</ip></networks>
            <profile>default</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </default>
        <clixer>
            <password>clixer_click_2025</password>
            <networks><ip>::/0</ip></networks>
            <profile>default</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </clixer>
    </users>
</clickhouse>
EOF

# 3. docker-compose.yml'de volume mount'u kontrol et:
# volumes:
#   - ./clickhouse/users.xml:/etc/clickhouse-server/users.d/users.xml

# 4. ClickHouse'u yeniden baÅŸlat
cd /opt/clixer/docker
sudo docker-compose up -d --force-recreate clickhouse

# 5. Test et
curl -s "http://localhost:8123/?user=clixer&password=clixer_click_2025" --data "SELECT currentUser()"
# Beklenen Ã§Ä±ktÄ±: clixer
```

---

### HATA 3: Labels Tablosu Yok (500 Internal Server Error)

**Belirti:**
```
GET /api/core/labels/menu 500 (Internal Server Error)
```

**Ã‡Ã¶zÃ¼m:**
```bash
# 07-labels.sql otomatik Ã§alÄ±ÅŸmalÄ±. Ã‡alÄ±ÅŸmadÄ±ysa manuel oluÅŸtur:
sudo docker exec -i clixer_postgres psql -U clixer -d clixer << 'EOF'
CREATE TABLE IF NOT EXISTS labels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL,
  label_type VARCHAR(50) NOT NULL,
  label_key VARCHAR(100) NOT NULL,
  label_value VARCHAR(200) NOT NULL,
  description TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE (tenant_id, label_type, label_key)
);

INSERT INTO labels (tenant_id, label_type, label_key, label_value) VALUES
('00000000-0000-0000-0000-000000000001', 'menu', 'dashboard', 'Kokpit'),
('00000000-0000-0000-0000-000000000001', 'menu', 'finance', 'Finans'),
('00000000-0000-0000-0000-000000000001', 'menu', 'operations', 'Operasyon'),
('00000000-0000-0000-0000-000000000001', 'menu', 'analysis', 'Detayli Analiz'),
('00000000-0000-0000-0000-000000000001', 'menu', 'stores', 'Magazalar'),
('00000000-0000-0000-0000-000000000001', 'menu', 'designer', 'Tasarim Studyosu'),
('00000000-0000-0000-0000-000000000001', 'menu', 'data', 'Veri Baglantilari'),
('00000000-0000-0000-0000-000000000001', 'menu', 'admin', 'Yonetim Paneli'),
('00000000-0000-0000-0000-000000000001', 'menu', 'datagrid', 'DataGrid Demo'),
('00000000-0000-0000-0000-000000000001', 'position', 'GENERAL_MANAGER', 'Genel Mudur'),
('00000000-0000-0000-0000-000000000001', 'position', 'DIRECTOR', 'Direktor'),
('00000000-0000-0000-0000-000000000001', 'position', 'REGIONAL_MANAGER', 'Bolge Muduru'),
('00000000-0000-0000-0000-000000000001', 'position', 'STORE_MANAGER', 'Magaza Muduru'),
('00000000-0000-0000-0000-000000000001', 'position', 'ANALYST', 'Analist'),
('00000000-0000-0000-0000-000000000001', 'position', 'VIEWER', 'Izleyici')
ON CONFLICT (tenant_id, label_type, label_key) DO NOTHING;
EOF
```

---

### HATA 4: Grid Designs Eksik Kolonlar

**Belirti:**
```
column gd.dataset_id does not exist
column gd.grid_id does not exist
column gd.state does not exist
```

**Ã‡Ã¶zÃ¼m:**
```bash
sudo docker exec -i clixer_postgres psql -U clixer -d clixer << 'EOF'
CREATE TABLE IF NOT EXISTS grid_designs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  tenant_id UUID NOT NULL,
  grid_key VARCHAR(100) NOT NULL,
  name VARCHAR(200) NOT NULL,
  config JSONB NOT NULL DEFAULT '{}',
  is_default BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE (user_id, grid_key, name)
);

CREATE INDEX IF NOT EXISTS idx_grid_designs_user ON grid_designs(user_id);
CREATE INDEX IF NOT EXISTS idx_grid_designs_grid_key ON grid_designs(grid_key);

ALTER TABLE grid_designs ADD COLUMN IF NOT EXISTS dataset_id UUID;
ALTER TABLE grid_designs ADD COLUMN IF NOT EXISTS grid_id VARCHAR(100);
ALTER TABLE grid_designs ADD COLUMN IF NOT EXISTS state JSONB DEFAULT '{}';
EOF
```

---

### HATA 5: Cannot find module 'multer' (Data Service)

**Belirti:**
```
Error: Cannot find module 'multer'
```

**Ã‡Ã¶zÃ¼m:**
```bash
cd /opt/clixer/services/data-service
sudo npm install multer @types/multer
```

---

### HATA 6: Cannot find module 'socket.io' (Notification Service)

**Belirti:**
```
Error: Cannot find module 'socket.io'
```

**Ã‡Ã¶zÃ¼m:**
```bash
cd /opt/clixer/services/notification-service
sudo npm install socket.io
```

---

### HATA 7: EADDRINUSE - Port Zaten KullanÄ±mda

**Belirti:**
```
Error: listen EADDRINUSE: address already in use :::4002
```

**Ã‡Ã¶zÃ¼m:**
```bash
# TÃ¼m Node.js process'lerini Ã¶ldÃ¼r
sudo pkill -9 -f "node"

# Temiz baÅŸlat
cd /opt/clixer
sudo bash scripts/stop-all.sh
sleep 3
sudo bash scripts/start-all.sh
```

---

### HATA 8: Log DosyasÄ±na Permission Denied

**Belirti:**
```
Permission denied: /opt/clixer/logs/xxx.log
```

**Ã‡Ã¶zÃ¼m:**
```bash
sudo chmod 777 /opt/clixer/logs/
```

---

### HATA 9: column reference "status" is ambiguous

**Belirti:**
```
column reference "status" is ambiguous (etl performans endpoint'i)
```

**Ã‡Ã¶zÃ¼m:** Bu kod hatasÄ±. `data-service/src/index.ts` dosyasÄ±ndaki SQL sorgusunda tablo alias'Ä± eksik. Windows'ta dÃ¼zeltilmeli.

---

### HATA 10: LDAP Sunucu Adresi localhost Olarak Kaydediliyor

**Belirti:**
```
LDAP server URL: ldap://localhost:389
error: connect ECONNREFUSED 127.0.0.1:389
LDAP bind failed
HatalÄ± ÅŸifre (LDAP kullanÄ±cÄ±sÄ± iÃ§in)
```

**KÃ¶k Neden:** 
Admin Panel'den LDAP ayarlarÄ± kaydedilirken `ldap_server_url` deÄŸeri veritabanÄ±na `localhost` olarak yazÄ±lÄ±yor. Bu durum ÅŸu senaryolarda oluÅŸabilir:
1. UI'dan gÃ¶nderilen deÄŸer yanlÄ±ÅŸ parse ediliyor
2. VarsayÄ±lan deÄŸer override edilemiyor
3. JSON formatÄ± hatalÄ± kaydediliyor

**Ã‡Ã¶zÃ¼m:**
```bash
# VeritabanÄ±nda LDAP sunucu adresini dÃ¼zelt
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "UPDATE system_settings SET value = '\"ldap://20.10.10.2:389\"' WHERE key = 'ldap_server_url';"

# DeÄŸeri kontrol et
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "SELECT key, value FROM system_settings WHERE key LIKE 'ldap%';"
```

**âš ï¸ DÄ°KKAT:** Value JSON formatÄ±nda olmalÄ±, yani Ã§ift tÄ±rnak iÃ§inde: `'"ldap://IP:PORT"'`

**Ã–nleme:**
- LDAP ayarlarÄ±nÄ± UI'dan kaydettikten sonra veritabanÄ±nÄ± kontrol et
- Hostname yerine her zaman IP adresi kullan (DNS Ã§Ã¶zÃ¼mlemesi sorun Ã§Ä±karabilir)
- `getaddrinfo EAI_AGAIN` hatasÄ± alÄ±nÄ±yorsa DNS sorunu var, IP kullan

---

### HATA 11: getaddrinfo EAI_AGAIN (DNS Ã‡Ã¶zÃ¼mlemesi BaÅŸarÄ±sÄ±z)

**Belirti:**
```
Sync hatasÄ±: LDAP senkronizasyonu baÅŸarÄ±sÄ±z: getaddrinfo EAI_AGAIN TD-DC01.tavukdunyasi.local
```

**KÃ¶k Neden:**
Clixer sunucusu mÃ¼ÅŸterinin internal DNS'ini Ã§Ã¶zemiyoru. `TD-DC01.tavukdunyasi.local` gibi internal hostname'ler Ã§Ã¶zÃ¼mlenemiyor.

**Ã‡Ã¶zÃ¼m:**
LDAP sunucu alanÄ±na hostname yerine IP adresi kullan:
- **YanlÄ±ÅŸ:** `ldap://TD-DC01.tavukdunyasi.local:389`
- **DoÄŸru:** `ldap://20.10.10.2:389`

**IP Adresini Bulma (MÃ¼ÅŸteri sunucusundan):**
```bash
getent hosts TD-DC01.tavukdunyasi.local
# veya
nslookup TD-DC01.tavukdunyasi.local
```

---

## ğŸ” LDAP ENTEGRASYONU KONTROL LÄ°STESÄ°

### Kurulum Ã–ncesi Testler (SSH ile mÃ¼ÅŸteri sunucusundan):

```bash
# 1. LDAP portlarÄ± aÃ§Ä±k mÄ±?
nc -zv LDAP_IP 389
nc -zv LDAP_IP 636

# 2. LDAP baÄŸlantÄ±sÄ± Ã§alÄ±ÅŸÄ±yor mu?
ldapsearch -x -H ldap://LDAP_IP:389 -D "BIND_USER@domain.local" -w 'BIND_SIFRE' -b "DC=domain,DC=local" "(sAMAccountName=BIND_USER)" cn

# 3. KullanÄ±cÄ± aramasÄ± Ã§alÄ±ÅŸÄ±yor mu?
ldapsearch -x -H ldap://LDAP_IP:389 -D "BIND_USER@domain.local" -w 'BIND_SIFRE' -b "DC=domain,DC=local" "(sAMAccountName=TEST_KULLANICI)" cn mail displayName

# 4. KullanÄ±cÄ± kimlik doÄŸrulamasÄ± Ã§alÄ±ÅŸÄ±yor mu?
ldapwhoami -x -H ldap://LDAP_IP:389 -D "kullanici@domain.local" -w 'KULLANICI_SIFRESI'
```

### Clixer'da LDAP AyarlarÄ±:

| Alan | DeÄŸer | Ã–rnek |
|------|-------|-------|
| LDAP Sunucu | `ldap://IP:389` veya `ldaps://IP:636` | `ldap://20.10.10.2:389` |
| Base DN | `DC=domain,DC=local` | `DC=tavukdunyasi,DC=local` |
| Bind DN | `user@domain.local` | `manageengine@tavukdunyasi.local` |
| Bind Åifre | Bind kullanÄ±cÄ±sÄ±nÄ±n ÅŸifresi | `***` |
| KullanÄ±cÄ± Arama Filtresi | `(sAMAccountName={{username}})` | Tek kullanÄ±cÄ± aramak iÃ§in |
| Senkronizasyon Filtresi | `(&(objectClass=user)(objectCategory=person))` | TÃ¼m kullanÄ±cÄ±larÄ± Ã§ekmek iÃ§in |

### Kurulum SonrasÄ± Kontrol:

```bash
# VeritabanÄ±nda LDAP ayarlarÄ±nÄ± kontrol et
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "SELECT key, value FROM system_settings WHERE key LIKE 'ldap%';"

# ldap_server_url deÄŸeri IP ile mi kayÄ±tlÄ±?
# EÄŸer localhost veya hostname ise dÃ¼zelt!

# Senkronize edilen kullanÄ±cÄ±larÄ± kontrol et
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "SELECT email, ldap_dn FROM users WHERE ldap_dn IS NOT NULL LIMIT 5;"
```

### GiriÅŸ Testi:

```bash
# Auth loglarÄ±nÄ± canlÄ± izle
tail -f /opt/clixer/logs/auth*.log

# BaÅŸka terminalde login dene
# Logda ÅŸunlarÄ± gÃ¶rmelisin:
# - "Attempting LDAP authentication"
# - "LDAP server URL": "ldap://IP:389" (localhost DEÄÄ°L!)
# - "LDAP authentication successful"
# - "User logged in"
```

### Sorun Giderme:

| Hata | Sebep | Ã‡Ã¶zÃ¼m |
|------|-------|-------|
| `ECONNREFUSED 127.0.0.1:389` | LDAP sunucu adresi localhost | IP adresi ile gÃ¼ncelle |
| `getaddrinfo EAI_AGAIN` | DNS Ã§Ã¶zÃ¼mlenemiyor | Hostname yerine IP kullan |
| `Invalid credentials (49)` | YanlÄ±ÅŸ ÅŸifre veya kullanÄ±cÄ± formatÄ± | `user@domain.local` formatÄ±nÄ± dene |
| `LDAP bind failed` | Bind kullanÄ±cÄ±sÄ± yetkisiz | DoÄŸru bind kullanÄ±cÄ±sÄ± ve ÅŸifre |
| `0 kullanÄ±cÄ± bulundu` | Arama filtresi yanlÄ±ÅŸ | `(&(objectClass=user)(objectCategory=person))` |

---

### HATA 12: Docker Compose TÃ¼m Servisleri Build Etmeye Ã‡alÄ±ÅŸÄ±yor

**Belirti:**
```
ERROR [data-service 3/8] COPY shared /app/shared
ERROR [auth-service 7/8] COPY services/auth-service .
```

**KÃ¶k Neden:**
`docker-compose up -d` komutu TÃœM servisleri (backend dahil) Docker container olarak build etmeye Ã§alÄ±ÅŸÄ±yor. Ama mÃ¼ÅŸteri sunucusunda servisler Docker'da DEÄÄ°L, direkt Node.js olarak Ã§alÄ±ÅŸÄ±yor.

**Ã‡Ã¶zÃ¼m:**
```bash
# SADECE veritabanlarÄ±nÄ± baÅŸlat (backend servisleri DEÄÄ°L!)
cd /opt/clixer/docker
sudo docker-compose up -d postgres redis clickhouse

# Sonra Node.js servislerini baÅŸlat
sudo bash /opt/clixer/scripts/start-all.sh
```

**DoÄŸru Mimari:**
| BileÅŸen | Nerede Ã‡alÄ±ÅŸÄ±r | BaÅŸlatma |
|---------|----------------|----------|
| PostgreSQL | Docker container | `docker-compose up -d postgres` |
| Redis | Docker container | `docker-compose up -d redis` |
| ClickHouse | Docker container | `docker-compose up -d clickhouse` |
| Auth Service | Node.js process | `scripts/start-all.sh` |
| Core Service | Node.js process | `scripts/start-all.sh` |
| Data Service | Node.js process | `scripts/start-all.sh` |
| Analytics Service | Node.js process | `scripts/start-all.sh` |
| Notification Service | Node.js process | `scripts/start-all.sh` |
| ETL Worker | Node.js process | `scripts/start-all.sh` |
| Gateway | Node.js process | `scripts/start-all.sh` |
| Frontend | Vite dev server | `scripts/start-all.sh` |

---

### HATA 13: VarsayÄ±lan Tema Clixer DeÄŸil

**Belirti:**
KullanÄ±cÄ±lar giriÅŸ yaptÄ±ÄŸÄ±nda beyaz (light/corporate) tema gÃ¶rÃ¼yorlar, Clixer (koyu) tema deÄŸil.

**KÃ¶k Neden:**
VeritabanÄ±ndaki `default_theme` deÄŸeri `corporate` veya `light` olarak kayÄ±tlÄ±.

**Ã‡Ã¶zÃ¼m:**
```bash
# Mevcut deÄŸeri kontrol et
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "SELECT value FROM system_settings WHERE key = 'default_theme';"

# Clixer temasÄ±na gÃ¼ncelle
sudo docker exec clixer_postgres psql -U clixer -d clixer -c "UPDATE system_settings SET value = '{\"type\": \"select\", \"label\": \"VarsayÄ±lan Tema\", \"value\": \"clixer\", \"description\": \"Yeni kullanÄ±cÄ±lar iÃ§in varsayÄ±lan tema\"}' WHERE key = 'default_theme';"
```

**KullanÄ±cÄ± TarafÄ±nda:**
EÄŸer kullanÄ±cÄ± hala eski temayÄ± gÃ¶rÃ¼yorsa:
- Ctrl + Shift + R (hard refresh)
- Veya gizli pencere ile aÃ§
- Veya F12 â†’ Application â†’ Local Storage â†’ Temizle

---

## ğŸ”§ KURULUM KOMUT Ã–ZETÄ°

```bash
# TEK KOMUTLA KURULUM (Ubuntu)
curl -fsSL https://raw.githubusercontent.com/absadama/clixer_windows/main/deploy/install-ubuntu.sh | sudo bash

# MANUEL KURULUM - DOÄRU SIRA!
# 1. Sadece veritabanlarÄ±nÄ± baÅŸlat
cd /opt/clixer/docker
sudo docker-compose up -d postgres redis clickhouse

# 2. Servisleri baÅŸlat
sudo bash /opt/clixer/scripts/start-all.sh

# GÄ°RÄ°Å BÄ°LGÄ°LERÄ°
# Email: admin@clixer
# Åifre: Admin1234!
```

---

## ğŸ”´ MÃœÅTERÄ° ORTAMI SERVÄ°S YÃ–NETÄ°MÄ°

### Servisler DurduÄŸunda / BaÄŸlantÄ± KoptuÄŸunda:

```bash
# 1. Docker container'larÄ± kontrol et
sudo docker ps

# Container'lar durmuÅŸsa:
cd /opt/clixer/docker
sudo docker-compose up -d postgres redis clickhouse

# 2. Node.js servislerini baÅŸlat
sudo bash /opt/clixer/scripts/start-all.sh
```

### Tek Servis Yeniden BaÅŸlatma:

```bash
# Auth service
sudo pkill -f "auth-service"
cd /opt/clixer/services/auth-service
sudo nohup npm run dev > /opt/clixer/logs/auth-out.log 2>&1 &

# Veya tÃ¼m servisleri yeniden baÅŸlat
sudo bash /opt/clixer/scripts/stop-all.sh
sudo bash /opt/clixer/scripts/start-all.sh
```

### Log Ä°zleme:

```bash
# TÃ¼m auth loglarÄ±
tail -f /opt/clixer/logs/auth*.log

# Gateway loglarÄ±
tail -f /opt/clixer/logs/gateway-out.log

# TÃ¼m loglar
tail -f /opt/clixer/logs/*.log
```

### SaÄŸlÄ±k KontrolÃ¼:

```bash
# API Gateway
curl http://localhost:4000/health

# Auth Service
curl http://localhost:4001/health

# PostgreSQL
sudo docker exec clixer_postgres pg_isready

# ClickHouse
curl "http://localhost:8123/?user=clixer&password=clixer_click_2025" --data "SELECT 1"

# Redis
sudo docker exec clixer_redis redis-cli ping
```

---

## ğŸ”´ğŸ”´ğŸ”´ HTTPS/SSL PRODUCTION KURULUMU - KRÄ°TÄ°K! (v4.1 - 7 Ocak 2026)

### MUTLAK KURAL: HTTPS OrtamÄ±nda `.env.production` ZORUNLU DÃ¼zeltme!

**Sorun:** Vite production build sÄ±rasÄ±nda `.env.production` dosyasÄ±ndaki `VITE_API_URL` deÄŸerini hardcode ediyor. EÄŸer bu dosyada `http://IP:4000/api` gibi bir deÄŸer varsa, HTTPS sayfasÄ±nda "Mixed Content" hatasÄ± alÄ±nÄ±r ve uygulama Ã‡ALIÅMAZ!

**Belirti:**
```
Mixed Content: The page at 'https://...' was loaded over HTTPS, but requested an insecure XMLHttpRequest endpoint 'http://...:4000/api/auth/login'. This request has been blocked.
```

### âœ… Ã‡Ã–ZÃœM - Production Build Ã–ncesi ZORUNLU AdÄ±mlar

**1. `.env.production` DosyasÄ±nÄ± DÃ¼zelt:**
```bash
# YANLIÅ (Mixed Content hatasÄ± verir!)
VITE_API_URL=http://20.10.10.30:4000/api

# DOÄRU (Nginx reverse proxy kullanÄ±r)
VITE_API_URL=/api
```

**Komut:**
```bash
echo 'VITE_API_URL=/api' | sudo tee /opt/clixer/frontend/.env.production
```

**2. Production Build Al:**
```bash
cd /opt/clixer/frontend
sudo rm -rf dist node_modules/.vite
sudo npm run build
```

**3. Build DoÄŸrulama (ZORUNLU!):**
```bash
# Bu komut 0 dÃ¶nmeli! 0'dan fazla ise hala hardcoded URL var!
grep -o "http://[^\"']*:4000" /opt/clixer/frontend/dist/assets/*.js | wc -l
```

**4. Ä°zinler ve Nginx:**
```bash
sudo chown -R www-data:www-data /opt/clixer/frontend/dist
sudo chmod -R 755 /opt/clixer/frontend/dist
sudo systemctl restart nginx
```

### ğŸ“‹ NGINX HTTPS YAPILANDIRMASI

```nginx
# /etc/nginx/sites-available/default

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2 default_server;
    listen [::]:443 ssl http2 default_server;
    server_name _;

    ssl_certificate /etc/ssl/certs/certificate.crt;
    ssl_certificate_key /etc/ssl/private/certificate.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    # SÄ±kÄ±ÅŸtÄ±rma (HÄ±z iÃ§in)
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Frontend - Static dosyalar (Production Build)
    location / {
        root /opt/clixer/frontend/dist;
        index index.html;
        try_files $uri $uri/ /index.html;

        # Ã–nbellekleme (HÄ±z iÃ§in)
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
            expires 30d;
            add_header Cache-Control "public, no-transform";
        }
    }

    # API Proxy (Gateway'e yÃ¶nlendir)
    location /api {
        proxy_pass http://localhost:4000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket Proxy (Notification Service'e yÃ¶nlendir)
    location /socket.io/ {
        proxy_pass http://localhost:4004;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### ğŸ“‹ SSL SERTÄ°FÄ°KA KURULUMU (PFX'ten)

```bash
# 1. PFX dosyasÄ±nÄ± sunucuya kopyala (Windows'tan)
scp C:\cert.pfx kullanici@SUNUCU_IP:/tmp/

# 2. PFX'ten CRT ve KEY Ã§Ä±kar
cd /tmp
sudo openssl pkcs12 -in cert.pfx -clcerts -nokeys -out /etc/ssl/certs/certificate.crt
sudo openssl pkcs12 -in cert.pfx -nocerts -nodes -out /etc/ssl/private/certificate.key

# 3. Ä°zinleri ayarla
sudo chmod 600 /etc/ssl/private/certificate.key
sudo chmod 644 /etc/ssl/certs/certificate.crt

# 4. Nginx'i yeniden baÅŸlat
sudo nginx -t && sudo systemctl restart nginx
```

### âš ï¸ ASLA YAPMA!

| YanlÄ±ÅŸ | DoÄŸru |
|--------|-------|
| `.env.production`'da `http://IP:4000/api` | `.env.production`'da `/api` |
| Development modda production deploy | `npm run build` ile static dosya |
| Nginx'te `proxy_pass` trailing slash | Trailing slash OLMADAN |
| Frontend'i port 3000'de Ã§alÄ±ÅŸtÄ±rma | `dist` klasÃ¶rÃ¼nden static serve |

### ğŸ” HATA AYIKLAMA

**"Mixed Content" HatasÄ±:**
```bash
# Build edilmiÅŸ dosyada hardcoded URL var mÄ±?
grep -o "http://[^\"']*:4000" /opt/clixer/frontend/dist/assets/*.js | wc -l
# 0 dÃ¶nmeli!

# .env.production kontrol
cat /opt/clixer/frontend/.env.production
# VITE_API_URL=/api olmalÄ±!
```

**502 Bad Gateway:**
```bash
# Servisler Ã§alÄ±ÅŸÄ±yor mu?
sudo ss -tlnp | grep -E "4000|4001|4002|4003|4004|4005"

# Dist klasÃ¶rÃ¼ var mÄ± ve izinler doÄŸru mu?
ls -la /opt/clixer/frontend/dist/
```

**ServiceWorker SSL HatasÄ±:**
```bash
# Sertifika geÃ§erli mi?
openssl s_client -connect localhost:443 -servername localhost < /dev/null 2>/dev/null | openssl x509 -noout -dates
```

---

## ğŸ“… v4.1 - 7 Ocak 2026

**HTTPS/SSL Production Kurulumu - Mixed Content Ã‡Ã¶zÃ¼mÃ¼**

### Ã‡Ã¶zÃ¼len Sorunlar

1. âœ… **Mixed Content HatasÄ±** - `.env.production` dosyasÄ±nda `VITE_API_URL=http://IP:4000/api` â†’ `/api` olarak dÃ¼zeltildi
2. âœ… **Production Build** - `npm run build` ile static dosyalar oluÅŸturuldu
3. âœ… **Nginx Reverse Proxy** - `/api` â†’ `localhost:4000`, `/socket.io/` â†’ `localhost:4004`
4. âœ… **SSL Sertifika** - PFX'ten CRT ve KEY Ã§Ä±karÄ±larak Nginx'e eklendi
5. âœ… **WebSocket HTTPS** - `wss://` iÃ§in Nginx proxy eklendi

### KÃ¶k Neden

Vite, production build sÄ±rasÄ±nda `.env.production` dosyasÄ±ndaki `VITE_API_URL` deÄŸerini **compile-time'da** JavaScript'e inject ediyor. Bu deÄŸer `http://...` ise, HTTPS sayfasÄ±nda "Mixed Content" hatasÄ± oluÅŸuyor.

### Ã–nleme KuralÄ±

**Yeni mÃ¼ÅŸteri kurulumunda MUTLAKA:**
1. `.env.production` dosyasÄ±nÄ± kontrol et
2. `VITE_API_URL=/api` olduÄŸundan emin ol
3. Build al ve `grep` ile doÄŸrula
4. Nginx'te `/api` ve `/socket.io/` proxy'leri ekle

### DeÄŸiÅŸtirilen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `/opt/clixer/frontend/.env.production` | `VITE_API_URL=/api` |
| `/etc/nginx/sites-available/default` | HTTPS, reverse proxy, WebSocket |
| `/opt/clixer/frontend/src/services/api.ts` | `baseURL: '/api'` (zaten doÄŸruydu) |

### Yedekleme

- **Backup**: MÃ¼ÅŸteri sunucusunda production Ã§alÄ±ÅŸÄ±yor
- **GitHub**: GÃ¼ncellenmeli (`v4.1` tag)

---

## ğŸ”´ğŸ”´ğŸ”´ ETL ORDER BY TARÄ°H KOLONU SORUNU (v4.2 - 7 Ocak 2026)

### MUTLAK KURAL: ReplacingMergeTree ORDER BY'da tarih kolonu ZORUNLU!

**Sorun:** Dataset oluÅŸturulduÄŸunda unique kolon (id, code vb.) bulunamadÄ±ÄŸÄ±nda, ilk 5 kolon ORDER BY olarak kullanÄ±lÄ±yor. Bu kolonlarda tarih (partition_column, reference_column) yoksa, **ReplacingMergeTree farklÄ± tarihleri aynÄ± key gibi gÃ¶rÃ¼p merge ediyor!**

**Belirti:**
```
1M satÄ±r ClickHouse'a yazÄ±ldÄ± â†’ SonuÃ§: 3500 satÄ±r!
365 gÃ¼nlÃ¼k veri â†’ Her unique key kombinasyonu iÃ§in 1 satÄ±r (son tarih kalÄ±yor)
```

**Ã–rnek:**
```
Kaynak Veri (1M satÄ±r):
Country=Turkey, BranchType=Store, BranchID=1, SalesYear=2024, ReportDay=2024-01-01, Sales=1000
Country=Turkey, BranchType=Store, BranchID=1, SalesYear=2024, ReportDay=2024-01-02, Sales=2000
... (365 gÃ¼n)

YanlÄ±ÅŸ ORDER BY: (Country, BranchType, BranchID, BranchName, SalesYear)
SonuÃ§: TÃœM gÃ¼nler merge â†’ 1 satÄ±r kalÄ±r!

DoÄŸru ORDER BY: (ReportDay, Country, BranchType, BranchID, SalesYear)
SonuÃ§: Her gÃ¼n ayrÄ± satÄ±r â†’ 365 satÄ±r kalÄ±r âœ…
```

### KÃ–K NEDEN

1. `data-service` ve `etl-worker`'da ORDER BY oluÅŸtururken:
   - Unique kolon (id, code) aranÄ±yor
   - Bulunamazsa ilk 5 kolon kullanÄ±lÄ±yor
   - **Tarih kolonu (partition_column, reference_column) dikkate ALINMIYORDU!**

2. ReplacingMergeTree aynÄ± ORDER BY key'e sahip satÄ±rlardan sadece en yeniyi tutar (_synced_at'e gÃ¶re)

### âœ… Ã‡Ã–ZÃœM (v4.2)

**data-service/src/index.ts - SatÄ±r 1972-2027:**
- Unique kolon yoksa, **Ã¶nce tarih kolonu ara** (partition_column, reference_column, Date/DateTime tipi)
- Tarih kolonunu ORDER BY'Ä±n **EN BAÅINA** ekle
- Sonra diÄŸer kolonlarÄ± ekle

**etl-worker/src/index.ts - ensureTableExists fonksiyonu:**
- AynÄ± mantÄ±k: dataset.partition_column, dataset.reference_column dikkate al
- Tarih kolonu ORDER BY'Ä±n baÅŸÄ±nda olsun
- Engine: MergeTree â†’ **ReplacingMergeTree(_synced_at)** olarak deÄŸiÅŸtirildi

### Kod DeÄŸiÅŸiklikleri

```javascript
// ESKÄ° (YANLIÅ)
if (!orderByColumn) {
  const allColumns = normalizedMapping.slice(0, 5).map(col => col.target);
  orderByColumn = allColumns.join(', ');
}

// YENÄ° (DOÄRU)
if (!orderByColumn) {
  // 1. Tarih kolonu ara (partition_column, reference_column, Date tipi)
  let dateColumn = findDateColumn();
  
  // 2. Tarih kolonunu EN BAÅA koy
  if (dateColumn) {
    const otherColumns = allColumns.filter(c => c !== dateColumn).slice(0, 4);
    orderByColumn = [dateColumn, ...otherColumns].join(', ');
  }
}
```

### MÃ¼ÅŸteri Sunucusunda DÃ¼zeltme

```bash
# 1. Tabloyu sil
ssh root@20.10.10.30
curl -s "http://localhost:8123/?user=clixer&password=clixer_click_2025" \
  --data "DROP TABLE IF EXISTS clixer_analytics.ds_2bf9c867_1501_4de2_8f32_e7829cc4cb16"

# 2. Kodu gÃ¼ncelle
cd /opt/clixer
sudo git pull origin main

# 3. Servisleri yeniden baÅŸlat
sudo bash scripts/stop-all.sh
sudo bash scripts/start-all.sh

# 4. Dataset'i yeniden sync et (UI'dan veya API ile)
# Tablo otomatik doÄŸru ORDER BY ile oluÅŸturulacak
```

### Test KontrolÃ¼

```bash
# ORDER BY'Ä± kontrol et
curl -s "http://localhost:8123/?user=clixer&password=clixer_click_2025" \
  --data "SELECT name, sorting_key FROM system.tables WHERE database='clixer_analytics' FORMAT Vertical"

# ReportDay (tarih kolonu) ORDER BY'da BAÅTA olmalÄ±:
# sorting_key: ReportDay, Country, BranchType, BranchID, SalesYear
```

### Etkilenen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `services/data-service/src/index.ts` | ORDER BY mantÄ±ÄŸÄ± gÃ¼ncellendi, tarih kolonu Ã¶ncelikli |
| `services/etl-worker/src/index.ts` | ensureTableExists fonksiyonu gÃ¼ncellendi, ReplacingMergeTree eklendi |

### Ã–nleme KuralÄ±

**Yeni dataset oluÅŸtururken MUTLAKA:**
1. Unique kolon (id, code) seÃ§ - en gÃ¼venli
2. Unique kolon yoksa (View, Aggregate) â†’ Tarih kolonunu **Partition Kolonu** olarak seÃ§
3. Tarih kolonu ORDER BY'da otomatik olarak baÅŸa eklenir

---

## ğŸ“… v4.2 - 7 Ocak 2026

**ETL ORDER BY Tarih Kolonu DÃ¼zeltmesi**

### Ã‡Ã¶zÃ¼len Sorunlar

1. âœ… **1M satÄ±r â†’ 3500 satÄ±r sorunu** - Tarih kolonu ORDER BY'a eklendi
2. âœ… **data-service ORDER BY mantÄ±ÄŸÄ±** - partition_column, reference_column, Date tipi kolon dikkate alÄ±nÄ±yor
3. âœ… **etl-worker ensureTableExists** - AynÄ± mantÄ±k eklendi, ReplacingMergeTree varsayÄ±lan
4. âœ… **Composite ORDER BY** - Tarih kolonu EN BAÅA ekleniyor

### KÃ¶k Neden

ReplacingMergeTree, ORDER BY key'e gÃ¶re duplicate'larÄ± merge ediyor. Tarih kolonu ORDER BY'da olmadÄ±ÄŸÄ±nda, farklÄ± tarihlerdeki satÄ±rlar aynÄ± key'e dÃ¼ÅŸÃ¼p merge ediliyor.

### DeÄŸiÅŸtirilen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `services/data-service/src/index.ts` | SatÄ±r 1972-2100: ORDER BY mantÄ±ÄŸÄ±, tarih kolonu Ã¶ncelikli |
| `services/etl-worker/src/index.ts` | SatÄ±r 422-480: ensureTableExists, ReplacingMergeTree, tarih kolonu |

### Yedekleme

- **GitHub**: `v4.2` tag olarak oluÅŸturulmalÄ±
