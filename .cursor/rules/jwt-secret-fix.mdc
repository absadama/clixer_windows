# JWT_SECRET Environment Fix (26 Ocak 2026)

## Problem
Tüm servisler 401 Unauthorized hatası veriyordu. Nedeni: PowerShell'de eski `JWT_SECRET` environment variable'ı `.env` dosyasındakini override ediyordu.

## Çözüm: env.ts Dosyaları
Her servise `env.ts` dosyası eklendi ve `index.ts`'in EN BAŞINA import edildi.

### Kritik: `override: true` Kullanımı
```typescript
// services/*/src/env.ts
import dotenv from 'dotenv';
import path from 'path';

const envPath = path.resolve(__dirname, '../../../.env');
dotenv.config({ path: envPath, override: true }); // override: true ŞART!

export const ENV_LOADED = true;
```

### Index.ts'te İlk Satır Olmalı
```typescript
// services/*/src/index.ts
import './env'; // MUTLAKA İLK SATIR!

import express from 'express';
// ... diğer importlar
```

## Düzeltilen Servisler
| Servis | env.ts | Durum |
|--------|--------|-------|
| auth-service | ✓ Eklendi | Çalışıyor |
| core-service | ✓ Eklendi | Çalışıyor |
| data-service | ✓ Eklendi | Çalışıyor |
| analytics-service | ✓ Eklendi | Çalışıyor |
| notification-service | ✓ Eklendi | Çalışıyor |

## Servis Portları
- 3000: Frontend (Vite)
- 4000: Gateway
- 4001: Auth Service
- 4002: Core Service
- 4003: Data Service
- 4004: Notification Service
- 4005: Analytics Service

## Notification Service - Email Ayarları

### SMTP Test Endpoint
`POST /api/notification/email-settings/test` çalışması için:
1. Önce ayarları KAYDET (`PUT /email-settings`)
2. Sonra TEST ET (`POST /email-settings/test`)

### Office 365 SMTP
- Port: 587 (STARTTLS)
- Kurumsal hesaplarda SMTP AUTH kapalı olabilir
- Hata: `SmtpClientAuthentication is disabled for the Tenant`
- Çözüm: IT'den SMTP AUTH açılmasını iste veya Gmail/Yandex kullan

### Gmail SMTP (Alternatif)
```
Host: smtp.gmail.com
Port: 587
User: gmail@adresiniz
Pass: App Password (16 haneli)
```
App Password: https://myaccount.google.com/apppasswords

## Önemli Hatırlatmalar
1. Yeni terminal açıldığında JWT_SECRET shell'de set edilmişse sorun tekrarlayabilir
2. `$env:JWT_SECRET` PowerShell'de kontrol et, varsa `Remove-Item Env:JWT_SECRET` ile sil
3. Token sorunu yaşanırsa: Logout → Login (yeni token al)
